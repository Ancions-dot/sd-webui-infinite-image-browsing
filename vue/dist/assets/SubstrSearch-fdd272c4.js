import{d as ne,v as k,au as ie,bO as K,bQ as oe,a4 as re,aa as ue,a7 as de,bP as P,bR as ce,o,k as _,B as G,c as i,C as e,bZ as pe,l as d,R as C,z as b,A as r,m as S,t as g,p as x,E as N,G as ve,Q as me,X as ge,Y as fe,bW as we,U as ke,V as be,b_ as xe,bY as he,q as Ie}from"./index-17974bd4.js";import{L as ye,R as _e,f as Ce,S as Se}from"./fullScreenContextMenu-e92a86f3.js";/* empty css              */import{g as ze,F as Me}from"./FileItem-56aafc69.js";import{c as $e,u as Be}from"./hook-63a75fc7.js";import"./index-c611f8dd.js";import"./index-95f0bc27.js";import"./functionalCallableComp-a548bd13.js";const De="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",Re=["src"],Ee={class:"search-bar last"},Fe={class:"form-name"},Ue={class:"hint"},Ve={key:1,class:"preview-switch"},Ae=ne({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(O){const z=O,c=k(!1),p=k(""),f=k(z.searchScope??""),h=$e(a=>{const s={cursor:a,regexp:c.value?p.value:"",surstr:c.value?"":p.value,folder_paths:(f.value??"").split(/,|\n/).map(m=>m.trim()).filter(m=>m)};return xe(s)}),{queue:u,images:n,onContextMenuClickU:M,stackViewEl:L,previewIdx:v,previewing:$,onPreviewVisibleChange:Q,previewImgMove:B,canPreview:D,itemSize:R,gridItems:H,showGenInfo:w,imageGenInfo:E,q:W,multiSelectedIdxs:F,onFileItemClick:Y,scroller:U,showMenuIdx:I,onFileDragStart:X,onFileDragEnd:Z,cellWidth:j,onScroll:V}=Be(h),t=k();ie(async()=>{t.value=await K(),t.value.img_count&&t.value.expired&&await A(),z.searchScope&&await y()});const A=oe(()=>u.pushAction(async()=>(await he(),t.value=await K(),t.value)).res),y=async()=>{await h.reset({refetch:!0}),await re(),V(),U.value.scrollToItem(0),n.value.length||ue.info(de("fuzzy-search-noResults"))};P("returnToIIB",async()=>{const a=await u.pushAction(ce).res;t.value.expired=a.expired}),P("searchIndexExpired",()=>t.value&&(t.value.expired=!0));const J=()=>{c.value=!c.value};return(a,s)=>{const m=ge,T=fe,ee=we,se=ke,te=be,ae=Se;return o(),_("div",{class:"container",ref_key:"stackViewEl",ref:L},[t.value?(o(),_("div",{key:0,class:"search-bar",onKeydown:s[2]||(s[2]=G(()=>{},["stop"]))},[i(m,{value:p.value,"onUpdate:value":s[0]||(s[0]=l=>p.value=l),placeholder:a.$t("fuzzy-search-placeholder")+" "+a.$t("regexSearchEnabledHint"),disabled:!e(u).isIdle,onKeydown:pe(y,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),d("div",{class:C(["regex-icon",{selected:c.value}]),onKeydown:s[1]||(s[1]=G(()=>{},["stop"])),onClick:J,title:"Use Regular Expression"},[d("img",{src:e(De)},null,8,Re)],34),t.value.expired||!t.value.img_count?(o(),b(T,{key:0,onClick:e(A),loading:!e(u).isIdle,type:"primary"},{default:r(()=>[S(g(t.value.img_count===0?a.$t("generateIndexHint"):a.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(o(),b(T,{key:1,type:"primary",onClick:y,loading:!e(u).isIdle||e(h).loading,disabled:!p.value&&!f.value},{default:r(()=>[S(g(a.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):x("",!0),d("div",Ee,[d("div",Fe,g(a.$t("searchScope")),1),i(ee,{"auto-size":{maxRows:8},value:f.value,"onUpdate:value":s[3]||(s[3]=l=>f.value=l),placeholder:a.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),i(ae,{size:"large",spinning:!e(u).isIdle},{default:r(()=>[i(te,{visible:e(w),"onUpdate:visible":s[5]||(s[5]=l=>N(w)?w.value=l:null),width:"70vw","mask-closable":"",onOk:s[6]||(s[6]=l=>w.value=!1)},{cancelText:r(()=>[]),default:r(()=>[i(se,{active:"",loading:!e(W).isIdle},{default:r(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[4]||(s[4]=l=>e(ve)(e(E)))},[d("div",Ue,g(a.$t("doubleClickToCopy")),1),S(" "+g(e(E)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(n)?(o(),b(e(ze),{key:0,ref_key:"scroller",ref:U,class:"file-list",items:e(n),"item-size":e(R).first,"key-field":"fullpath","item-secondary-size":e(R).second,gridItems:e(H),onScroll:e(V)},{default:r(({item:l,index:q})=>[i(Me,{idx:q,file:l,"show-menu-idx":e(I),"onUpdate:showMenuIdx":s[7]||(s[7]=le=>N(I)?I.value=le:null),onFileItemClick:e(Y),"full-screen-preview-image-url":e(n)[e(v)]?e(me)(e(n)[e(v)]):"","cell-width":e(j),selected:e(F).includes(q),onContextMenuClick:e(M),onDragstart:e(X),onDragend:e(Z),"is-selected-mutil-files":e(F).length>1,onPreviewVisibleChange:e(Q)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):x("",!0),e($)?(o(),_("div",Ve,[i(e(ye),{onClick:s[8]||(s[8]=l=>e(B)("prev")),class:C({disable:!e(D)("prev")})},null,8,["class"]),i(e(_e),{onClick:s[9]||(s[9]=l=>e(B)("next")),class:C({disable:!e(D)("next")})},null,8,["class"])])):x("",!0)]),_:1},8,["spinning"]),e($)&&e(n)&&e(n)[e(v)]?(o(),b(Ce,{key:1,file:e(n)[e(v)],idx:e(v),onContextMenuClick:e(M)},null,8,["file","idx","onContextMenuClick"])):x("",!0)],512)}}});const Qe=Ie(Ae,[["__scopeId","data-v-6c9b6792"]]);export{Qe as default};
