import{d as Z,Z as B,aF as j,bD as J,bC as $,o,y as k,c as r,r as e,bG as X,m,n as u,x as w,v,H as f,s as V,p as A,t as Y,K as ee,L as F,aq as ae,ah as ne,T as se,U as te,O as ie,Q as le,W as oe}from"./index-c2119b6f.js";import{a as re,f as ue,L as de,R as ce,b as pe,S as me}from"./fullScreenContextMenu-b1b1d8fe.js";/* empty css              */import"./hook-539b1760.js";import{b as U,c as ve,e as fe,u as ge}from"./db-245df301.js";import{u as ke}from"./hook-d91fbc9a.js";import"./_baseIteratee-69afb4b5.js";const we={key:0,class:"search-bar"},ye={class:"hint"},Ce={key:1,class:"preview-switch"},Ie=Z({__name:"SubstrSearch",setup(be){const{queue:l,images:t,onContextMenuClickU:y,stackViewEl:E,previewIdx:d,previewing:C,onPreviewVisibleChange:T,previewImgMove:I,canPreview:b,itemSize:x,gridItems:R,showGenInfo:c,imageGenInfo:_,q,multiSelectedIdxs:G,onFileItemClick:K,scroller:h,showMenuIdx:g,onFileDragStart:L,onFileDragEnd:N}=ke(),p=B(""),n=B();j(async()=>{n.value=await U(),n.value.img_count&&n.value.expired&&S()});const S=J(()=>l.pushAction(async()=>(await ge(),n.value=await U(),n.value)).res),D=async()=>{var s;t.value=await l.pushAction(()=>fe(p.value)).res,(s=h.value)==null||s.scrollToItem(0),t.value.length||ae.info(ne("fuzzy-search-noResults"))};return $("returnToIIB",async()=>{const s=await l.pushAction(ve).res;n.value.expired=s.expired}),$("searchIndexExpired",()=>n.value&&(n.value.expired=!0)),(s,a)=>{const O=se,M=te,P=ie,H=le,Q=me;return o(),k("div",{class:"container",ref_key:"stackViewEl",ref:E},[n.value?(o(),k("div",we,[r(O,{value:p.value,"onUpdate:value":a[0]||(a[0]=i=>p.value=i),placeholder:s.$t("fuzzy-search-placeholder"),disabled:!e(l).isIdle,onKeydown:X(D,["enter"])},null,8,["value","placeholder","disabled","onKeydown"]),n.value.expired||!n.value.img_count?(o(),m(M,{key:0,onClick:e(S),loading:!e(l).isIdle,type:"primary"},{default:u(()=>[w(v(n.value.img_count===0?s.$t("generateIndexHint"):s.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(o(),m(M,{key:1,type:"primary",onClick:D,loading:!e(l).isIdle,disabled:!p.value},{default:u(()=>[w(v(s.$t("search")),1)]),_:1},8,["loading","disabled"]))])):f("",!0),r(Q,{size:"large",spinning:!e(l).isIdle},{default:u(()=>[r(H,{visible:e(c),"onUpdate:visible":a[2]||(a[2]=i=>V(c)?c.value=i:null),width:"70vw","mask-closable":"",onOk:a[3]||(a[3]=i=>c.value=!1)},{cancelText:u(()=>[]),default:u(()=>[r(P,{active:"",loading:!e(q).isIdle},{default:u(()=>[A("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:a[1]||(a[1]=i=>e(Y)(e(_)))},[A("div",ye,v(s.$t("doubleClickToCopy")),1),w(" "+v(e(_)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(t)?(o(),m(e(re),{key:0,ref_key:"scroller",ref:h,class:"file-list",items:e(t),"item-size":e(x).first,"key-field":"fullpath","item-secondary-size":e(x).second,gridItems:e(R)},{default:u(({item:i,index:z})=>[r(ue,{idx:z,file:i,"show-menu-idx":e(g),"onUpdate:showMenuIdx":a[4]||(a[4]=W=>V(g)?g.value=W:null),onFileItemClick:e(K),"full-screen-preview-image-url":e(t)[e(d)]?e(ee)(e(t)[e(d)]):"",selected:e(G).includes(z),onContextMenuClick:e(y),onDragstart:e(L),onDragend:e(N),onPreviewVisibleChange:e(T)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","selected","onContextMenuClick","onDragstart","onDragend","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems"])):f("",!0),e(C)?(o(),k("div",Ce,[r(e(de),{onClick:a[5]||(a[5]=i=>e(I)("prev")),class:F({disable:!e(b)("prev")})},null,8,["class"]),r(e(ce),{onClick:a[6]||(a[6]=i=>e(I)("next")),class:F({disable:!e(b)("next")})},null,8,["class"])])):f("",!0)]),_:1},8,["spinning"]),e(C)&&e(t)&&e(t)[e(d)]?(o(),m(pe,{key:1,file:e(t)[e(d)],idx:e(d),onContextMenuClick:e(y)},null,8,["file","idx","onContextMenuClick"])):f("",!0)],512)}}});const Be=oe(Ie,[["__scopeId","data-v-56ea21ae"]]);export{Be as default};
