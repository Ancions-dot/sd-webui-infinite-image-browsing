import{d as be,r as y,o as xe,c0 as Q,y as Ce,av as Ie,v as Re,x as $e,z as W,c1 as Ae,W as Me,N as c,O as I,c as t,Y as s,Z as e,Q as d,R as i,S as o,X as k,U as m,$ as X,c7 as ze,aa as z,a0 as Y,E as Fe,a9 as De,T as Ue,ad as Z,ae as Be,af as j,c4 as Ee,ac as Ve,aI as Te,aJ as He,c8 as Ke,c6 as Je,V as Le}from"./index-8120eed9.js";import{S as Ne}from"./index-27c4b040.js";import"./index-9938200e.js";import{c as Oe,d as qe,F as Ge}from"./FileItem-ad0bcda2.js";import{M as Pe,L as Qe,R as We,f as Xe}from"./MultiSelectKeep-9bfd3b7f.js";import{c as Ye,u as Ze}from"./hook-3ec3e8da.js";import{f as F,H as ee,_ as je,a as es}from"./searchHistory-1418e9b2.js";import"./functionalCallableComp-c2695a1f.js";import"./index-a3c1f71f.js";/* empty css              */import"./shortcut-95612d36.js";import"./Checkbox-356e3a33.js";const ss="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",D=w=>(Te("data-v-1a34b8ae"),w=w(),He(),w),ts={style:{"padding-right":"16px"}},ls=D(()=>d("div",null,null,-1)),as=["src"],ns={class:"search-bar"},os={class:"form-name"},is={class:"search-bar last actions"},rs={class:"hint"},ds={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},us={style:{margin:"16px 32px 16px"}},cs={style:{"padding-right":"16px"}},ps=D(()=>d("div",null,null,-1)),vs=D(()=>d("div",{style:{padding:"16px 0 512px"}},null,-1)),fs={key:2,class:"preview-switch"},_s=be({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(w){const U=w,f=y(!1),_=y(""),g=y(U.searchScope??""),S=y(!1),B=y(0),R=Ye(l=>{const a={cursor:l,regexp:f.value?_.value:"",surstr:f.value?"":_.value,folder_paths:(g.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r)};return Ke(a)}),{queue:h,images:p,onContextMenuClickU:E,stackViewEl:se,previewIdx:b,previewing:V,onPreviewVisibleChange:te,previewImgMove:T,canPreview:H,itemSize:K,gridItems:le,showGenInfo:x,imageGenInfo:J,q:ae,multiSelectedIdxs:$,onFileItemClick:ne,scroller:L,showMenuIdx:A,onFileDragStart:oe,onFileDragEnd:ie,cellWidth:re,onScroll:N,saveAllFileAsJson:de,saveLoadedFileAsJson:ue}=Ze(R),u=y();xe(async()=>{u.value=await Q(),u.value.img_count&&u.value.expired&&await O(),U.searchScope&&await C()});const O=Ce(()=>h.pushAction(async()=>(await Je(),u.value=await Q(),u.value)).res),q=l=>{_.value=l.substr,g.value=l.folder_paths_str,f.value=l.isRegex,S.value=!1,C()},C=async()=>{B.value++,F.value.add({substr:_.value,folder_paths_str:g.value,isRegex:f.value}),await R.reset({refetch:!0}),await Ie(),N(),L.value.scrollToItem(0),p.value.length||Re.info($e("fuzzy-search-noResults"))};W("returnToIIB",async()=>{const l=await h.pushAction(Ae).res;u.value.expired=l.expired}),W("searchIndexExpired",()=>u.value&&(u.value.expired=!0));const ce=()=>{f.value=!f.value},pe=Me(),{onClearAllSelected:ve,onSelectAll:fe,onReverseSelect:_e}=Oe();return(l,a)=>{const r=je,v=es,me=Z,ge=Be,G=j,he=Ee,M=j,ye=Ve,ke=Z,we=Ne;return c(),I(Ue,null,[t(me,{visible:S.value,"onUpdate:visible":a[0]||(a[0]=n=>S.value=n),width:"70vw","mask-closable":"",onOk:a[1]||(a[1]=n=>S.value=!1)},{default:s(()=>[t(ee,{records:e(F),onReuseRecord:q},{default:s(({record:n})=>[d("div",ts,[t(v,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(c(),k(v,{key:0},{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):m("",!0),t(v,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),t(v,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("time"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),ls])]),_:1},8,["records"])]),_:1},8,["visible"]),d("div",{class:"container",ref_key:"stackViewEl",ref:se},[t(Pe,{show:!!e($).length||e(pe).keepMultiSelect,onClearAllSelected:e(ve),onSelectAll:e(fe),onReverseSelect:e(_e)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),u.value?(c(),I("div",{key:0,class:"search-bar",onKeydown:a[4]||(a[4]=X(()=>{},["stop"]))},[t(ge,{value:_.value,"onUpdate:value":a[2]||(a[2]=n=>_.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(h).isIdle,onKeydown:ze(C,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),d("div",{class:z(["regex-icon",{selected:f.value}]),onKeydown:a[3]||(a[3]=X(()=>{},["stop"])),onClick:ce,title:"Use Regular Expression"},[d("img",{src:e(ss)},null,8,as)],34),u.value.expired||!u.value.img_count?(c(),k(G,{key:0,onClick:e(O),loading:!e(h).isIdle,type:"primary"},{default:s(()=>[i(o(u.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(c(),k(G,{key:1,type:"primary",onClick:C,loading:!e(h).isIdle||e(R).loading,disabled:!_.value&&!g.value},{default:s(()=>[i(o(l.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):m("",!0),d("div",ns,[d("div",os,o(l.$t("searchScope")),1),t(he,{"auto-size":{maxRows:8},value:g.value,"onUpdate:value":a[5]||(a[5]=n=>g.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),d("div",is,[t(M,{onClick:e(ue)},{default:s(()=>[i(o(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),t(M,{onClick:e(de)},{default:s(()=>[i(o(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"]),t(M,{onClick:a[6]||(a[6]=n=>S.value=!0)},{default:s(()=>[i(o(l.$t("history")),1)]),_:1})]),t(we,{size:"large",spinning:!e(h).isIdle},{default:s(()=>[t(ke,{visible:e(x),"onUpdate:visible":a[8]||(a[8]=n=>Y(x)?x.value=n:null),width:"70vw","mask-closable":"",onOk:a[9]||(a[9]=n=>x.value=!1)},{cancelText:s(()=>[]),default:s(()=>[t(ye,{active:"",loading:!e(ae).isIdle},{default:s(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:a[7]||(a[7]=n=>e(Fe)(e(J)))},[d("div",rs,o(l.$t("doubleClickToCopy")),1),i(" "+o(e(J)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),B.value===0&&!e(p).length?(c(),I("div",ds,[d("h2",us,o(l.$t("restoreFromHistory")),1),t(ee,{records:e(F),onReuseRecord:q},{default:s(({record:n})=>[d("div",cs,[t(v,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(c(),k(v,{key:0},{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):m("",!0),t(v,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),t(v,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("time"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),ps])]),_:1},8,["records"])])):m("",!0),e(p)?(c(),k(e(qe),{key:1,ref_key:"scroller",ref:L,class:"file-list",items:e(p),"item-size":e(K).first,"key-field":"fullpath","item-secondary-size":e(K).second,gridItems:e(le),onScroll:e(N)},{after:s(()=>[vs]),default:s(({item:n,index:P})=>[t(Ge,{idx:P,file:n,"show-menu-idx":e(A),"onUpdate:showMenuIdx":a[10]||(a[10]=Se=>Y(A)?A.value=Se:null),onFileItemClick:e(ne),"full-screen-preview-image-url":e(p)[e(b)]?e(De)(e(p)[e(b)]):"","cell-width":e(re),selected:e($).includes(P),onContextMenuClick:e(E),onDragstart:e(oe),onDragend:e(ie),"is-selected-mutil-files":e($).length>1,onPreviewVisibleChange:e(te)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):m("",!0),e(V)?(c(),I("div",fs,[t(e(Qe),{onClick:a[11]||(a[11]=n=>e(T)("prev")),class:z({disable:!e(H)("prev")})},null,8,["class"]),t(e(We),{onClick:a[12]||(a[12]=n=>e(T)("next")),class:z({disable:!e(H)("next")})},null,8,["class"])])):m("",!0)]),_:1},8,["spinning"]),e(V)&&e(p)&&e(p)[e(b)]?(c(),k(Xe,{key:1,file:e(p)[e(b)],idx:e(b),onContextMenuClick:e(E)},null,8,["file","idx","onContextMenuClick"])):m("",!0)],512)],64)}}});const $s=Le(_s,[["__scopeId","data-v-1a34b8ae"]]);export{$s as default};
