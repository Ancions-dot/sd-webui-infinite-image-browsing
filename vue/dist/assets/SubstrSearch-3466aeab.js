import{d as xe,r as k,o as Ce,bY as Q,k as Ie,y as Re,av as $e,v as Ae,x as Me,z as W,bZ as ze,W as Fe,N as c,O as I,c as t,Y as s,Z as e,Q as u,R as i,S as o,X as m,U as v,$ as Y,c3 as Ue,aa as U,a0 as Z,E as De,a9 as Be,T as Ee,ad as X,ae as Ve,af as j,c0 as Te,ac as He,aI as Ke,aJ as Je,c4 as Le,c2 as Ne,V as Oe}from"./index-c8a5d9cb.js";import{S as qe}from"./index-e528fb90.js";import"./index-3a2eba4d.js";import{c as Ge,d as Pe,F as Qe}from"./FileItem-d516e5d5.js";import{M as We,L as Ye,R as Ze,f as Xe}from"./MultiSelectKeep-c319f9e1.js";import{c as je,u as es}from"./hook-8d4b4286.js";import{f as R,H as ee,_ as ss,a as ts}from"./searchHistory-5d69f3c0.js";import"./functionalCallableComp-1973dd7b.js";import"./index-9a7fea93.js";/* empty css              */import"./shortcut-bfeb20ff.js";import"./Checkbox-1676d7a7.js";const ls="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",D=w=>(Ke("data-v-9cf612bf"),w=w(),Je(),w),as={style:{"padding-right":"16px"}},ns=D(()=>u("div",null,null,-1)),os=["src"],is={class:"search-bar"},rs={class:"form-name"},us={class:"search-bar last actions"},ds={class:"hint"},cs={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},ps={style:{margin:"16px 32px 16px"}},vs={style:{"padding-right":"16px"}},fs=D(()=>u("div",null,null,-1)),ms=D(()=>u("div",{style:{padding:"16px 0 512px"}},null,-1)),_s={key:2,class:"preview-switch"},gs=xe({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(w){const $=w,_=k(!1),g=k(""),h=k($.searchScope??""),b=k(!1),B=k(0),A=je(l=>{const a={cursor:l,regexp:_.value?g.value:"",surstr:_.value?"":g.value,folder_paths:(h.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r)};return Le(a)}),{queue:y,images:p,onContextMenuClickU:E,stackViewEl:se,previewIdx:S,previewing:V,onPreviewVisibleChange:te,previewImgMove:T,canPreview:H,itemSize:K,gridItems:le,showGenInfo:x,imageGenInfo:J,q:ae,multiSelectedIdxs:M,onFileItemClick:ne,scroller:L,showMenuIdx:z,onFileDragStart:oe,onFileDragEnd:ie,cellWidth:re,onScroll:N,saveAllFileAsJson:ue,saveLoadedFileAsJson:de,props:ce}=es(A),d=k();Ce(async()=>{d.value=await Q(),d.value.img_count&&d.value.expired&&await O(),$.searchScope&&await C()}),Ie(()=>$,async l=>{ce.value=l},{deep:!0,immediate:!0});const O=Re(()=>y.pushAction(async()=>(await Ne(),d.value=await Q(),d.value)).res),q=l=>{g.value=l.substr,h.value=l.folder_paths_str,_.value=l.isRegex,b.value=!1,C()},C=async()=>{B.value++,R.value.add({substr:g.value,folder_paths_str:h.value,isRegex:_.value}),await A.reset({refetch:!0}),await $e(),N(),L.value.scrollToItem(0),p.value.length||Ae.info(Me("fuzzy-search-noResults"))};W("returnToIIB",async()=>{const l=await y.pushAction(ze).res;d.value.expired=l.expired}),W("searchIndexExpired",()=>d.value&&(d.value.expired=!0));const pe=()=>{_.value=!_.value},ve=Fe(),{onClearAllSelected:fe,onSelectAll:me,onReverseSelect:_e}=Ge();return(l,a)=>{const r=ss,f=ts,ge=X,he=Ve,G=j,ye=Te,F=j,ke=He,we=X,be=qe;return c(),I(Ee,null,[t(ge,{visible:b.value,"onUpdate:visible":a[0]||(a[0]=n=>b.value=n),width:"70vw","mask-closable":"",onOk:a[1]||(a[1]=n=>b.value=!1)},{default:s(()=>[t(ee,{records:e(R),onReuseRecord:q},{default:s(({record:n})=>[u("div",as,[t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(c(),m(f,{key:0},{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):v("",!0),t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("time"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),ns])]),_:1},8,["records"])]),_:1},8,["visible"]),u("div",{class:"container",ref_key:"stackViewEl",ref:se},[t(We,{show:!!e(M).length||e(ve).keepMultiSelect,onClearAllSelected:e(fe),onSelectAll:e(me),onReverseSelect:e(_e)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),d.value?(c(),I("div",{key:0,class:"search-bar",onKeydown:a[4]||(a[4]=Y(()=>{},["stop"]))},[t(he,{value:g.value,"onUpdate:value":a[2]||(a[2]=n=>g.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(y).isIdle,onKeydown:Ue(C,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),u("div",{class:U(["regex-icon",{selected:_.value}]),onKeydown:a[3]||(a[3]=Y(()=>{},["stop"])),onClick:pe,title:"Use Regular Expression"},[u("img",{src:e(ls)},null,8,os)],34),d.value.expired||!d.value.img_count?(c(),m(G,{key:0,onClick:e(O),loading:!e(y).isIdle,type:"primary"},{default:s(()=>[i(o(d.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(c(),m(G,{key:1,type:"primary",onClick:C,loading:!e(y).isIdle||e(A).loading,disabled:!g.value&&!h.value},{default:s(()=>[i(o(l.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):v("",!0),u("div",is,[u("div",rs,o(l.$t("searchScope")),1),t(ye,{"auto-size":{maxRows:8},value:h.value,"onUpdate:value":a[5]||(a[5]=n=>h.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),u("div",us,[e(p).length?(c(),m(F,{key:0,onClick:e(de)},{default:s(()=>[i(o(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):v("",!0),e(p).length?(c(),m(F,{key:1,onClick:e(ue)},{default:s(()=>[i(o(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):v("",!0),t(F,{onClick:a[6]||(a[6]=n=>b.value=!0)},{default:s(()=>[i(o(l.$t("history")),1)]),_:1})]),t(be,{size:"large",spinning:!e(y).isIdle},{default:s(()=>[t(we,{visible:e(x),"onUpdate:visible":a[8]||(a[8]=n=>Z(x)?x.value=n:null),width:"70vw","mask-closable":"",onOk:a[9]||(a[9]=n=>x.value=!1)},{cancelText:s(()=>[]),default:s(()=>[t(ke,{active:"",loading:!e(ae).isIdle},{default:s(()=>[u("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:a[7]||(a[7]=n=>e(De)(e(J)))},[u("div",ds,o(l.$t("doubleClickToCopy")),1),i(" "+o(e(J)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),B.value===0&&!e(p).length&&e(R).getRecords().length?(c(),I("div",cs,[u("h2",ps,o(l.$t("restoreFromHistory")),1),t(ee,{records:e(R),onReuseRecord:q},{default:s(({record:n})=>[u("div",vs,[t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(c(),m(f,{key:0},{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):v("",!0),t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("time"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),fs])]),_:1},8,["records"])])):v("",!0),e(p)?(c(),m(e(Pe),{key:1,ref_key:"scroller",ref:L,class:"file-list",items:e(p),"item-size":e(K).first,"key-field":"fullpath","item-secondary-size":e(K).second,gridItems:e(le),onScroll:e(N)},{after:s(()=>[ms]),default:s(({item:n,index:P})=>[t(Qe,{idx:P,file:n,"show-menu-idx":e(z),"onUpdate:showMenuIdx":a[10]||(a[10]=Se=>Z(z)?z.value=Se:null),onFileItemClick:e(ne),"full-screen-preview-image-url":e(p)[e(S)]?e(Be)(e(p)[e(S)]):"","cell-width":e(re),selected:e(M).includes(P),onContextMenuClick:e(E),onDragstart:e(oe),onDragend:e(ie),"is-selected-mutil-files":e(M).length>1,onPreviewVisibleChange:e(te)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):v("",!0),e(V)?(c(),I("div",_s,[t(e(Ye),{onClick:a[11]||(a[11]=n=>e(T)("prev")),class:U({disable:!e(H)("prev")})},null,8,["class"]),t(e(Ze),{onClick:a[12]||(a[12]=n=>e(T)("next")),class:U({disable:!e(H)("next")})},null,8,["class"])])):v("",!0)]),_:1},8,["spinning"]),e(V)&&e(p)&&e(p)[e(S)]?(c(),m(Xe,{key:1,file:e(p)[e(S)],idx:e(S),onContextMenuClick:e(E)},null,8,["file","idx","onContextMenuClick"])):v("",!0)],512)],64)}}});const Ms=Oe(gs,[["__scopeId","data-v-9cf612bf"]]);export{Ms as default};
