import{c3 as Te,c4 as Le,aW as De,c5 as _e,c6 as Ce,c7 as Ne,aw as ke,al as re,bp as Oe,c8 as Ae,c9 as qe,c as ze,af as Re,ca as ue,cb as We,cc as Ue,k as $e,ag as Ge,cd as Se,ai as $,aq as z,ah as C,ce as J,Z as _,l as ie,bq as oe,aF as Ve,ao as R,cf as je,cg as fe,ch as ve,am as xe,bD as pe,bC as Be,ci as te,cj as He,aJ as Ke,bB as Je,ck as Qe,bY as U,cl as K,t as le,ar as ge,cm as Ye,Q as Ie,K as B,I as Xe,c1 as Ze,ak as Z,cn as et,co as tt,cp as at,cq as nt,cr as st,cs as rt}from"./index-e9e01f28.js";import{h as it,a as ot,t as lt}from"./db-f6dd0370.js";import{b as ct}from"./_baseIteratee-0835714e.js";var he=1/0,ut=17976931348623157e292;function ne(s){if(!s)return s===0?s:0;if(s=Te(s),s===he||s===-he){var i=s<0?-1:1;return i*ut}return s===s?s:0}function j(s){var i=s==null?0:s.length;return i?s[i-1]:void 0}function ft(s,i,a){if(!Le(a))return!1;var r=typeof i;return(r=="number"?De(a)&&_e(i,a.length):r=="string"&&i in a)?Ce(a[i],s):!1}var dt=Math.ceil,vt=Math.max;function pt(s,i,a,r){for(var c=-1,d=vt(dt((i-s)/(a||1)),0),f=Array(d);d--;)f[r?d:++c]=s,s+=a;return f}function gt(s){return function(i,a,r){return r&&typeof r!="number"&&ft(i,a,r)&&(a=r=void 0),i=ne(i),a===void 0?(a=i,i=0):a=ne(a),r=r===void 0?i<a?1:-1:ne(r),pt(i,a,r,s)}}var ht=gt();const Pe=ht;function me(s,i){return s&&s.length?Ne(s,ct(i)):[]}const Q=(...s)=>{document.addEventListener(...s),ke(()=>document.removeEventListener(...s))},ee=new WeakMap;function mt(s,i){return{useHookShareState:r=>{const c=qe();re(c),ee.has(c)||(ee.set(c,Oe(s(c,r??(i==null?void 0:i())))),ke(()=>{ee.delete(c)}));const d=ee.get(c);return re(d),{state:d,toRefs(){return Ae(d)}}}}}var wt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"};const yt=wt;function we(s){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?Object(arguments[i]):{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable}))),r.forEach(function(c){bt(s,c,a[c])})}return s}function bt(s,i,a){return i in s?Object.defineProperty(s,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[i]=a,s}var de=function(i,a){var r=we({},i,a.attrs);return ze(Re,we({},r,{icon:yt}),null)};de.displayName="DatabaseOutlined";de.inheritAttrs=!1;const kt=de;const H=async s=>(await ue.value.get("/files",{params:{folder_path:s}})).data,St=async s=>(await ue.value.post("/delete_files",{file_paths:s})).data,Fe=async(s,i,a)=>(await ue.value.post("/move_files",{file_paths:s,dest:i,create_dest_folder:a})).data;var Me={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */(function(s,i){(function(a,r){s.exports=r})(We,function(){var a={};a.version="0.3.5";var r=a.settings={minimum:.08,easing:"linear",positionUsing:"",speed:200,trickle:!0,trickleSpeed:200,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};a.configure=function(t){var e,n;for(e in t)n=t[e],n!==void 0&&t.hasOwnProperty(e)&&(r[e]=n);return this},a.status=null,a.set=function(t){var e=a.isStarted();t=c(t,r.minimum,1),a.status=t===1?null:t;var n=a.render(!e),l=n.querySelector(r.barSelector),v=r.speed,g=r.easing;return n.offsetWidth,m(function(p){r.positionUsing===""&&(r.positionUsing=a.getPositioningCSS()),F(l,f(t,v,g)),t===1?(F(n,{transition:"none",opacity:1}),n.offsetWidth,setTimeout(function(){F(n,{transition:"all "+v+"ms linear",opacity:0}),setTimeout(function(){a.remove(),p()},v)},v)):setTimeout(p,v)}),this},a.isStarted=function(){return typeof a.status=="number"},a.start=function(){a.status||a.set(0);var t=function(){setTimeout(function(){a.status&&(a.trickle(),t())},r.trickleSpeed)};return r.trickle&&t(),this},a.done=function(t){return!t&&!a.status?this:a.inc(.3+.5*Math.random()).set(1)},a.inc=function(t){var e=a.status;return e?e>1?void 0:(typeof t!="number"&&(e>=0&&e<.2?t=.1:e>=.2&&e<.5?t=.04:e>=.5&&e<.8?t=.02:e>=.8&&e<.99?t=.005:t=0),e=c(e+t,0,.994),a.set(e)):a.start()},a.trickle=function(){return a.inc()},function(){var t=0,e=0;a.promise=function(n){return!n||n.state()==="resolved"?this:(e===0&&a.start(),t++,e++,n.always(function(){e--,e===0?(t=0,a.done()):a.set((t-e)/t)}),this)}}(),a.getElement=function(){var t=a.getParent();if(t){var e=Array.prototype.slice.call(t.querySelectorAll(".nprogress")).filter(function(n){return n.parentElement===t});if(e.length>0)return e[0]}return null},a.getParent=function(){if(r.parent instanceof HTMLElement)return r.parent;if(typeof r.parent=="string")return document.querySelector(r.parent)},a.render=function(t){if(a.isRendered())return a.getElement();M(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.className="nprogress",e.innerHTML=r.template;var n=e.querySelector(r.barSelector),l=t?"-100":d(a.status||0),v=a.getParent(),g;return F(n,{transition:"all 0 linear",transform:"translate3d("+l+"%,0,0)"}),r.showSpinner||(g=e.querySelector(r.spinnerSelector),g&&L(g)),v!=document.body&&M(v,"nprogress-custom-parent"),v.appendChild(e),e},a.remove=function(){a.status=null,T(document.documentElement,"nprogress-busy"),T(a.getParent(),"nprogress-custom-parent");var t=a.getElement();t&&L(t)},a.isRendered=function(){return!!a.getElement()},a.getPositioningCSS=function(){var t=document.body.style,e="WebkitTransform"in t?"Webkit":"MozTransform"in t?"Moz":"msTransform"in t?"ms":"OTransform"in t?"O":"";return e+"Perspective"in t?"translate3d":e+"Transform"in t?"translate":"margin"};function c(t,e,n){return t<e?e:t>n?n:t}function d(t){return(-1+t)*100}function f(t,e,n){var l;return r.positionUsing==="translate3d"?l={transform:"translate3d("+d(t)+"%,0,0)"}:r.positionUsing==="translate"?l={transform:"translate("+d(t)+"%,0)"}:l={"margin-left":d(t)+"%"},l.transition="all "+e+"ms "+n,l}var m=function(){var t=[];function e(){var n=t.shift();n&&n(e)}return function(n){t.push(n),t.length==1&&e()}}(),F=function(){var t=["Webkit","O","Moz","ms"],e={};function n(p){return p.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(y,x){return x.toUpperCase()})}function l(p){var y=document.body.style;if(p in y)return p;for(var x=t.length,I=p.charAt(0).toUpperCase()+p.slice(1),k;x--;)if(k=t[x]+I,k in y)return k;return p}function v(p){return p=n(p),e[p]||(e[p]=l(p))}function g(p,y,x){y=v(y),p.style[y]=x}return function(p,y){var x=arguments,I,k;if(x.length==2)for(I in y)k=y[I],k!==void 0&&y.hasOwnProperty(I)&&g(p,I,k);else g(p,x[1],x[2])}}();function E(t,e){var n=typeof t=="string"?t:P(t);return n.indexOf(" "+e+" ")>=0}function M(t,e){var n=P(t),l=n+e;E(n,e)||(t.className=l.substring(1))}function T(t,e){var n=P(t),l;E(t,e)&&(l=n.replace(" "+e+" "," "),t.className=l.substring(1,l.length-1))}function P(t){return(" "+(t&&t.className||"")+" ").replace(/\s+/gi," ")}function L(t){t&&t.parentNode&&t.parentNode.removeChild(t)}return a})})(Me);var xt=Me.exports;const It=Ue(xt),se=new Map,b=$e(),ye=Ge(),be=new BroadcastChannel("iib-image-transfer-bus"),{eventEmitter:ae,useEventListen:ce}=Se(),{useHookShareState:G}=mt((s,{images:i})=>{const a=_({tabIdx:-1,paneIdx:-1}),r=$(()=>j(c.value)),c=_([]),d=$(()=>{var e;return c.value.map(n=>n.curr).slice((e=b.conf)!=null&&e.is_win?1:0)}),f=$(()=>fe(...d.value)),m=_(b.defaultSortingMethod),F=$(()=>{var g;if(i.value)return i.value;if(!r.value)return[];const e=((g=r.value)==null?void 0:g.files)??[],n=m.value,{walkFiles:l}=r.value,v=p=>b.onlyFoldersAndImages?p.filter(y=>y.type==="dir"||U(y.name)):p;return a.value.walkModePath?l?l.map(p=>K(v(p),n)).flat():K(v(e),n):K(v(e),n)}),E=_([]),M=_(-1),T=_(!0),P=_(!1),L=_(!1),t=()=>b.tabList[a.value.tabIdx].panes[a.value.paneIdx];return{previewing:L,spinning:P,canLoadNext:T,multiSelectedIdxs:E,previewIdx:M,basePath:d,currLocation:f,currPage:r,stack:c,sortMethod:m,sortedFiles:F,scroller:_(),stackViewEl:_(),props:a,getPane:t,...Se()}},()=>({images:_()})),Et=["detailList","largePreviewGrid","previewGrid"];function Tt(s,i){const{previewIdx:a,eventEmitter:r,canLoadNext:c,previewing:d}=G().toRefs(),{state:f}=G(),m=$(()=>(i==null?void 0:i.files.value)??f.sortedFiles),F=$(()=>(i==null?void 0:i.scroller.value)??f.scroller);let E=null;const M=(t,e)=>{var n;d.value=t,E!=null&&!t&&e&&((n=F.value)==null||n.scrollToItem(E),E=null)},T=()=>{s.walkModePath&&!L("next")&&c&&(z.info(C("loadingNextFolder")),r.value.emit("loadNextDir",!0))};Q("keydown",t=>{var e;if(d.value){let n=a.value;if(["ArrowDown","ArrowRight"].includes(t.key))for(n++;m.value[n]&&!U(m.value[n].name);)n++;else if(["ArrowUp","ArrowLeft"].includes(t.key))for(n--;m.value[n]&&!U(m.value[n].name);)n--;if(U((e=m.value[n])==null?void 0:e.name)??""){a.value=n;const l=F.value;l&&!(n>=l.$_startIndex&&n<=l.$_endIndex)&&(E=n)}T()}});const P=t=>{var n;let e=a.value;if(t==="next")for(e++;m.value[e]&&!U(m.value[e].name);)e++;else if(t==="prev")for(e--;m.value[e]&&!U(m.value[e].name);)e--;if(U((n=m.value[e])==null?void 0:n.name)??""){a.value=e;const l=F.value;l&&!(e>=l.$_startIndex&&e<=l.$_endIndex)&&(E=e)}T()},L=t=>{var n;let e=a.value;if(t==="next")for(e++;m.value[e]&&!U(m.value[e].name);)e++;else if(t==="prev")for(e--;m.value[e]&&!U(m.value[e].name);)e--;return U((n=m.value[e])==null?void 0:n.name)??""};return ce("removeFiles",async()=>{var t;d.value&&!f.sortedFiles[a.value]&&(z.info(C("manualExitFullScreen"),5),await J(500),(t=document.querySelector(".ant-image-preview-operations-operation .anticon-close"))==null||t.click(),a.value=-1)}),{previewIdx:a,onPreviewVisibleChange:M,previewing:d,previewImgMove:P,canPreview:L}}function Lt(s){const i=_(),{scroller:a,stackViewEl:r,stack:c,currPage:d,currLocation:f,sortMethod:m,useEventListen:F,eventEmitter:E,getPane:M,multiSelectedIdxs:T,sortedFiles:P}=G().toRefs();ie(()=>c.value.length,oe((o,h)=>{var S;o!==h&&((S=a.value)==null||S.scrollToItem(0))},300));const L=async o=>{if(await v(o),s.walkModePath){await J();const[h]=K(d.value.files,m.value).filter(S=>S.type==="dir");h&&await v(h.fullpath),await E.value.emit("loadNextDir")}};Ve(async()=>{var o;if(!c.value.length){const h=await H("/");c.value.push({files:h.files,curr:"/"})}i.value=new It,i.value.configure({parent:r.value}),s.path&&s.path!=="/"?await L(s.walkModePath??s.path):(o=b.conf)!=null&&o.home&&v(b.conf.home)}),ie(f,oe(o=>{const h=M.value();h.path=o;const S=h.path.split("/").pop(),N=(()=>{var W;if(!s.walkModePath){const q=te(o);for(const[Y,X]of Object.entries(b.pathAliasMap))if(q.startsWith(X))return q.replace(X,Y);return S}return"Walk: "+(((W=b.quickMovePaths.find(q=>q.dir===h.walkModePath))==null?void 0:W.zh)??S)})();h.name=R("div",{style:"display:flex;align-items:center"},[R(kt),R("span",{class:"line-clamp-1",style:"max-width: 256px"},N)]),h.nameFallbackStr=N,b.recent=b.recent.filter(W=>W.key!==h.key),b.recent.unshift({path:o,key:h.key}),b.recent.length>20&&(b.recent=b.recent.slice(0,20))},300));const t=()=>le(f.value),e=async o=>{var h,S;if(o.type==="dir")try{(h=i.value)==null||h.start();const{files:A}=await H(o.fullpath);c.value.push({files:A,curr:o.name})}finally{(S=i.value)==null||S.done()}},n=o=>{for(;o<c.value.length-1;)c.value.pop()},l=(o,h)=>(re(b.conf,"global.conf load failed"),b.conf.is_win?o.toLowerCase()==h.toLowerCase():o==h),v=async o=>{var S,A;const h=c.value.slice();try{je(o)||(o=fe(((S=b.conf)==null?void 0:S.sd_cwd)??"/",o));const N=ve(o),W=c.value.map(q=>q.curr);for(W.shift();W[0]&&N[0]&&l(W[0],N[0]);)W.shift(),N.shift();for(let q=0;q<W.length;q++)c.value.pop();if(!N.length)return g();for(const q of N){const Y=(A=d.value)==null?void 0:A.files.find(X=>l(X.name,q));if(!Y)throw console.error({frags:N,frag:q,stack:xe(c.value)}),new Error(`${q} not found`);await e(Y)}}catch(N){throw z.error(C("moveFailedCheckPath")+(N instanceof Error?N.message:"")),console.error(o,ve(o),d.value),c.value=h,N}},g=pe(async()=>{var o,h,S;try{if((o=i.value)==null||o.start(),s.walkModePath)n(0),await L(s.walkModePath);else{const{files:A}=await H(c.value.length===1?"/":f.value);j(c.value).files=A}(h=a.value)==null||h.scrollToItem(0),z.success(C("refreshCompleted"))}finally{(S=i.value)==null||S.done()}});Be("returnToIIB",pe(async()=>{var o,h;if(!s.walkModePath)try{(o=i.value)==null||o.start();const{files:S}=await H(c.value.length===1?"/":f.value);j(c.value).files.map(N=>N.date).join()!==S.map(N=>N.date).join()&&(j(c.value).files=S,z.success(C("autoUpdate")))}finally{(h=i.value)==null||h.done()}})),F.value("refresh",g);const p=o=>{s.walkModePath&&(M.value().walkModePath=o),L(o)},y=$(()=>b.quickMovePaths.map(o=>({...o,path:te(o.dir)}))),x=$(()=>{const o=te(f.value);return y.value.find(S=>S.path===o)}),I=async()=>{const o=x.value;if(o){if(!o.can_delete)return;await it(f.value),z.success(C("removeComplete"))}else await ot(f.value),z.success(C("addComplete"));ge.emit("searchIndexExpired"),ge.emit("updateGlobalSetting")},k=_(!1),u=_(f.value),w=()=>{k.value=!0,u.value=f.value},D=async()=>{await v(u.value),k.value=!1};return Q("click",()=>{k.value=!1}),{locInputValue:u,isLocationEditing:k,onLocEditEnter:D,onEditBtnClick:w,addToSearchScanPathAndQuickMove:I,searchPathInfo:x,refresh:g,copyLocation:t,back:n,openNext:e,currPage:d,currLocation:f,to:v,stack:c,scroller:a,share:()=>{const o=parent.location,h=o.href.substring(0,o.href.length-o.search.length),S=new URLSearchParams(o.search);S.set("action","open"),S.set("path",f.value);const A=`${h}?${S.toString()}`;le(A,C("copyLocationUrlSuccessMsg"))},selectAll:()=>{T.value=Pe(0,P.value.length)},quickMoveTo:p}}function Dt(s){const{scroller:i,sortedFiles:a,stack:r,sortMethod:c,currLocation:d,currPage:f,stackViewEl:m,canLoadNext:F,previewIdx:E}=G().toRefs(),{state:M}=G(),T=_(!1),P=_(b.defaultViewMode),L=272,t=64,e=L*2,{width:n}=He(m),l=$(()=>{const I=n.value;if(!(P.value==="detailList"||!I))return~~(I/(P.value==="previewGrid"?L:e))}),v=$(()=>{const I=P.value;if(I==="detailList")return{first:80,second:void 0};const k=I==="previewGrid"?L:e;return{first:k+t,second:k}}),g=_(!1),p=async()=>{var I;if(!(g.value||!s.walkModePath||!F.value))try{g.value=!0;const k=r.value[r.value.length-2],u=K(k.files,c.value),w=u.findIndex(D=>{var O;return D.name===((O=f.value)==null?void 0:O.curr)});if(w!==-1){const D=u[w+1],O=fe(d.value,"../",D.name),V=await H(O),o=f.value;o.curr=D.name,o.walkFiles||(o.walkFiles=[o.files]),o.walkFiles.push(V.files),console.log("curr page files length",(I=f.value)==null?void 0:I.files.length)}}catch(k){console.error("loadNextDir",k),F.value=!1}finally{g.value=!1}},y=async(I=!1)=>{const k=i.value,u=()=>I?E.value:(k==null?void 0:k.$_endIndex)??0;for(;!a.value.length||u()>a.value.length-20&&F.value;)await J(100),await p()};M.useEventListen("loadNextDir",y);const x=oe(()=>y(),300);return{gridItems:l,sortedFiles:a,sortMethodConv:Ke,moreActionsDropdownShow:T,viewMode:P,gridSize:L,sortMethod:c,largeGridSize:e,onScroll:x,loadNextDir:p,loadNextDirLoading:g,canLoadNext:F,itemSize:v}}const Ee=()=>R("p",{style:{background:"var(--zp-secondary-background)",padding:"8px",borderLeft:"4px solid var(--primary-color)"}},`Tips: ${C("multiSelectTips")}`);function _t(){const{currLocation:s,sortedFiles:i,currPage:a,multiSelectedIdxs:r,eventEmitter:c}=G().toRefs(),d=()=>{r.value=[]};return Q("click",d),Q("blur",d),ie(a,d),{onFileDragStart:(E,M)=>{const T=xe(i.value[M]);ye.fileDragging=!0,console.log("onFileDragStart set drag file ",E,M,T);const P=[T];let L=T.type==="dir";if(r.value.includes(M)){const e=r.value.map(n=>i.value[n]);P.push(...e),L=e.some(n=>n.type==="dir")}const t={includeDir:L,loc:s.value||"search-result",path:me(P,"fullpath").map(e=>e.fullpath),nodes:me(P,"fullpath"),__id:"FileTransferData"};E.dataTransfer.setData("text/plain",JSON.stringify(t))},onDrop:async E=>{var T;const M=JSON.parse(((T=E.dataTransfer)==null?void 0:T.getData("text"))??"{}");if(Ye(M)){const P=s.value;if(M.loc===P)return;const L=R("div",[R("div",`${C("moveSelectedFilesTo")}${P}`),R("ol",M.path.map(t=>t.split(/[/\\]/).pop()).map(t=>R("li",t))),Ee()]);Ie.confirm({title:C("confirm")+"?",content:L,maskClosable:!0,async onOk(){await Fe(M.path,P),ae.emit("removeFiles",{paths:M.path,loc:M.loc}),await c.value.emit("refresh")}})}},multiSelectedIdxs:r,onFileDragEnd:()=>{ye.fileDragging=!1}}}function Ct(s,{openNext:i}){const a=_(!1),r=_(""),{sortedFiles:c,previewIdx:d,multiSelectedIdxs:f,stack:m,currLocation:F,spinning:E,previewing:M}=G().toRefs(),T=te;ce("removeFiles",({paths:e,loc:n})=>{if(T(n)!==T(F.value))return;const l=j(m.value);l&&(l.files=l.files.filter(v=>!e.includes(v.fullpath)),l.walkFiles&&(l.walkFiles=l.walkFiles.map(v=>v.filter(g=>!e.includes(g.fullpath)))))}),ce("addFiles",({files:e,loc:n})=>{if(T(n)!==T(F.value))return;const l=j(m.value);l&&l.files.unshift(...e)});const P=Je(),L=async(e,n,l)=>{d.value=l,b.fullscreenPreviewInitialUrl=B(n);const v=f.value.indexOf(l);if(e.shiftKey){if(v!==-1)f.value.splice(v,1);else{f.value.push(l),f.value.sort((y,x)=>y-x);const g=f.value[0],p=f.value[f.value.length-1];f.value=Pe(g,p+1)}e.stopPropagation()}else e.ctrlKey||e.metaKey?(v!==-1?f.value.splice(v,1):f.value.push(l),e.stopPropagation()):await i(n)},t=async(e,n,l)=>{var x,I,k;const v=B(n),g=F.value,p=()=>{let u=[];return f.value.includes(l)?u=f.value.map(w=>c.value[w]):u.push(n),u},y=async u=>{if(!E.value)try{E.value=!0,await at(n.fullpath),be.postMessage("iib_hidden_img_update_trigger");const w=setTimeout(()=>nt.warn({message:C("long_loading"),duration:20}),5e3);await st(),clearTimeout(w),be.postMessage(`iib_hidden_tab_${u}`)}catch(w){console.error(w),z.error("发送图像失败，请携带console的错误消息找开发者")}finally{E.value=!1}};if(`${e.key}`.startsWith("toggle-tag-")){const u=+`${e.key}`.split("toggle-tag-")[1],{is_remove:w}=await lt({tag_id:u,img_path:n.fullpath}),D=(I=(x=b.conf)==null?void 0:x.all_custom_tags.find(O=>O.id===u))==null?void 0:I.name;z.success(C(w?"removedTagFromImage":"addedTagToImage",{tag:D}));return}switch(e.key){case"previewInNewWindow":return window.open(v);case"download":return window.open(B(n,!0));case"copyPreviewUrl":return le(parent.document.location.origin+v);case"send2txt2img":return y("txt2img");case"send2img2img":return y("img2img");case"send2inpaint":return y("inpaint");case"send2extras":return y("extras");case"send2savedDir":{const u=b.quickMovePaths.find(O=>O.key==="outdir_save");if(!u)return z.error(C("unknownSavedDir"));const w=tt(u.dir,(k=b.conf)==null?void 0:k.sd_cwd),D=p();await Fe(D.map(O=>O.fullpath),w,!0),ae.emit("removeFiles",{paths:D.map(O=>O.fullpath),loc:F.value}),ae.emit("addFiles",{files:D,loc:w});break}case"send2controlnet-img2img":case"send2controlnet-txt2img":{const u=et(),w=rt(),D=e.key.split("-")[1];D==="img2img"?w.switch_to_img2img():w.switch_to_txt2img(),await J(100);const V=u.querySelector(`#${D}_controlnet`).querySelector(".label-wrap");V.className.includes("open")||(V.click(),await J(100)),V.scrollIntoView();const h=await(await fetch(B(n))).blob(),S=new File([h],"image.jpg",{type:h.type,lastModified:Date.now()}),A=new DataTransfer;A.items.add(S);const N=new ClipboardEvent("paste",{clipboardData:A,bubbles:!0});V.dispatchEvent(N);break}case"openWithWalkMode":{se.set(g,m.value);const u=b.tabList[s.tabIdx],w={type:"local",key:Z(),path:n.fullpath,name:C("local"),stackKey:g,walkModePath:n.fullpath};u.panes.push(w),u.key=w.key;break}case"openInNewTab":{se.set(g,m.value);const u=b.tabList[s.tabIdx],w={type:"local",key:Z(),path:n.fullpath,name:C("local"),stackKey:g};u.panes.push(w),u.key=w.key;break}case"openOnTheRight":{se.set(g,m.value);let u=b.tabList[s.tabIdx+1];u||(u={panes:[],key:"",id:Z()},b.tabList[s.tabIdx+1]=u);const w={type:"local",key:Z(),path:n.fullpath,name:C("local"),stackKey:g};u.panes.push(w),u.key=w.key;break}case"viewGenInfo":{a.value=!0,r.value=await P.pushAction(()=>Ze(n.fullpath)).res;break}case"openWithLocalFileBrowser":{await Xe(n.fullpath);break}case"deleteFiles":{const u=p();await new Promise(w=>{Ie.confirm({title:C("confirmDelete"),maskClosable:!0,content:R("div",[R("ol",{style:"max-height:50vh;overflow:auto;"},u.map(D=>D.fullpath.split(/[/\\]/).pop()).map(D=>R("li",D))),Ee()]),async onOk(){const D=u.map(O=>O.fullpath);await St(D),z.success(C("deleteSuccess")),ae.emit("removeFiles",{paths:D,loc:F.value}),w()}})});break}}return{}};return Q("keydown",e=>{var n,l,v;if(M.value){const g=[];if(e.shiftKey&&g.push("Shift"),e.ctrlKey&&g.push("Ctrl"),e.code.startsWith("Key")||e.code.startsWith("Digit")){g.push(e.code);const p=g.join(" + "),y=(n=Object.entries(b.shortcut).find(x=>x[1]===p))==null?void 0:n[0];if(y){e.stopPropagation(),e.preventDefault();const x=d.value,I=c.value[x];switch(y){case"delete":return B(I)===b.fullscreenPreviewInitialUrl?z.warn(C("fullscreenRestriction")):t({key:"deleteFiles"},I,x);default:{const k=(l=/^toggle_tag_(.*)$/.exec(y))==null?void 0:l[1],u=(v=b.conf)==null?void 0:v.all_custom_tags.find(w=>w.name===k);return u?t({key:`toggle-tag-${u.id}`},I,x):void 0}}}}}}),{onFileItemClick:L,onContextMenuClick:t,showGenInfo:a,imageGenInfo:r,q:P}}const Nt=()=>{const{stackViewEl:s}=G().toRefs(),i=_(-1);return Qe(s,a=>{var c;let r=a.target;for(;r.parentElement;)if(r=r.parentElement,r.tagName.toLowerCase()==="li"&&r.classList.contains("file-item-trigger")){const d=(c=r.dataset)==null?void 0:c.idx;d&&Number.isSafeInteger(+d)&&(i.value=+d);return}}),{showMenuIdx:i}};export{Lt as a,Dt as b,_t as c,Ct as d,Tt as e,Nt as f,ce as g,Q as h,j as l,se as s,ne as t,G as u,Et as v};
