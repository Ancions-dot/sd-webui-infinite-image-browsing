import{d as ve,r as k,o as me,c3 as N,y as ge,av as fe,v as we,x as he,z as q,c4 as Se,W as ke,N as c,O as A,c as n,Z as e,$ as G,ca as Ie,Q as r,aa as M,X as I,Y as o,R as w,S as d,U as _,a0 as O,E as _e,a9 as xe,ae as Ce,af as P,c7 as ye,ac as be,ad as Ae,aI as Me,aJ as $e,cb as ze,c9 as Re,V as Fe}from"./index-fa852b19.js";import{S as De}from"./index-129882d0.js";/* empty css              */import{c as Be,d as Ee,F as Ue}from"./FileItem-87c21bba.js";import{M as Ve,L as Ke,R as Te,f as Je}from"./MultiSelectKeep-fffbcd7e.js";import{c as Le,u as Ne}from"./hook-b8e372d4.js";import"./functionalCallableComp-25723acd.js";import"./index-07440ad3.js";/* empty css              */import"./shortcut-c9f7b3de.js";import"./Checkbox-d5502225.js";const qe="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",Ge=p=>(Me("data-v-ecedc00a"),p=p(),$e(),p),Oe=["src"],Pe={class:"search-bar"},He={class:"form-name"},Qe={class:"search-bar last actions"},We={class:"hint"},Xe=Ge(()=>r("div",{style:{padding:"16px 0 512px"}},null,-1)),Ye={key:1,class:"preview-switch"},Ze=ve({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(p){const $=p,v=k(!1),m=k(""),h=k($.searchScope??""),x=Le(s=>{const l={cursor:s,regexp:v.value?m.value:"",surstr:v.value?"":m.value,folder_paths:(h.value??"").split(/,|\n/).map(f=>f.trim()).filter(f=>f)};return ze(l)}),{queue:u,images:i,onContextMenuClickU:z,stackViewEl:H,previewIdx:g,previewing:R,onPreviewVisibleChange:Q,previewImgMove:F,canPreview:D,itemSize:B,gridItems:W,showGenInfo:S,imageGenInfo:E,q:X,multiSelectedIdxs:C,onFileItemClick:Y,scroller:U,showMenuIdx:y,onFileDragStart:Z,onFileDragEnd:j,cellWidth:ee,onScroll:V,saveAllFileAsJson:le,saveLoadedFileAsJson:se}=Ne(x),t=k();me(async()=>{t.value=await N(),t.value.img_count&&t.value.expired&&await K(),$.searchScope&&await b()});const K=ge(()=>u.pushAction(async()=>(await Re(),t.value=await N(),t.value)).res),b=async()=>{await x.reset({refetch:!0}),await fe(),V(),U.value.scrollToItem(0),i.value.length||we.info(he("fuzzy-search-noResults"))};q("returnToIIB",async()=>{const s=await u.pushAction(Se).res;t.value.expired=s.expired}),q("searchIndexExpired",()=>t.value&&(t.value.expired=!0));const te=()=>{v.value=!v.value},ae=ke(),{onClearAllSelected:ne,onSelectAll:oe,onReverseSelect:ie}=Be();return(s,l)=>{const f=Ce,T=P,re=ye,J=P,ce=be,de=Ae,ue=De;return c(),A("div",{class:"container",ref_key:"stackViewEl",ref:H},[n(Ve,{show:!!e(C).length||e(ae).keepMultiSelect,onClearAllSelected:e(ne),onSelectAll:e(oe),onReverseSelect:e(ie)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),t.value?(c(),A("div",{key:0,class:"search-bar",onKeydown:l[2]||(l[2]=G(()=>{},["stop"]))},[n(f,{value:m.value,"onUpdate:value":l[0]||(l[0]=a=>m.value=a),placeholder:s.$t("fuzzy-search-placeholder")+" "+s.$t("regexSearchEnabledHint"),disabled:!e(u).isIdle,onKeydown:Ie(b,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),r("div",{class:M(["regex-icon",{selected:v.value}]),onKeydown:l[1]||(l[1]=G(()=>{},["stop"])),onClick:te,title:"Use Regular Expression"},[r("img",{src:e(qe)},null,8,Oe)],34),t.value.expired||!t.value.img_count?(c(),I(T,{key:0,onClick:e(K),loading:!e(u).isIdle,type:"primary"},{default:o(()=>[w(d(t.value.img_count===0?s.$t("generateIndexHint"):s.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(c(),I(T,{key:1,type:"primary",onClick:b,loading:!e(u).isIdle||e(x).loading,disabled:!m.value&&!h.value},{default:o(()=>[w(d(s.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):_("",!0),r("div",Pe,[r("div",He,d(s.$t("searchScope")),1),n(re,{"auto-size":{maxRows:8},value:h.value,"onUpdate:value":l[3]||(l[3]=a=>h.value=a),placeholder:s.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),r("div",Qe,[n(J,{onClick:e(se)},{default:o(()=>[w(d(s.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),n(J,{onClick:e(le)},{default:o(()=>[w(d(s.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),n(ue,{size:"large",spinning:!e(u).isIdle},{default:o(()=>[n(de,{visible:e(S),"onUpdate:visible":l[5]||(l[5]=a=>O(S)?S.value=a:null),width:"70vw","mask-closable":"",onOk:l[6]||(l[6]=a=>S.value=!1)},{cancelText:o(()=>[]),default:o(()=>[n(ce,{active:"",loading:!e(X).isIdle},{default:o(()=>[r("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:l[4]||(l[4]=a=>e(_e)(e(E)))},[r("div",We,d(s.$t("doubleClickToCopy")),1),w(" "+d(e(E)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(i)?(c(),I(e(Ee),{key:0,ref_key:"scroller",ref:U,class:"file-list",items:e(i),"item-size":e(B).first,"key-field":"fullpath","item-secondary-size":e(B).second,gridItems:e(W),onScroll:e(V)},{after:o(()=>[Xe]),default:o(({item:a,index:L})=>[n(Ue,{idx:L,file:a,"show-menu-idx":e(y),"onUpdate:showMenuIdx":l[7]||(l[7]=pe=>O(y)?y.value=pe:null),onFileItemClick:e(Y),"full-screen-preview-image-url":e(i)[e(g)]?e(xe)(e(i)[e(g)]):"","cell-width":e(ee),selected:e(C).includes(L),onContextMenuClick:e(z),onDragstart:e(Z),onDragend:e(j),"is-selected-mutil-files":e(C).length>1,onPreviewVisibleChange:e(Q)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):_("",!0),e(R)?(c(),A("div",Ye,[n(e(Ke),{onClick:l[8]||(l[8]=a=>e(F)("prev")),class:M({disable:!e(D)("prev")})},null,8,["class"]),n(e(Te),{onClick:l[9]||(l[9]=a=>e(F)("next")),class:M({disable:!e(D)("next")})},null,8,["class"])])):_("",!0)]),_:1},8,["spinning"]),e(R)&&e(i)&&e(i)[e(g)]?(c(),I(Je,{key:1,file:e(i)[e(g)],idx:e(g),onContextMenuClick:e(z)},null,8,["file","idx","onContextMenuClick"])):_("",!0)],512)}}});const dl=Fe(Ze,[["__scopeId","data-v-ecedc00a"]]);export{dl as default};
