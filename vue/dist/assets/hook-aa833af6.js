import{c3 as Te,c4 as De,aW as Le,c5 as Ce,c6 as _e,c7 as Ne,aw as ke,al as re,bp as Oe,c8 as Ae,c9 as qe,c as ze,af as Re,ca as ue,cb as We,cc as $e,k as Ue,ag as Ve,cd as Se,ai as V,aq as z,ah as C,ce as Q,Z as L,l as ie,bq as oe,aF as Ge,ao as W,cf as je,cg as fe,ch as ve,am as xe,bD as pe,bC as Be,ci as te,cj as He,aJ as Ke,bB as Je,ck as Qe,cl as Ye,bY as $,cm as J,t as le,ar as ge,cn as Xe,Q as Ie,K as H,I as Ze,c1 as et,ak as Z,co as tt,cp as at,cq as nt,cr as st,cs as rt,ct as it}from"./index-0ff6a040.js";import{h as ot,a as lt,t as ct}from"./db-d4ebc7b6.js";import{b as ut}from"./_baseIteratee-d9d0859b.js";var he=1/0,ft=17976931348623157e292;function ne(n){if(!n)return n===0?n:0;if(n=Te(n),n===he||n===-he){var r=n<0?-1:1;return r*ft}return n===n?n:0}function B(n){var r=n==null?0:n.length;return r?n[r-1]:void 0}function dt(n,r,t){if(!De(t))return!1;var i=typeof r;return(i=="number"?Le(t)&&Ce(r,t.length):i=="string"&&r in t)?_e(t[r],n):!1}var vt=Math.ceil,pt=Math.max;function gt(n,r,t,i){for(var c=-1,p=pt(vt((r-n)/(t||1)),0),l=Array(p);p--;)l[i?p:++c]=n,n+=t;return l}function ht(n){return function(r,t,i){return i&&typeof i!="number"&&dt(r,t,i)&&(t=i=void 0),r=ne(r),t===void 0?(t=r,r=0):t=ne(t),i=i===void 0?r<t?1:-1:ne(i),gt(r,t,i,n)}}var mt=ht();const Pe=mt;function me(n,r){return n&&n.length?Ne(n,ut(r)):[]}const Y=(...n)=>{document.addEventListener(...n),ke(()=>document.removeEventListener(...n))},ee=new WeakMap;function wt(n,r){return{useHookShareState:i=>{const c=qe();re(c),ee.has(c)||(ee.set(c,Oe(n(c,i??(r==null?void 0:r())))),ke(()=>{ee.delete(c)}));const p=ee.get(c);return re(p),{state:p,toRefs(){return Ae(p)}}}}}var yt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"};const bt=yt;function we(n){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?Object(arguments[r]):{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),i.forEach(function(c){kt(n,c,t[c])})}return n}function kt(n,r,t){return r in n?Object.defineProperty(n,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[r]=t,n}var de=function(r,t){var i=we({},r,t.attrs);return ze(Re,we({},i,{icon:bt}),null)};de.displayName="DatabaseOutlined";de.inheritAttrs=!1;const St=de;const K=async n=>(await ue.value.get("/files",{params:{folder_path:n}})).data,xt=async n=>(await ue.value.post("/delete_files",{file_paths:n})).data,Fe=async(n,r,t)=>(await ue.value.post("/move_files",{file_paths:n,dest:r,create_dest_folder:t})).data;var Ee={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */(function(n,r){(function(t,i){n.exports=i})(We,function(){var t={};t.version="0.3.5";var i=t.settings={minimum:.08,easing:"linear",positionUsing:"",speed:200,trickle:!0,trickleSpeed:200,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};t.configure=function(e){var a,s;for(a in e)s=e[a],s!==void 0&&e.hasOwnProperty(a)&&(i[a]=s);return this},t.status=null,t.set=function(e){var a=t.isStarted();e=c(e,i.minimum,1),t.status=e===1?null:e;var s=t.render(!a),m=s.querySelector(i.barSelector),f=i.speed,d=i.easing;return s.offsetWidth,_(function(u){i.positionUsing===""&&(i.positionUsing=t.getPositioningCSS()),P(m,l(e,f,d)),e===1?(P(s,{transition:"none",opacity:1}),s.offsetWidth,setTimeout(function(){P(s,{transition:"all "+f+"ms linear",opacity:0}),setTimeout(function(){t.remove(),u()},f)},f)):setTimeout(u,f)}),this},t.isStarted=function(){return typeof t.status=="number"},t.start=function(){t.status||t.set(0);var e=function(){setTimeout(function(){t.status&&(t.trickle(),e())},i.trickleSpeed)};return i.trickle&&e(),this},t.done=function(e){return!e&&!t.status?this:t.inc(.3+.5*Math.random()).set(1)},t.inc=function(e){var a=t.status;return a?a>1?void 0:(typeof e!="number"&&(a>=0&&a<.2?e=.1:a>=.2&&a<.5?e=.04:a>=.5&&a<.8?e=.02:a>=.8&&a<.99?e=.005:e=0),a=c(a+e,0,.994),t.set(a)):t.start()},t.trickle=function(){return t.inc()},function(){var e=0,a=0;t.promise=function(s){return!s||s.state()==="resolved"?this:(a===0&&t.start(),e++,a++,s.always(function(){a--,a===0?(e=0,t.done()):t.set((e-a)/e)}),this)}}(),t.getElement=function(){var e=t.getParent();if(e){var a=Array.prototype.slice.call(e.querySelectorAll(".nprogress")).filter(function(s){return s.parentElement===e});if(a.length>0)return a[0]}return null},t.getParent=function(){if(i.parent instanceof HTMLElement)return i.parent;if(typeof i.parent=="string")return document.querySelector(i.parent)},t.render=function(e){if(t.isRendered())return t.getElement();E(document.documentElement,"nprogress-busy");var a=document.createElement("div");a.id="nprogress",a.className="nprogress",a.innerHTML=i.template;var s=a.querySelector(i.barSelector),m=e?"-100":p(t.status||0),f=t.getParent(),d;return P(s,{transition:"all 0 linear",transform:"translate3d("+m+"%,0,0)"}),i.showSpinner||(d=a.querySelector(i.spinnerSelector),d&&I(d)),f!=document.body&&E(f,"nprogress-custom-parent"),f.appendChild(a),a},t.remove=function(){t.status=null,T(document.documentElement,"nprogress-busy"),T(t.getParent(),"nprogress-custom-parent");var e=t.getElement();e&&I(e)},t.isRendered=function(){return!!t.getElement()},t.getPositioningCSS=function(){var e=document.body.style,a="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return a+"Perspective"in e?"translate3d":a+"Transform"in e?"translate":"margin"};function c(e,a,s){return e<a?a:e>s?s:e}function p(e){return(-1+e)*100}function l(e,a,s){var m;return i.positionUsing==="translate3d"?m={transform:"translate3d("+p(e)+"%,0,0)"}:i.positionUsing==="translate"?m={transform:"translate("+p(e)+"%,0)"}:m={"margin-left":p(e)+"%"},m.transition="all "+a+"ms "+s,m}var _=function(){var e=[];function a(){var s=e.shift();s&&s(a)}return function(s){e.push(s),e.length==1&&a()}}(),P=function(){var e=["Webkit","O","Moz","ms"],a={};function s(u){return u.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(w,k){return k.toUpperCase()})}function m(u){var w=document.body.style;if(u in w)return u;for(var k=e.length,x=u.charAt(0).toUpperCase()+u.slice(1),g;k--;)if(g=e[k]+x,g in w)return g;return u}function f(u){return u=s(u),a[u]||(a[u]=m(u))}function d(u,w,k){w=f(w),u.style[w]=k}return function(u,w){var k=arguments,x,g;if(k.length==2)for(x in w)g=w[x],g!==void 0&&w.hasOwnProperty(x)&&d(u,x,g);else d(u,k[1],k[2])}}();function M(e,a){var s=typeof e=="string"?e:F(e);return s.indexOf(" "+a+" ")>=0}function E(e,a){var s=F(e),m=s+a;M(s,a)||(e.className=m.substring(1))}function T(e,a){var s=F(e),m;M(e,a)&&(m=s.replace(" "+a+" "," "),e.className=m.substring(1,m.length-1))}function F(e){return(" "+(e&&e.className||"")+" ").replace(/\s+/gi," ")}function I(e){e&&e.parentNode&&e.parentNode.removeChild(e)}return t})})(Ee);var It=Ee.exports;const Pt=$e(It),Ft=n=>{const r=[];return n.shiftKey&&r.push("Shift"),n.ctrlKey&&r.push("Ctrl"),n.metaKey&&r.push("Cmd"),(n.code.startsWith("Key")||n.code.startsWith("Digit"))&&r.push(n.code),r.join(" + ")},se=new Map,b=Ue(),ye=Ve(),be=new BroadcastChannel("iib-image-transfer-bus"),{eventEmitter:ae,useEventListen:ce}=Se(),{useHookShareState:G}=wt((n,{images:r})=>{const t=L({tabIdx:-1,paneIdx:-1}),i=V(()=>B(c.value)),c=L([]),p=V(()=>{var a;return c.value.map(s=>s.curr).slice((a=b.conf)!=null&&a.is_win?1:0)}),l=V(()=>fe(...p.value)),_=L(b.defaultSortingMethod),P=V(()=>{var d;if(r.value)return r.value;if(!i.value)return[];const a=((d=i.value)==null?void 0:d.files)??[],s=_.value,{walkFiles:m}=i.value,f=u=>b.onlyFoldersAndImages?u.filter(w=>w.type==="dir"||$(w.name)):u;return t.value.walkModePath?m?m.map(u=>J(f(u),s)).flat():J(f(a),s):J(f(a),s)}),M=L([]),E=L(-1),T=L(!0),F=L(!1),I=L(!1),e=()=>b.tabList[t.value.tabIdx].panes[t.value.paneIdx];return{previewing:I,spinning:F,canLoadNext:T,multiSelectedIdxs:M,previewIdx:E,basePath:p,currLocation:l,currPage:i,stack:c,sortMethod:_,sortedFiles:P,scroller:L(),stackViewEl:L(),props:t,getPane:e,...Se()}},()=>({images:L()})),Dt=["detailList","largePreviewGrid","previewGrid"];function Lt(n,r){const{previewIdx:t,eventEmitter:i,canLoadNext:c,previewing:p,sortedFiles:l}=G().toRefs(),{state:_}=G(),P=V(()=>(r==null?void 0:r.scroller.value)??_.scroller);let M=null;const E=(e,a)=>{var s;p.value=e,M!=null&&!e&&a&&((s=P.value)==null||s.scrollToItem(M),M=null)},T=()=>{n.walkModePath&&!I("next")&&c&&(z.info(C("loadingNextFolder")),i.value.emit("loadNextDir",!0))};Y("keydown",e=>{var a;if(p.value){let s=t.value;if(["ArrowDown","ArrowRight"].includes(e.key))for(s++;l.value[s]&&!$(l.value[s].name);)s++;else if(["ArrowUp","ArrowLeft"].includes(e.key))for(s--;l.value[s]&&!$(l.value[s].name);)s--;if($((a=l.value[s])==null?void 0:a.name)??""){t.value=s;const m=P.value;m&&!(s>=m.$_startIndex&&s<=m.$_endIndex)&&(M=s)}T()}});const F=e=>{var s;let a=t.value;if(e==="next")for(a++;l.value[a]&&!$(l.value[a].name);)a++;else if(e==="prev")for(a--;l.value[a]&&!$(l.value[a].name);)a--;if($((s=l.value[a])==null?void 0:s.name)??""){t.value=a;const m=P.value;m&&!(a>=m.$_startIndex&&a<=m.$_endIndex)&&(M=a)}T()},I=e=>{var s;let a=t.value;if(e==="next")for(a++;l.value[a]&&!$(l.value[a].name);)a++;else if(e==="prev")for(a--;l.value[a]&&!$(l.value[a].name);)a--;return $((s=l.value[a])==null?void 0:s.name)??""};return ce("removeFiles",async()=>{var e;p.value&&!_.sortedFiles[t.value]&&(z.info(C("manualExitFullScreen"),5),await Q(500),(e=document.querySelector(".ant-image-preview-operations-operation .anticon-close"))==null||e.click(),t.value=-1)}),{previewIdx:t,onPreviewVisibleChange:E,previewing:p,previewImgMove:F,canPreview:I}}function Ct(n){const r=L(),{scroller:t,stackViewEl:i,stack:c,currPage:p,currLocation:l,sortMethod:_,useEventListen:P,eventEmitter:M,getPane:E,multiSelectedIdxs:T,sortedFiles:F}=G().toRefs();ie(()=>c.value.length,oe((o,v)=>{var y;o!==v&&((y=t.value)==null||y.scrollToItem(0))},300));const I=async o=>{if(await f(o),n.walkModePath){await Q();const[v]=J(p.value.files,_.value).filter(y=>y.type==="dir");v&&await f(v.fullpath),await M.value.emit("loadNextDir")}};Ge(async()=>{var o;if(!c.value.length){const v=await K("/");c.value.push({files:v.files,curr:"/"})}r.value=new Pt,r.value.configure({parent:i.value}),n.path&&n.path!=="/"?await I(n.walkModePath??n.path):(o=b.conf)!=null&&o.home&&f(b.conf.home)}),ie(l,oe(o=>{const v=E.value();v.path=o;const y=v.path.split("/").pop(),D=(()=>{var q;if(!n.walkModePath){const O=te(o);for(const[j,X]of Object.entries(b.pathAliasMap))if(O.startsWith(X))return O.replace(X,j);return y}return"Walk: "+(((q=b.quickMovePaths.find(O=>O.dir===v.walkModePath))==null?void 0:q.zh)??y)})();v.name=W("div",{style:"display:flex;align-items:center"},[W(St),W("span",{class:"line-clamp-1",style:"max-width: 256px"},D)]),v.nameFallbackStr=D,b.recent=b.recent.filter(q=>q.key!==v.key),b.recent.unshift({path:o,key:v.key}),b.recent.length>20&&(b.recent=b.recent.slice(0,20))},300));const e=()=>le(l.value),a=async o=>{var v,y;if(o.type==="dir")try{(v=r.value)==null||v.start();const{files:R}=await K(o.fullpath);c.value.push({files:R,curr:o.name})}finally{(y=r.value)==null||y.done()}},s=o=>{for(;o<c.value.length-1;)c.value.pop()},m=(o,v)=>(re(b.conf,"global.conf load failed"),b.conf.is_win?o.toLowerCase()==v.toLowerCase():o==v),f=async o=>{var y,R;const v=c.value.slice();try{je(o)||(o=fe(((y=b.conf)==null?void 0:y.sd_cwd)??"/",o));const D=ve(o),q=c.value.map(O=>O.curr);for(q.shift();q[0]&&D[0]&&m(q[0],D[0]);)q.shift(),D.shift();for(let O=0;O<q.length;O++)c.value.pop();if(!D.length)return d();for(const O of D){const j=(R=p.value)==null?void 0:R.files.find(X=>m(X.name,O));if(!j)throw console.error({frags:D,frag:O,stack:xe(c.value)}),new Error(`${O} not found`);await a(j)}}catch(D){throw z.error(C("moveFailedCheckPath")+(D instanceof Error?D.message:"")),console.error(o,ve(o),p.value),c.value=v,D}},d=pe(async()=>{var o,v,y;try{if((o=r.value)==null||o.start(),n.walkModePath)s(0),await I(n.walkModePath);else{const{files:R}=await K(c.value.length===1?"/":l.value);B(c.value).files=R}(v=t.value)==null||v.scrollToItem(0),z.success(C("refreshCompleted"))}finally{(y=r.value)==null||y.done()}});Be("returnToIIB",pe(async()=>{var o,v;if(!n.walkModePath)try{(o=r.value)==null||o.start();const{files:y}=await K(c.value.length===1?"/":l.value);B(c.value).files.map(D=>D.date).join()!==y.map(D=>D.date).join()&&(B(c.value).files=y,z.success(C("autoUpdate")))}finally{(v=r.value)==null||v.done()}})),P.value("refresh",d);const u=o=>{n.walkModePath&&(E.value().walkModePath=o),I(o)},w=V(()=>b.quickMovePaths.map(o=>({...o,path:te(o.dir)}))),k=V(()=>{const o=te(l.value);return w.value.find(y=>y.path===o)}),x=async()=>{const o=k.value;if(o){if(!o.can_delete)return;await ot(l.value),z.success(C("removeComplete"))}else await lt(l.value),z.success(C("addComplete"));ge.emit("searchIndexExpired"),ge.emit("updateGlobalSetting")},g=L(!1),N=L(l.value),U=()=>{g.value=!0,N.value=l.value},A=async()=>{await f(N.value),g.value=!1};Y("click",()=>{g.value=!1});const h=()=>{const o=parent.location,v=o.href.substring(0,o.href.length-o.search.length),y=new URLSearchParams(o.search);y.set("action","open"),y.set("path",l.value);const R=`${v}?${y.toString()}`;le(R,C("copyLocationUrlSuccessMsg"))},S=()=>{console.log(`select all 0 -> ${F.value.length}`),T.value=Pe(0,F.value.length)};return P.value("selectAll",S),{locInputValue:N,isLocationEditing:g,onLocEditEnter:A,onEditBtnClick:U,addToSearchScanPathAndQuickMove:x,searchPathInfo:k,refresh:d,copyLocation:e,back:s,openNext:a,currPage:p,currLocation:l,to:f,stack:c,scroller:t,share:h,selectAll:S,quickMoveTo:u}}function _t(n){const{scroller:r,sortedFiles:t,stack:i,sortMethod:c,currLocation:p,currPage:l,stackViewEl:_,canLoadNext:P,previewIdx:M}=G().toRefs(),{state:E}=G(),T=L(!1),F=L(b.defaultViewMode),I=272,e=64,a=I*2,{width:s}=He(_),m=V(()=>{const x=s.value;if(!(F.value==="detailList"||!x))return~~(x/(F.value==="previewGrid"?I:a))}),f=V(()=>{const x=F.value;if(x==="detailList")return{first:80,second:void 0};const g=x==="previewGrid"?I:a;return{first:g+e,second:g}}),d=L(!1),u=async()=>{var x;if(!(d.value||!n.walkModePath||!P.value))try{d.value=!0;const g=i.value[i.value.length-2],N=J(g.files,c.value),U=N.findIndex(A=>{var h;return A.name===((h=l.value)==null?void 0:h.curr)});if(U!==-1){const A=N[U+1],h=fe(p.value,"../",A.name),S=await K(h),o=l.value;o.curr=A.name,o.walkFiles||(o.walkFiles=[o.files]),o.walkFiles.push(S.files),console.log("curr page files length",(x=l.value)==null?void 0:x.files.length)}}catch(g){console.error("loadNextDir",g),P.value=!1}finally{d.value=!1}},w=async(x=!1)=>{const g=r.value,N=()=>x?M.value:(g==null?void 0:g.$_endIndex)??0;for(;!t.value.length||N()>t.value.length-20&&P.value;)await Q(100),await u()};E.useEventListen("loadNextDir",w);const k=oe(()=>w(),300);return{gridItems:m,sortedFiles:t,sortMethodConv:Ke,moreActionsDropdownShow:T,viewMode:F,gridSize:I,sortMethod:c,largeGridSize:a,onScroll:k,loadNextDir:u,loadNextDirLoading:d,canLoadNext:P,itemSize:f}}const Me=()=>W("p",{style:{background:"var(--zp-secondary-background)",padding:"8px",borderLeft:"4px solid var(--primary-color)"}},`Tips: ${C("multiSelectTips")}`);function Nt(){const{currLocation:n,sortedFiles:r,currPage:t,multiSelectedIdxs:i,eventEmitter:c}=G().toRefs(),p=()=>{i.value=[]};return Y("click",p),Y("blur",p),ie(t,p),{onFileDragStart:(M,E)=>{const T=xe(r.value[E]);ye.fileDragging=!0,console.log("onFileDragStart set drag file ",M,E,T);const F=[T];let I=T.type==="dir";if(i.value.includes(E)){const a=i.value.map(s=>r.value[s]);F.push(...a),I=a.some(s=>s.type==="dir")}const e={includeDir:I,loc:n.value||"search-result",path:me(F,"fullpath").map(a=>a.fullpath),nodes:me(F,"fullpath"),__id:"FileTransferData"};M.dataTransfer.setData("text/plain",JSON.stringify(e))},onDrop:async M=>{var T;const E=JSON.parse(((T=M.dataTransfer)==null?void 0:T.getData("text"))??"{}");if(Xe(E)){const F=n.value;if(E.loc===F)return;const I=W("div",[W("div",`${C("moveSelectedFilesTo")}${F}`),W("ol",{style:"max-height:50vh;overflow:auto;"},E.path.map(e=>e.split(/[/\\]/).pop()).map(e=>W("li",e))),Me()]);Ie.confirm({title:C("confirm")+"?",content:I,maskClosable:!0,async onOk(){await Fe(E.path,F),ae.emit("removeFiles",{paths:E.path,loc:E.loc}),await c.value.emit("refresh")}})}},multiSelectedIdxs:i,onFileDragEnd:()=>{ye.fileDragging=!1}}}function Ot(n,{openNext:r}){const t=L(!1),i=L(""),{sortedFiles:c,previewIdx:p,multiSelectedIdxs:l,stack:_,currLocation:P,spinning:M,previewing:E,stackViewEl:T,eventEmitter:F}=G().toRefs(),I=te;ce("removeFiles",({paths:f,loc:d})=>{if(I(d)!==I(P.value))return;const u=B(_.value);u&&(u.files=u.files.filter(w=>!f.includes(w.fullpath)),u.walkFiles&&(u.walkFiles=u.walkFiles.map(w=>w.filter(k=>!f.includes(k.fullpath)))))}),ce("addFiles",({files:f,loc:d})=>{if(I(d)!==I(P.value))return;const u=B(_.value);u&&u.files.unshift(...f)});const e=Je(),a=async(f,d,u)=>{p.value=u,b.fullscreenPreviewInitialUrl=H(d);const w=l.value.indexOf(u);if(f.shiftKey){if(w!==-1)l.value.splice(w,1);else{l.value.push(u),l.value.sort((g,N)=>g-N);const k=l.value[0],x=l.value[l.value.length-1];l.value=Pe(k,x+1)}f.stopPropagation()}else f.ctrlKey||f.metaKey?(w!==-1?l.value.splice(w,1):l.value.push(u),f.stopPropagation()):await r(d)},s=async(f,d,u)=>{var N,U,A;const w=H(d),k=P.value,x=()=>{let h=[];return l.value.includes(u)?h=l.value.map(S=>c.value[S]):h.push(d),h},g=async h=>{if(!M.value)try{M.value=!0,await nt(d.fullpath),be.postMessage("iib_hidden_img_update_trigger");const S=setTimeout(()=>st.warn({message:C("long_loading"),duration:20}),5e3);await rt(),clearTimeout(S),be.postMessage(`iib_hidden_tab_${h}`)}catch(S){console.error(S),z.error("发送图像失败，请携带console的错误消息找开发者")}finally{M.value=!1}};if(`${f.key}`.startsWith("toggle-tag-")){const h=+`${f.key}`.split("toggle-tag-")[1],{is_remove:S}=await ct({tag_id:h,img_path:d.fullpath}),o=(U=(N=b.conf)==null?void 0:N.all_custom_tags.find(v=>v.id===h))==null?void 0:U.name;z.success(C(S?"removedTagFromImage":"addedTagToImage",{tag:o}));return}switch(f.key){case"previewInNewWindow":return window.open(w);case"download":return window.open(H(d,!0));case"copyPreviewUrl":return le(parent.document.location.origin+w);case"send2txt2img":return g("txt2img");case"send2img2img":return g("img2img");case"send2inpaint":return g("inpaint");case"send2extras":return g("extras");case"send2savedDir":{const h=b.quickMovePaths.find(v=>v.key==="outdir_save");if(!h)return z.error(C("unknownSavedDir"));const S=at(h.dir,(A=b.conf)==null?void 0:A.sd_cwd),o=x();await Fe(o.map(v=>v.fullpath),S,!0),ae.emit("removeFiles",{paths:o.map(v=>v.fullpath),loc:P.value}),ae.emit("addFiles",{files:o,loc:S});break}case"send2controlnet-img2img":case"send2controlnet-txt2img":{const h=tt(),S=it(),o=f.key.split("-")[1];o==="img2img"?S.switch_to_img2img():S.switch_to_txt2img(),await Q(100);const y=h.querySelector(`#${o}_controlnet`).querySelector(".label-wrap");y.className.includes("open")||(y.click(),await Q(100)),y.scrollIntoView();const D=await(await fetch(H(d))).blob(),q=new File([D],"image.jpg",{type:D.type,lastModified:Date.now()}),O=new DataTransfer;O.items.add(q);const j=new ClipboardEvent("paste",{clipboardData:O,bubbles:!0});y.dispatchEvent(j);break}case"openWithWalkMode":{se.set(k,_.value);const h=b.tabList[n.tabIdx],S={type:"local",key:Z(),path:d.fullpath,name:C("local"),stackKey:k,walkModePath:d.fullpath};h.panes.push(S),h.key=S.key;break}case"openInNewTab":{se.set(k,_.value);const h=b.tabList[n.tabIdx],S={type:"local",key:Z(),path:d.fullpath,name:C("local"),stackKey:k};h.panes.push(S),h.key=S.key;break}case"openOnTheRight":{se.set(k,_.value);let h=b.tabList[n.tabIdx+1];h||(h={panes:[],key:"",id:Z()},b.tabList[n.tabIdx+1]=h);const S={type:"local",key:Z(),path:d.fullpath,name:C("local"),stackKey:k};h.panes.push(S),h.key=S.key;break}case"viewGenInfo":{t.value=!0,i.value=await e.pushAction(()=>et(d.fullpath)).res;break}case"openWithLocalFileBrowser":{await Ze(d.fullpath);break}case"deleteFiles":{const h=x();await new Promise(S=>{Ie.confirm({title:C("confirmDelete"),maskClosable:!0,content:W("div",[W("ol",{style:"max-height:50vh;overflow:auto;"},h.map(o=>o.fullpath.split(/[/\\]/).pop()).map(o=>W("li",o))),Me()]),async onOk(){const o=h.map(v=>v.fullpath);await xt(o),z.success(C("deleteSuccess")),ae.emit("removeFiles",{paths:o,loc:P.value}),S()}})});break}}return{}},{isOutside:m}=Qe(T);return Y("keydown",f=>{var u,w,k;const d=Ft(f);if(E.value){const x=(u=Object.entries(b.shortcut).find(g=>g[1]===d&&g[1]))==null?void 0:u[0];if(x){f.stopPropagation(),f.preventDefault();const g=p.value,N=c.value[g];switch(x){case"delete":return H(N)===b.fullscreenPreviewInitialUrl?z.warn(C("fullscreenRestriction")):s({key:"deleteFiles"},N,g);default:{const U=(w=/^toggle_tag_(.*)$/.exec(x))==null?void 0:w[1],A=(k=b.conf)==null?void 0:k.all_custom_tags.find(h=>h.name===U);return A?s({key:`toggle-tag-${A.id}`},N,g):void 0}}}}else!m.value&&["Ctrl + KeyA","Cmd + KeyA"].includes(d)&&(f.preventDefault(),f.stopPropagation(),F.value.emit("selectAll"))}),{onFileItemClick:a,onContextMenuClick:s,showGenInfo:t,imageGenInfo:i,q:e}}const At=()=>{const{stackViewEl:n}=G().toRefs(),r=L(-1);return Ye(n,t=>{var c;let i=t.target;for(;i.parentElement;)if(i=i.parentElement,i.tagName.toLowerCase()==="li"&&i.classList.contains("file-item-trigger")){const p=(c=i.dataset)==null?void 0:c.idx;p&&Number.isSafeInteger(+p)&&(r.value=+p);return}}),{showMenuIdx:r}};export{Ct as a,_t as b,Nt as c,Ot as d,Lt as e,At as f,Ft as g,ce as h,Y as i,B as l,se as s,ne as t,G as u,Dt as v};
