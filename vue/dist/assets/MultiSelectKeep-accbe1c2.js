import{ba as He,c as i,A as te,v as G,x as E,n as Ge,J as X,k as _e,t as Je,cd as Se,ce as Ke,c0 as we,ad as le,af as ee,cf as Qe,r as Z,cg as Ze,C as Ce,a9 as J,ch as Re,ci as et,R as x,a8 as tt,cj as he,I as se,ck as nt,E as ie,cl as lt,cm as at,cc as st,cn as ot,co as rt,o as it,d as Ve,W as Ue,cp as ct,B as R,L as Me,cq as Pe,l as Ie,N as L,O as S,Q as C,Z as h,X as oe,Y as y,cr as ut,U as q,T as Q,S as k,a2 as ve,aa as De,a1 as dt,cs as fe,a0 as vt,$ as ft,ag as pt,ct as mt,M as gt,cu as ht,cv as yt,aI as _t,aJ as wt,V as qe}from"./index-ad0dd244.js";import{u as ue,e as ye,g as W,f as Fe,h as ce,r as bt,t as pe,i as kt,s as me,j as re,_ as Ot}from"./FileItem-6f29e6ee.js";import{M as Xe,c as Lt,m as Ye,l as Ae,b as Et,d as $t}from"./functionalCallableComp-1718eb7b.js";import{C as xt,g as St}from"./shortcut-18f330b6.js";import{D as Ct}from"./index-e9423496.js";/* empty css              */const ae=(...e)=>{document.addEventListener(...e),He(()=>document.removeEventListener(...e))};var Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M855 160.1l-189.2 23.5c-6.6.8-9.3 8.8-4.7 13.5l54.7 54.7-153.5 153.5a8.03 8.03 0 000 11.3l45.1 45.1c3.1 3.1 8.2 3.1 11.3 0l153.6-153.6 54.7 54.7a7.94 7.94 0 0013.5-4.7L863.9 169a7.9 7.9 0 00-8.9-8.9zM416.6 562.3a8.03 8.03 0 00-11.3 0L251.8 715.9l-54.7-54.7a7.94 7.94 0 00-13.5 4.7L160.1 855c-.6 5.2 3.7 9.5 8.9 8.9l189.2-23.5c6.6-.8 9.3-8.8 4.7-13.5l-54.7-54.7 153.6-153.6c3.1-3.1 3.1-8.2 0-11.3l-45.2-45z"}}]},name:"arrows-alt",theme:"outlined"};const Pt=Mt;function Te(e){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(l).filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable}))),n.forEach(function(o){It(e,o,l[o])})}return e}function It(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var be=function(t,l){var n=Te({},t,l.attrs);return i(te,Te({},n,{icon:Pt}),null)};be.displayName="ArrowsAltOutlined";be.inheritAttrs=!1;const Dt=be;var Ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 00-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 00-11.3 0L405.6 242.3a7.23 7.23 0 005.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 00.1-11.4z"}}]},name:"drag",theme:"outlined"};const At=Ft;function ze(e){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(l).filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable}))),n.forEach(function(o){Tt(e,o,l[o])})}return e}function Tt(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var ke=function(t,l){var n=ze({},t,l.attrs);return i(te,ze({},n,{icon:At}),null)};ke.displayName="DragOutlined";ke.inheritAttrs=!1;const zt=ke;var Nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 000 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 00391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 00-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]},name:"fullscreen-exit",theme:"outlined"};const jt=Nt;function Ne(e){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(l).filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable}))),n.forEach(function(o){Wt(e,o,l[o])})}return e}function Wt(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var Oe=function(t,l){var n=Ne({},t,l.attrs);return i(te,Ne({},n,{icon:jt}),null)};Oe.displayName="FullscreenExitOutlined";Oe.inheritAttrs=!1;const Bt=Oe;var Ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0013.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 000 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 00-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]},name:"fullscreen",theme:"outlined"};const Vt=Ht;function je(e){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(l).filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable}))),n.forEach(function(o){Ut(e,o,l[o])})}return e}function Ut(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var Le=function(t,l){var n=je({},t,l.attrs);return i(te,je({},n,{icon:Vt}),null)};Le.displayName="FullscreenOutlined";Le.inheritAttrs=!1;const qt=Le;var Xt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M603.3 327.5l-246 178a7.95 7.95 0 000 12.9l246 178c5.3 3.8 12.7 0 12.7-6.5V643c0-10.2-4.9-19.9-13.2-25.9L457.4 512l145.4-105.2c8.3-6 13.2-15.6 13.2-25.9V334c0-6.5-7.4-10.3-12.7-6.5z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"left-circle",theme:"outlined"};const Yt=Xt;function We(e){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(l).filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable}))),n.forEach(function(o){Gt(e,o,l[o])})}return e}function Gt(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var Ee=function(t,l){var n=We({},t,l.attrs);return i(te,We({},n,{icon:Yt}),null)};Ee.displayName="LeftCircleOutlined";Ee.inheritAttrs=!1;const jn=Ee;var Jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M666.7 505.5l-246-178A8 8 0 00408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512 421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"right-circle",theme:"outlined"};const Kt=Jt;function Be(e){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(l).filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable}))),n.forEach(function(o){Qt(e,o,l[o])})}return e}function Qt(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var $e=function(t,l){var n=Be({},t,l.attrs);return i(te,Be({},n,{icon:Kt}),null)};$e.displayName="RightCircleOutlined";$e.inheritAttrs=!1;const Wn=$e,Zt="/infinite_image_browsing/fe-static/assets/fullscreen-7f54b926.svg";function Bn(){const{previewIdx:e,eventEmitter:t,canLoadNext:l,previewing:n,sortedFiles:o,scroller:m,props:$}=ue().toRefs(),{state:M}=ue();let D=null;const z=(p,c)=>{var f;n.value=p,D!=null&&!p&&c&&((f=m.value)==null||f.scrollToItem(D),D=null)},A=()=>{$.value.mode==="walk"&&!_("next")&&l&&(G.info(E("loadingNextFolder")),t.value.emit("loadNextDir",!0))};ae("keydown",p=>{var c;if(n.value){let f=e.value;if(["ArrowDown","ArrowRight"].includes(p.key))for(f++;o.value[f]&&!X(o.value[f].name);)f++;else if(["ArrowUp","ArrowLeft"].includes(p.key))for(f--;o.value[f]&&!X(o.value[f].name);)f--;if(X((c=o.value[f])==null?void 0:c.name)??""){e.value=f;const w=m.value;w&&!(f>=w.$_startIndex&&f<=w.$_endIndex)&&(D=f)}A()}});const P=p=>{var f;let c=e.value;if(p==="next")for(c++;o.value[c]&&!X(o.value[c].name);)c++;else if(p==="prev")for(c--;o.value[c]&&!X(o.value[c].name);)c--;if(X((f=o.value[c])==null?void 0:f.name)??""){e.value=c;const w=m.value;w&&!(c>=w.$_startIndex&&c<=w.$_endIndex)&&(D=c)}A()},_=p=>{var f;let c=e.value;if(p==="next")for(c++;o.value[c]&&!X(o.value[c].name);)c++;else if(p==="prev")for(c--;o.value[c]&&!X(o.value[c].name);)c--;return X((f=o.value[c])==null?void 0:f.name)??""};return ye("removeFiles",async()=>{var p;n.value&&!M.sortedFiles[e.value]&&(G.info(E("manualExitFullScreen"),5),await Ge(500),(p=document.querySelector(".ant-image-preview-operations-operation .anticon-close"))==null||p.click(),e.value=-1)}),{previewIdx:e,onPreviewVisibleChange:z,previewing:n,previewImgMove:P,canPreview:_}}function ge(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Qe(e)}function Hn(){const{currLocation:e,sortedFiles:t,currPage:l,multiSelectedIdxs:n,eventEmitter:o,walker:m}=ue().toRefs(),$=()=>{n.value=[]};return ae("click",()=>{W.keepMultiSelect||$()}),ae("blur",()=>{W.keepMultiSelect||$()}),_e(l,$),{onFileDragStart:(A,P)=>{const _=Je(t.value[P]);Fe.fileDragging=!0,console.log("onFileDragStart set drag file ",A,P,_);const p=[_];let c=_.type==="dir";if(n.value.includes(P)){const w=n.value.map(F=>t.value[F]);p.push(...w),c=w.some(F=>F.type==="dir")}const f={includeDir:c,loc:e.value||"search-result",path:Se(p,"fullpath").map(w=>w.fullpath),nodes:Se(p,"fullpath"),__id:"FileTransferData"};A.dataTransfer.setData("text/plain",JSON.stringify(f))},onDrop:async A=>{if(m.value)return;const P=Ke(A);if(!P)return;const _=e.value;if(P.loc===_)return;const p=we(),c=async()=>p.pushAction(async()=>{await Lt(P.path,_),o.value.emit("refresh"),le.destroyAll()}),f=()=>p.pushAction(async()=>{await Ye(P.path,_),ce.emit("removeFiles",{paths:P.path,loc:P.loc}),o.value.emit("refresh"),le.destroyAll()});le.confirm({title:E("confirm")+"?",width:"60vw",content:()=>{let w,F,s;return i("div",null,[i("div",null,[`${E("moveSelectedFilesTo")} ${_}`,i("ol",{style:{maxHeight:"50vh",overflow:"auto"}},[P.path.map(u=>i("li",null,[u.split(/[/\\]/).pop()]))])]),i(Xe,null,null),i("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},class:"actions"},[i(ee,{onClick:le.destroyAll},ge(w=E("cancel"))?w:{default:()=>[w]}),i(ee,{type:"primary",loading:!p.isIdle,onClick:c},ge(F=E("copy"))?F:{default:()=>[F]}),i(ee,{type:"primary",loading:!p.isIdle,onClick:f},ge(s=E("move"))?s:{default:()=>[s]})])])},maskClosable:!0,wrapClassName:"hidden-antd-btns-modal"})},multiSelectedIdxs:n,onFileDragEnd:()=>{Fe.fileDragging=!1}}}function Vn({openNext:e}){const t=Z(!1),l=Z(""),{sortedFiles:n,previewIdx:o,multiSelectedIdxs:m,stack:$,currLocation:M,spinning:D,previewing:z,stackViewEl:A,eventEmitter:P,props:_,deletedFiles:p}=ue().toRefs(),c=Ce;ye("removeFiles",({paths:u,loc:r})=>{c(r)!==c(M.value)||!Ae($.value)||(u.forEach(N=>p.value.add(N)),u.filter(X).forEach(N=>p.value.add(N.replace(/\.\w+$/,".txt"))))}),ye("addFiles",({files:u,loc:r})=>{if(c(r)!==c(M.value))return;const I=Ae($.value);I&&I.files.unshift(...u)});const f=we(),w=async(u,r,I)=>{o.value=I,W.fullscreenPreviewInitialUrl=J(r);const N=m.value.indexOf(I);if(u.shiftKey){if(N!==-1)m.value.splice(N,1);else{m.value.push(I),m.value.sort((a,d)=>a-d);const V=m.value[0],U=m.value[m.value.length-1];m.value=bt(V,U+1)}u.stopPropagation()}else u.ctrlKey||u.metaKey?(N!==-1?m.value.splice(N,1):m.value.push(I),u.stopPropagation()):await e(r)},F=async(u,r,I)=>{var H,O,Y;const N=J(r),V=M.value,U={IIB_container_id:parent.IIB_container_id},a=()=>{let v=[];return m.value.includes(I)?v=m.value.map(g=>n.value[g]):v.push(r),v},d=async v=>{if(!D.value)try{D.value=!0,await ot(r.fullpath),re.postMessage({...U,event:"click_hidden_button",btnEleId:"iib_hidden_img_update_trigger"}),await rt(),re.postMessage({...U,event:"click_hidden_button",btnEleId:`iib_hidden_tab_${v}`})}catch(g){console.error(g),G.error("发送图像失败，请携带console的错误消息找开发者")}finally{D.value=!1}},B=`${u.key}`;if(B.startsWith("toggle-tag-")){const v=+B.split("toggle-tag-")[1],{is_remove:g}=await Re({tag_id:v,img_path:r.fullpath}),j=(O=(H=W.conf)==null?void 0:H.all_custom_tags.find(T=>T.id===v))==null?void 0:O.name;await pe.refreshTags([r.fullpath]),G.success(E(g?"removedTagFromImage":"addedTagToImage",{tag:j}));return}else if(B.startsWith("batch-add-tag-")||B.startsWith("batch-remove-tag-")){const v=+B.split("-tag-")[1],g=B.includes("add")?"add":"remove",j=a().map(T=>T.fullpath);await et({tag_id:v,img_paths:j,action:g}),await pe.refreshTags(j),G.success(E(g==="add"?"addCompleted":"removeCompleted"));return}switch(u.key){case"previewInNewWindow":return window.open(N);case"saveSelectedAsJson":return st(a());case"openWithDefaultApp":return at(r.fullpath);case"download":{const v=a();lt(v.map(g=>J(g,!0)));break}case"copyPreviewUrl":return ie(parent.document.location.origin+N);case"rename":{let v=await Et(r.fullpath);v=Ce(v);const g=pe.tagMap;g.set(v,g.get(r.fullpath)??[]),g.delete(r.fullpath),r.fullpath=v,r.name=v.split(/[\\/]/).pop()??"";return}case"send2txt2img":return d("txt2img");case"send2img2img":return d("img2img");case"send2inpaint":return d("inpaint");case"send2extras":return d("extras");case"send2savedDir":{const v=W.quickMovePaths.find(T=>T.key==="outdir_save");if(!v)return G.error(E("unknownSavedDir"));const g=nt(v.dir,(Y=W.conf)==null?void 0:Y.sd_cwd),j=a();await Ye(j.map(T=>T.fullpath),g,!0),ce.emit("removeFiles",{paths:j.map(T=>T.fullpath),loc:M.value}),ce.emit("addFiles",{files:j,loc:g});break}case"send2controlnet-img2img":case"send2controlnet-txt2img":{const v=u.key.split("-")[1];re.postMessage({...U,event:"send_to_control_net",type:v,url:J(r)});break}case"send2outpaint":{l.value=await f.pushAction(()=>he(r.fullpath)).res;const[v,g]=(l.value||"").split(`
`);re.postMessage({...U,event:"send_to_outpaint",url:J(r),prompt:v,negPrompt:g.slice(17)});break}case"openWithWalkMode":{me.set(V,$.value);const v=W.tabList[_.value.tabIdx],g={type:"local",key:se(),path:r.fullpath,name:E("local"),stackKey:V,mode:"walk"};v.panes.push(g),v.key=g.key;break}case"openInNewTab":{me.set(V,$.value);const v=W.tabList[_.value.tabIdx],g={type:"local",key:se(),path:r.fullpath,name:E("local"),stackKey:V};v.panes.push(g),v.key=g.key;break}case"openOnTheRight":{me.set(V,$.value);let v=W.tabList[_.value.tabIdx+1];v||(v={panes:[],key:"",id:se()},W.tabList[_.value.tabIdx+1]=v);const g={type:"local",key:se(),path:r.fullpath,name:E("local"),stackKey:V};v.panes.push(g),v.key=g.key;break}case"send2BatchDownload":{kt.addFiles(a());break}case"viewGenInfo":{t.value=!0,l.value=await f.pushAction(()=>he(r.fullpath)).res;break}case"openWithLocalFileBrowser":{await tt(r.fullpath);break}case"deleteFiles":{const v=a(),g=async()=>{const j=v.map(T=>T.fullpath);await $t(j),G.success(E("deleteSuccess")),ce.emit("removeFiles",{paths:j,loc:M.value})};if(v.length===1&&W.ignoredConfirmActions.deleteOneOnly)return g();await new Promise(j=>{le.confirm({title:E("confirmDelete"),maskClosable:!0,width:"60vw",content:()=>i("div",null,[i("ol",{style:{maxHeight:"50vh",overflow:"auto"}},[v.map(T=>i("li",null,[T.fullpath.split(/[/\\]/).pop()]))]),i(Xe,null,null),i(xt,{checked:W.ignoredConfirmActions.deleteOneOnly,"onUpdate:checked":T=>W.ignoredConfirmActions.deleteOneOnly=T},{default:()=>[E("deleteOneOnlySkipConfirm"),x(" ("),E("resetOnGlobalSettingsPage"),x(")")]})]),async onOk(){await g(),j()}})});break}}return{}},{isOutside:s}=Ze(A);return ae("keydown",u=>{var I,N,V;const r=St(u);if(z.value){const U=(I=Object.entries(W.shortcut).find(a=>a[1]===r&&a[1]))==null?void 0:I[0];if(U){u.stopPropagation(),u.preventDefault();const a=o.value,d=n.value[a];switch(U){case"delete":return J(d)===W.fullscreenPreviewInitialUrl?G.warn(E("fullscreenRestriction")):F({key:"deleteFiles"},d,a);case"download":return F({key:"download"},d,a);default:{const B=(N=/^toggle_tag_(.*)$/.exec(U))==null?void 0:N[1],H=(V=W.conf)==null?void 0:V.all_custom_tags.find(O=>O.name===B);return H?F({key:`toggle-tag-${H.id}`},d,a):void 0}}}}else!s.value&&["Ctrl + KeyA","Cmd + KeyA"].includes(r)&&(u.preventDefault(),u.stopPropagation(),P.value.emit("selectAll"))}),{onFileItemClick:w,onContextMenuClick:F,showGenInfo:t,imageGenInfo:l,q:f}}function Rt(e,t,l,n){let o=0,m=0,$=typeof(n==null?void 0:n.width)=="number"?n.width:0,M=typeof(n==null?void 0:n.height)=="number"?n.height:0,D=typeof(n==null?void 0:n.left)=="number"?n.left:0,z=typeof(n==null?void 0:n.top)=="number"?n.top:0,A=!1;const P=s=>{s.stopPropagation(),s.preventDefault(),!(!e.value||!t.value)&&(o=s instanceof MouseEvent?s.clientX:s.touches[0].clientX,m=s instanceof MouseEvent?s.clientY:s.touches[0].clientY,$=e.value.offsetWidth,M=e.value.offsetHeight,t.value.offsetLeft,t.value.offsetTop,document.documentElement.addEventListener("mousemove",_),document.documentElement.addEventListener("touchmove",_),document.documentElement.addEventListener("mouseup",p),document.documentElement.addEventListener("touchend",p))},_=s=>{if(!e.value||!t.value)return;let u=$+((s instanceof MouseEvent?s.clientX:s.touches[0].clientX)-o),r=M+((s instanceof MouseEvent?s.clientY:s.touches[0].clientY)-m);e.value.offsetLeft+u>window.innerWidth&&(u=window.innerWidth-e.value.offsetLeft),e.value.offsetTop+r>window.innerHeight&&(r=window.innerHeight-e.value.offsetTop),e.value.style.width=`${u}px`,e.value.style.height=`${r}px`,n!=null&&n.onResize&&n.onResize(u,r)},p=()=>{document.documentElement.removeEventListener("mousemove",_),document.documentElement.removeEventListener("touchmove",_),document.documentElement.removeEventListener("mouseup",p),document.documentElement.removeEventListener("touchend",p)},c=s=>{s.stopPropagation(),s.preventDefault(),!(!e.value||!l.value)&&(A=!0,D=e.value.offsetLeft,z=e.value.offsetTop,o=s instanceof MouseEvent?s.clientX:s.touches[0].clientX,m=s instanceof MouseEvent?s.clientY:s.touches[0].clientY,document.documentElement.addEventListener("mousemove",f),document.documentElement.addEventListener("touchmove",f),document.documentElement.addEventListener("mouseup",w),document.documentElement.addEventListener("touchend",w))},f=s=>{if(!e.value||!l.value||!A)return;const u=D+((s instanceof MouseEvent?s.clientX:s.touches[0].clientX)-o),r=z+((s instanceof MouseEvent?s.clientY:s.touches[0].clientY)-m);u<0?e.value.style.left="0px":u+e.value.offsetWidth>window.innerWidth?e.value.style.left=`${window.innerWidth-e.value.offsetWidth}px`:e.value.style.left=`${u}px`,r<0?e.value.style.top="0px":r+e.value.offsetHeight>window.innerHeight?e.value.style.top=`${window.innerHeight-e.value.offsetHeight}px`:e.value.style.top=`${r}px`,n!=null&&n.onDrag&&n.onDrag(u,r)},w=()=>{A=!1,document.documentElement.removeEventListener("mousemove",f),document.documentElement.removeEventListener("touchmove",f),document.documentElement.removeEventListener("mouseup",w),document.documentElement.removeEventListener("touchend",w)},F=()=>{if(!e.value||!t.value)return;let s=e.value.offsetLeft,u=e.value.offsetTop,r=e.value.offsetWidth,I=e.value.offsetHeight;s+r>window.innerWidth&&(s=window.innerWidth-r,s<0&&(s=0,r=window.innerWidth)),u+I>window.innerHeight&&(u=window.innerHeight-I,u<0&&(u=0,I=window.innerHeight)),e.value.style.left=`${s}px`,e.value.style.top=`${u}px`,e.value.style.width=`${r}px`,e.value.style.height=`${I}px`};return it(()=>{!e.value||!n||(typeof n.width=="number"&&(e.value.style.width=`${n.width}px`),typeof n.height=="number"&&(e.value.style.height=`${n.height}px`),typeof n.left=="number"&&(e.value.style.left=`${n.left}px`),typeof n.top=="number"&&(e.value.style.top=`${n.top}px`),F(),window.addEventListener("resize",F))}),He(()=>{document.documentElement.removeEventListener("mousemove",_),document.documentElement.removeEventListener("touchmove",_),document.documentElement.removeEventListener("mouseup",p),document.documentElement.removeEventListener("touchend",p),document.documentElement.removeEventListener("mousemove",f),document.documentElement.removeEventListener("touchmove",f),document.documentElement.removeEventListener("mouseup",w),document.documentElement.removeEventListener("touchend",w),window.removeEventListener("resize",F)}),_e(()=>[e.value,t.value,l.value],([s,u,r])=>{s&&u&&(u.addEventListener("mousedown",P),u.addEventListener("touchstart",P)),s&&r&&(r.addEventListener("mousedown",c),r.addEventListener("touchstart",c))}),{handleResizeMouseDown:P,handleDragMouseDown:c}}const ne=e=>(_t("data-v-82cb05dc"),e=e(),wt(),e),en={class:"container"},tn={class:"action-bar"},nn=["title"],ln=["title"],an=["title"],sn=["src"],on={key:0,class:"icon",style:{cursor:"pointer"}},rn={key:0,"flex-placeholder":""},cn={key:1,class:"action-bar"},un={key:0,class:"gen-info"},dn={class:"info-tags"},vn={class:"name"},fn={class:"value"},pn={key:0,class:"tags-container"},mn=["onClick"],gn=ne(()=>C("br",null,null,-1)),hn=ne(()=>C("h3",null,"Prompt",-1)),yn=["innerHTML"],_n=ne(()=>C("br",null,null,-1)),wn=ne(()=>C("h3",null,"Negative Prompt",-1)),bn=["innerHTML"],kn=ne(()=>C("br",null,null,-1)),On=ne(()=>C("h3",null,"Params",-1)),Ln={style:{"font-weight":"600","text-transform":"capitalize"}},En=["onDblclick"],$n=["onDblclick"],xn=["title"],Sn=Ve({__name:"fullScreenContextMenu",props:{file:{},idx:{}},emits:["contextMenuClick"],setup(e,{emit:t}){const l=e,n=Ue(),o=ct(),m=Z(),$=R(()=>o.tagMap.get(l.file.fullpath)??[]),M=Z(""),D=we(),z=Z(""),A=R(()=>z.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),P=R(()=>A.value.split(`
`)),_=R(()=>Me(A.value)),p=R(()=>{let a=Me(A.value);return delete a.prompt,delete a.negativePrompt,a});_e(()=>{var a;return(a=l==null?void 0:l.file)==null?void 0:a.fullpath},async a=>{a&&(D.tasks.forEach(d=>d.cancel()),D.pushAction(()=>he(a)).res.then(d=>{z.value=d}))},{immediate:!0});const c=Pe("iib@fullScreenContextMenu.prompt-tab","structedData"),f=Z(),w=Z(),F={left:100,top:100,width:512,height:384,expanded:!0},s=Pe("fullScreenContextMenu.vue-drag",F);s.value&&(s.value.left<0||s.value.top<0)&&(s.value={...F}),Rt(m,f,w,{...s.value,onDrag:Ie(function(a,d){s.value={...s.value,left:a,top:d}},300),onResize:Ie(function(a,d){s.value={...s.value,width:a,height:d}},300)});function u(a){return a.parentNode}function r(a){if(!a)return"";let d="";const B=a.split(/[\n,]+/).map(O=>O.trim()).filter(O=>O);let H=!1;for(let O=0;O<B.length;O++){const Y=B[O];H||(H=Y.includes("(")),d+=`<span class="${H?"has-parentheses":""}">${Y}</span>`,O<B.length-1&&(d+=","),H&&(H=!Y.includes(")"))}return d}ae("load",a=>{const d=a.target;d.className==="ant-image-preview-img"&&(M.value=`${d.naturalWidth} x ${d.naturalHeight}`)},{capture:!0});const I=R(()=>{const a=[{name:E("fileName"),val:l.file.name},{name:E("fileSize"),val:l.file.size}];return M.value&&a.push({name:E("resolution"),val:M.value}),a}),N=()=>{const a="Negative prompt:",d=z.value.includes(a)?z.value.split(a)[0]:P.value[0]??"";ie(fe(d.trim()))},V=()=>document.body.requestFullscreen(),U=a=>{ie(typeof a=="object"?JSON.stringify(a,null,4):a)};return(a,d)=>{var xe;const B=Ct,H=ee,O=pt,Y=mt,v=gt,g=ee,j=ht,T=yt;return L(),S("div",{ref_key:"el",ref:m,class:De(["full-screen-menu",{"unset-size":!h(s).expanded}]),onWheelCapture:d[6]||(d[6]=ft(()=>{},["stop"]))},[C("div",en,[C("div",tn,[C("div",{ref_key:"dragHandle",ref:w,class:"icon",style:{cursor:"grab"},title:h(E)("dragToMovePanel")},[i(h(zt))],8,nn),C("div",{class:"icon",style:{cursor:"pointer"},onClick:d[0]||(d[0]=b=>h(s).expanded=!h(s).expanded),title:h(E)("clickToToggleMaximizeMinimize")},[h(s).expanded?(L(),oe(h(Bt),{key:0})):(L(),oe(h(qt),{key:1}))],8,ln),C("div",{style:{display:"flex","flex-direction":"column","align-items":"center",cursor:"grab"},class:"icon",title:h(E)("fullscreenview"),onClick:V},[C("img",{src:h(Zt),style:{width:"21px",height:"21px","padding-bottom":"2px"},alt:""},null,8,sn)],8,an),i(B,{"get-popup-container":u},{overlay:y(()=>[i(Ot,{file:a.file,idx:a.idx,"selected-tag":$.value,"disable-delete":h(J)(a.file)===h(n).fullscreenPreviewInitialUrl,onContextMenuClick:d[1]||(d[1]=(b,K,de)=>t("contextMenuClick",b,K,de))},null,8,["file","idx","selected-tag","disable-delete"])]),default:y(()=>[h(s).expanded?q("",!0):(L(),S("div",on,[i(h(ut))]))]),_:1}),h(s).expanded?(L(),S("div",rn)):q("",!0),h(s).expanded?(L(),S("div",cn,[i(B,{trigger:["hover"],"get-popup-container":u},{overlay:y(()=>[i(v,{onClick:d[2]||(d[2]=b=>t("contextMenuClick",b,a.file,a.idx))},{default:y(()=>{var b;return[((b=h(n).conf)==null?void 0:b.launch_mode)!=="server"?(L(),S(Q,{key:0},[i(O,{key:"send2txt2img"},{default:y(()=>[x(k(a.$t("sendToTxt2img")),1)]),_:1}),i(O,{key:"send2img2img"},{default:y(()=>[x(k(a.$t("sendToImg2img")),1)]),_:1}),i(O,{key:"send2inpaint"},{default:y(()=>[x(k(a.$t("sendToInpaint")),1)]),_:1}),i(O,{key:"send2extras"},{default:y(()=>[x(k(a.$t("sendToExtraFeatures")),1)]),_:1}),i(Y,{key:"sendToThirdPartyExtension",title:a.$t("sendToThirdPartyExtension")},{default:y(()=>[i(O,{key:"send2controlnet-txt2img"},{default:y(()=>[x("ControlNet - "+k(a.$t("t2i")),1)]),_:1}),i(O,{key:"send2controlnet-img2img"},{default:y(()=>[x("ControlNet - "+k(a.$t("i2i")),1)]),_:1}),i(O,{key:"send2outpaint"},{default:y(()=>[x("openOutpaint")]),_:1})]),_:1},8,["title"])],64)):q("",!0),i(O,{key:"send2BatchDownload"},{default:y(()=>[x(k(a.$t("sendToBatchDownload")),1)]),_:1}),i(O,{key:"send2savedDir"},{default:y(()=>[x(k(a.$t("send2savedDir")),1)]),_:1}),i(O,{key:"deleteFiles",disabled:h(J)(a.file)===h(n).fullscreenPreviewInitialUrl},{default:y(()=>[x(k(a.$t("deleteSelected")),1)]),_:1},8,["disabled"]),i(O,{key:"previewInNewWindow"},{default:y(()=>[x(k(a.$t("previewInNewWindow")),1)]),_:1}),i(O,{key:"copyPreviewUrl"},{default:y(()=>[x(k(a.$t("copySourceFilePreviewLink")),1)]),_:1})]}),_:1})]),default:y(()=>[i(H,null,{default:y(()=>[x(k(h(E)("openContextMenu")),1)]),_:1})]),_:1}),i(g,{onClick:d[3]||(d[3]=b=>t("contextMenuClick",{key:"download"},l.file,l.idx))},{default:y(()=>[x(k(a.$t("download")),1)]),_:1}),z.value?(L(),oe(H,{key:0,onClick:d[4]||(d[4]=b=>h(ie)(z.value))},{default:y(()=>[x(k(a.$t("copyPrompt")),1)]),_:1})):q("",!0),z.value?(L(),oe(H,{key:1,onClick:N},{default:y(()=>[x(k(a.$t("copyPositivePrompt")),1)]),_:1})):q("",!0)])):q("",!0)]),h(s).expanded?(L(),S("div",un,[C("div",dn,[(L(!0),S(Q,null,ve(I.value,b=>(L(),S("span",{class:"info-tag",key:b.name},[C("span",vn,k(b.name),1),C("span",fn,k(b.val),1)]))),128))]),(xe=h(n).conf)!=null&&xe.all_custom_tags?(L(),S("div",pn,[(L(!0),S(Q,null,ve(h(n).conf.all_custom_tags,b=>(L(),S("div",{class:De(["tag",{selected:$.value.some(K=>K.id===b.id)}]),onClick:K=>t("contextMenuClick",{key:`toggle-tag-${b.id}`},a.file,a.idx),key:b.id,style:dt({"--tag-color":h(o).getColor(b.name)})},k(b.name),15,mn))),128))])):q("",!0),i(T,{activeKey:h(c),"onUpdate:activeKey":d[5]||(d[5]=b=>vt(c)?c.value=b:null)},{default:y(()=>[i(j,{key:"structedData",tab:a.$t("structuredData")},{default:y(()=>[C("div",null,[_.value.prompt?(L(),S(Q,{key:0},[gn,hn,C("code",{innerHTML:r(_.value.prompt??"")},null,8,yn)],64)):q("",!0),_.value.negativePrompt?(L(),S(Q,{key:1},[_n,wn,C("code",{innerHTML:r(_.value.negativePrompt??"")},null,8,bn)],64)):q("",!0)]),Object.keys(p.value).length?(L(),S(Q,{key:0},[kn,On,C("table",null,[(L(!0),S(Q,null,ve(p.value,(b,K)=>(L(),S("tr",{key:K,class:"gen-info-frag"},[C("td",Ln,k(K),1),typeof b=="object"?(L(),S("td",{key:0,style:{cursor:"pointer"},onDblclick:de=>U(b)},[C("code",null,k(b),1)],40,En)):(L(),S("td",{key:1,style:{cursor:"pointer"},onDblclick:de=>U(h(fe)(b))},k(h(fe)(b)),41,$n))]))),128))])],64)):q("",!0)]),_:1},8,["tab"]),i(j,{key:"sourceText",tab:a.$t("sourceText")},{default:y(()=>[C("code",null,k(z.value),1)]),_:1},8,["tab"])]),_:1},8,["activeKey"])])):q("",!0)]),h(s).expanded?(L(),S("div",{key:0,class:"mouse-sensor",ref_key:"resizeHandle",ref:f,title:h(E)("dragToResizePanel")},[i(h(Dt))],8,xn)):q("",!0)],34)}}});const Un=qe(Sn,[["__scopeId","data-v-82cb05dc"]]),Cn={key:0,class:"float-panel"},Mn={key:0,class:"select-actions"},Pn={key:1},In=Ve({__name:"MultiSelectKeep",props:{show:{type:Boolean}},emits:["selectAll","reverseSelect","clearAllSelected"],setup(e,{emit:t}){const l=Ue(),n=()=>{t("clearAllSelected"),l.keepMultiSelect=!1},o=()=>{l.keepMultiSelect=!0};return(m,$)=>{const M=ee;return m.show?(L(),S("div",Cn,[h(l).keepMultiSelect?(L(),S("div",Mn,[i(M,{size:"small",onClick:$[0]||($[0]=D=>t("selectAll"))},{default:y(()=>[x(k(m.$t("select-all")),1)]),_:1}),i(M,{size:"small",onClick:$[1]||($[1]=D=>t("reverseSelect"))},{default:y(()=>[x(k(m.$t("rerverse-select")),1)]),_:1}),i(M,{size:"small",onClick:$[2]||($[2]=D=>t("clearAllSelected"))},{default:y(()=>[x(k(m.$t("clear-all-selected")),1)]),_:1}),i(M,{size:"small",onClick:n},{default:y(()=>[x(k(m.$t("exit")),1)]),_:1})])):(L(),S("div",Pn,[i(M,{size:"small",type:"primary",onClick:o},{default:y(()=>[x(k(m.$t("keep-multi-selected")),1)]),_:1})]))])):q("",!0)}}});const qn=qe(In,[["__scopeId","data-v-b04c3508"]]);export{jn as L,qn as M,Wn as R,Hn as a,Vn as b,Bn as c,Un as f,ae as u};
