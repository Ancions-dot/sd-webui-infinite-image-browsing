import{P as j,a2 as Ae,d as Z,bg as me,aK as $e,v as U,bE as xe,s as ke,u as he,ag as X,a0 as ne,h as k,c as v,a as J,bF as we,b as Se,f as Pe,bG as Oe,bn as re,bH as Te,aC as Be,i as Ne,aS as Ee,bI as Ke,bJ as Me,bK as Re,bL as De,a4 as Fe,aF as je,aD as Ue,bM as ze,aE as Le,bN as Ve,o as b,k as S,l as I,t as x,z as W,B as T,bO as Ge,p as Q,m as G,C as ye,bP as qe,R as _e,q as be,r as He,bQ as We,bd as Qe,ai as Xe,au as Je,bR as ce,bS as Ye,a3 as Ze,bT as de,bU as ea,bV as aa,n as te,S as oe,A as F,I as ue,ah as ta,bW as na,a9 as ve,a6 as se,V as la,bX as oa,X as pe,bY as sa,W as ia,bZ as ra,b_ as ca}from"./index-92bea2a2.js";import{S as da}from"./index-92b2c992.js";/* empty css              *//* empty css              */var ua=function(){return{prefixCls:String,activeKey:{type:[Array,Number,String]},defaultActiveKey:{type:[Array,Number,String]},accordion:{type:Boolean,default:void 0},destroyInactivePanel:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},expandIcon:Function,openAnimation:j.object,expandIconPosition:j.oneOf(Ae("left","right")),collapsible:{type:String},ghost:{type:Boolean,default:void 0},onChange:Function,"onUpdate:activeKey":Function}},Ce=function(){return{openAnimation:j.object,prefixCls:String,header:j.any,headerClass:String,showArrow:{type:Boolean,default:void 0},isActive:{type:Boolean,default:void 0},destroyInactivePanel:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},accordion:{type:Boolean,default:void 0},forceRender:{type:Boolean,default:void 0},expandIcon:Function,extra:j.any,panelKey:j.oneOfType([j.string,j.number]),collapsible:{type:String},role:String,onItemClick:{type:Function}}};function fe(o){var e=o;if(!Array.isArray(e)){var a=Se(e);e=a==="number"||a==="string"?[e]:[]}return e.map(function(n){return String(n)})}const Y=Z({compatConfig:{MODE:3},name:"ACollapse",inheritAttrs:!1,props:me(ua(),{accordion:!1,destroyInactivePanel:!1,bordered:!0,openAnimation:$e("ant-motion-collapse",!1),expandIconPosition:"left"}),slots:["expandIcon"],setup:function(e,a){var n=a.attrs,r=a.slots,s=a.emit,l=U(fe(xe([e.activeKey,e.defaultActiveKey])));ke(function(){return e.activeKey},function(){l.value=fe(e.activeKey)},{deep:!0});var g=he("collapse",e),m=g.prefixCls,P=g.direction,O=X(function(){var f=e.expandIconPosition;return f!==void 0?f:P.value==="rtl"?"right":"left"}),w=function(c){var d=e.expandIcon,C=d===void 0?r.expandIcon:d,_=C?C(c):v(Te,{rotate:c.isActive?90:void 0},null);return v("div",null,[Be(Array.isArray(C)?_[0]:_)?re(_,{class:"".concat(m.value,"-arrow")},!1):_])},K=function(c){e.activeKey===void 0&&(l.value=c);var d=e.accordion?c[0]:c;s("update:activeKey",d),s("change",d)},h=function(c){var d=l.value;if(e.accordion)d=d[0]===c?[]:[c];else{d=Ne(d);var C=d.indexOf(c),_=C>-1;_?d.splice(C,1):d.push(c)}K(d)},z=function(c,d){var C,_,M;if(!Oe(c)){var q=l.value,B=e.accordion,R=e.destroyInactivePanel,t=e.collapsible,i=e.openAnimation,p=String((C=c.key)!==null&&C!==void 0?C:d),A=c.props||{},y=A.header,N=y===void 0?(_=c.children)===null||_===void 0||(M=_.header)===null||M===void 0?void 0:M.call(_):y,E=A.headerClass,D=A.collapsible,H=A.disabled,V=!1;B?V=q[0]===p:V=q.indexOf(p)>-1;var u=D??t;(H||H==="")&&(u="disabled");var ee={key:p,panelKey:p,header:N,headerClass:E,isActive:V,prefixCls:m.value,destroyInactivePanel:R,openAnimation:i,accordion:B,onItemClick:u==="disabled"?null:h,expandIcon:w,collapsible:u};return re(c,ee)}},L=function(){var c;return Pe((c=r.default)===null||c===void 0?void 0:c.call(r)).map(z)};return function(){var f,c=e.accordion,d=e.bordered,C=e.ghost,_=ne((f={},k(f,m.value,!0),k(f,"".concat(m.value,"-borderless"),!d),k(f,"".concat(m.value,"-icon-position-").concat(O.value),!0),k(f,"".concat(m.value,"-rtl"),P.value==="rtl"),k(f,"".concat(m.value,"-ghost"),!!C),k(f,n.class,!!n.class),f));return v("div",J(J({class:_},we(n)),{},{style:n.style,role:c?"tablist":null}),[L()])}}}),va=Z({compatConfig:{MODE:3},name:"PanelContent",props:Ce(),setup:function(e,a){var n=a.slots,r=U(!1);return Ee(function(){(e.isActive||e.forceRender)&&(r.value=!0)}),function(){var s,l;if(!r.value)return null;var g=e.prefixCls,m=e.isActive,P=e.role;return v("div",{ref:U,class:ne("".concat(g,"-content"),(s={},k(s,"".concat(g,"-content-active"),m),k(s,"".concat(g,"-content-inactive"),!m),s)),role:P},[v("div",{class:"".concat(g,"-content-box")},[(l=n.default)===null||l===void 0?void 0:l.call(n)])])}}}),le=Z({compatConfig:{MODE:3},name:"ACollapsePanel",inheritAttrs:!1,props:me(Ce(),{showArrow:!0,isActive:!1,onItemClick:function(){},headerClass:"",forceRender:!1}),slots:["expandIcon","extra","header"],setup:function(e,a){var n=a.slots,r=a.emit,s=a.attrs;Ke(e.disabled===void 0,"Collapse.Panel",'`disabled` is deprecated. Please use `collapsible="disabled"` instead.');var l=he("collapse",e),g=l.prefixCls,m=function(){r("itemClick",e.panelKey)},P=function(w){(w.key==="Enter"||w.keyCode===13||w.which===13)&&m()};return function(){var O,w,K,h,z=e.header,L=z===void 0?(O=n.header)===null||O===void 0?void 0:O.call(n):z,f=e.headerClass,c=e.isActive,d=e.showArrow,C=e.destroyInactivePanel,_=e.accordion,M=e.forceRender,q=e.openAnimation,B=e.expandIcon,R=B===void 0?n.expandIcon:B,t=e.extra,i=t===void 0?(w=n.extra)===null||w===void 0?void 0:w.call(n):t,p=e.collapsible,A=p==="disabled",y=g.value,N=ne("".concat(y,"-header"),(K={},k(K,f,f),k(K,"".concat(y,"-header-collapsible-only"),p==="header"),K)),E=ne((h={},k(h,"".concat(y,"-item"),!0),k(h,"".concat(y,"-item-active"),c),k(h,"".concat(y,"-item-disabled"),A),k(h,"".concat(y,"-no-arrow"),!d),k(h,"".concat(s.class),!!s.class),h)),D=v("i",{class:"arrow"},null);d&&typeof R=="function"&&(D=R(e));var H=Me(v(va,{prefixCls:y,isActive:c,forceRender:M,role:_?"tabpanel":null},{default:n.default}),[[Re,c]]),V=J({appear:!1,css:!1},q);return v("div",J(J({},s),{},{class:E}),[v("div",{class:N,onClick:function(){return p!=="header"&&m()},role:_?"tab":"button",tabindex:A?-1:0,"aria-expanded":c,onKeypress:P},[d&&D,p==="header"?v("span",{onClick:m,class:"".concat(y,"-header-text")},[L]):L,i&&v("div",{class:"".concat(y,"-extra")},[i])]),v(De,V,{default:function(){return[!C||c?H:null]}})])}}});Y.Panel=le;Y.install=function(o){return o.component(Y.name,Y),o.component(le.name,le),o};var pa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"};const fa=pa;function ge(o){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),n.forEach(function(r){ga(o,r,a[r])})}return o}function ga(o,e,a){return e in o?Object.defineProperty(o,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[e]=a,o}var ie=function(e,a){var n=ge({},e,a.attrs);return v(Fe,ge({},n,{icon:fa}),null)};ie.displayName="ArrowRightOutlined";ie.inheritAttrs=!1;const ma=ie;function ha(o,e,a,n){for(var r=-1,s=o==null?0:o.length;++r<s;){var l=o[r];e(n,l,a(l),o)}return n}function ya(o){return function(e,a,n){for(var r=-1,s=Object(e),l=n(e),g=l.length;g--;){var m=l[o?g:++r];if(a(s[m],m,s)===!1)break}return e}}var _a=ya();const ba=_a;function Ca(o,e){return o&&ba(o,e,je)}function Ia(o,e){return function(a,n){if(a==null)return a;if(!Ue(a))return o(a,n);for(var r=a.length,s=e?r:-1,l=Object(a);(e?s--:++s<r)&&n(l[s],s,l)!==!1;);return a}}var Aa=Ia(Ca);const $a=Aa;function xa(o,e,a,n){return $a(o,function(r,s,l){e(n,r,a(r),l)}),n}function ka(o,e){return function(a,n){var r=ze(a)?ha:xa,s=e?e():{};return r(a,o,Le(n),s)}}var wa=Object.prototype,Sa=wa.hasOwnProperty,Pa=ka(function(o,e,a){Sa.call(o,a)?o[a].push(e):Ve(o,a,[e])});const Oa=Pa;const Ta={class:"tag-wrap"},Ba={class:"float-actions"},Na=["title"],Ea=Z({__name:"TagSearchItem",props:{tag:{},name:{},selected:{type:Boolean},idx:{}},emits:["remove","toggleAnd","toggleNot","toggleOr","click"],setup(o){const e=(a,n=!1)=>(n?`[${a.type}] `:"")+(a.display_name?`${a.display_name} : ${a.name}`:a.name);return(a,n)=>(b(),S("div",Ta,[I("div",Ba,[I("button",{size:"small",onClick:n[0]||(n[0]=r=>a.$emit("toggleAnd"))},x(a.$t("exactMatch")),1),I("button",{size:"small",onClick:n[1]||(n[1]=r=>a.$emit("toggleOr"))},x(a.$t("anyMatch")),1),I("button",{size:"small",onClick:n[2]||(n[2]=r=>a.$emit("toggleNot"))},x(a.$t("exclude")),1)]),I("li",{class:_e(["tag",{selected:a.selected}]),title:e(a.tag),onClick:n[4]||(n[4]=r=>a.$emit("click"))},[a.selected?(b(),W(T(Ge),{key:0})):Q("",!0),G(" "+x(e(a.tag))+" ",1),a.name==="custom"&&a.idx!==0?(b(),S("span",{key:1,class:"remove",onClickCapture:n[3]||(n[3]=ye(r=>a.$emit("remove"),["stop"]))},[v(T(qe))],32)):Q("",!0)],10,Na)]))}});const Ka=be(Ea,[["__scopeId","data-v-1856e0a5"]]),Ma={class:"container"},Ra={class:"search-bar"},Da={class:"form-name"},Fa={class:"search-bar"},ja={class:"form-name"},Ua={class:"search-bar"},za={class:"form-name"},La={class:"search-bar"},Va={class:"form-name"},Ga={key:0,class:"generate-idx-hint"},qa={class:"list-container"},Ha=["onClick"],Wa={key:1},Qa={key:2,class:"spin-container"},Xa=Z({__name:"TagSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(o){const e=o,a=He(),n=We(),r=X(()=>!n.isIdle),s=U(),l=U({and_tags:[],or_tags:[],not_tags:[],folder_paths_str:e.searchScope}),g=X(()=>s.value?s.value.tags.slice().sort((t,i)=>i.count-t.count):[]),m=["custom","Source Identifier","Model","lora","lyco","pos","size","Postprocess upscaler","Postprocess upscale by","Sampler"].reduce((t,i,p)=>(t[i]=p,t),{}),P=X(()=>Object.entries(Oa(g.value,t=>t.type)).sort((t,i)=>m[t[0]]-m[i[0]])),O=Qe(new Map),w=t=>O.get(t)??512,K=Xe(),h=U(P.value.map(t=>t[0]));Je(async()=>{console.log(new Date().toLocaleString()),s.value=await ce(),await Ye(20),console.log(new Date().toLocaleString()),h.value=P.value.map(t=>t[0]),Ze(()=>{console.log(new Date().toLocaleString())}),s.value.img_count&&s.value.expired&&await z(),e.searchScope&&L()}),de("searchIndexExpired",()=>s.value&&(s.value.expired=!0));const z=ea(()=>n.pushAction(async()=>(await ca(),s.value=await ce(),h.value=P.value.map(t=>t[0]),s.value)).res),L=()=>{a.openTagSearchMatchedImageGridInRight(e.tabIdx,K,l.value)};de("returnToIIB",async()=>{const t=await n.pushAction(aa).res;s.value.expired=t.expired});const f=(t,i=!1)=>(i?`[${t.type}] `:"")+(t.display_name?`${t.display_name} : ${t.name}`:t.name),c=U(!1),d=U(""),C=async()=>{var i,p,A;if(!d.value){c.value=!1;return}const t=await n.pushAction(()=>na({tag_name:d.value})).res;t.type!=="custom"&&ve.error(se("existInOtherType")),(i=s.value)!=null&&i.tags.find(y=>y.id===t.id)?ve.error(se("alreadyExists")):((p=s.value)==null||p.tags.push(t),(A=a.conf)==null||A.all_custom_tags.push(t)),d.value="",c.value=!1},_=t=>{la.confirm({title:se("confirmDelete"),async onOk(){var p,A,y,N;await oa({tag_id:t});const i=((p=s.value)==null?void 0:p.tags.findIndex(E=>E.id===t))??-1;(A=s.value)==null||A.tags.splice(i,1),(N=a.conf)==null||N.all_custom_tags.splice((y=a.conf)==null?void 0:y.all_custom_tags.findIndex(E=>E.id===t),1)}})},M=X(()=>new Set([l.value.and_tags,l.value.or_tags,l.value.not_tags].flat())),q=t=>{M.value.has(t.id)?(l.value.and_tags=l.value.and_tags.filter(i=>i!==t.id),l.value.or_tags=l.value.or_tags.filter(i=>i!==t.id),l.value.not_tags=l.value.not_tags.filter(i=>i!==t.id)):l.value.and_tags.push(t.id)},B={value:t=>t.id,text:f,optionText:t=>f(t,!0)},R=(t,i)=>{const p=i.indexOf(t);p===-1?i.push(t):i.splice(p,1)};return(t,i)=>{const p=pe,A=sa,y=ia,N=pe,E=ra,D=le,H=Y,V=da;return b(),S("div",Ma,[Q("",!0),s.value?(b(),S(te,{key:1},[I("div",null,[I("div",Ra,[I("div",Da,x(t.$t("exactMatch")),1),v(T(oe),{conv:B,mode:"multiple",style:{width:"100%"},options:g.value,value:l.value.and_tags,"onUpdate:value":i[0]||(i[0]=u=>l.value.and_tags=u),disabled:!g.value.length,placeholder:t.$t("selectExactMatchTag")},null,8,["options","value","disabled","placeholder"]),s.value.expired||!s.value.img_count?(b(),W(p,{key:0,onClick:T(z),loading:!T(n).isIdle,type:"primary"},{default:F(()=>[G(x(s.value.img_count===0?t.$t("generateIndexHint"):t.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(b(),W(p,{key:1,type:"primary",onClick:L,loading:!T(n).isIdle},{default:F(()=>[G(x(t.$t("search")),1)]),_:1},8,["loading"]))]),I("div",Fa,[I("div",ja,x(t.$t("anyMatch")),1),v(T(oe),{conv:B,mode:"multiple",style:{width:"100%"},options:g.value,value:l.value.or_tags,"onUpdate:value":i[1]||(i[1]=u=>l.value.or_tags=u),disabled:!g.value.length,placeholder:t.$t("selectAnyMatchTag")},null,8,["options","value","disabled","placeholder"])]),I("div",Ua,[I("div",za,x(t.$t("exclude")),1),v(T(oe),{conv:B,mode:"multiple",style:{width:"100%"},options:g.value,value:l.value.not_tags,"onUpdate:value":i[2]||(i[2]=u=>l.value.not_tags=u),disabled:!g.value.length,placeholder:t.$t("selectExcludeTag")},null,8,["options","value","disabled","placeholder"])]),I("div",La,[I("div",Va,x(t.$t("searchScope")),1),v(A,{"auto-size":{maxRows:8},value:l.value.folder_paths_str,"onUpdate:value":i[3]||(i[3]=u=>l.value.folder_paths_str=u),placeholder:t.$t("specifiedSearchFolder")},null,8,["value","placeholder"])])]),g.value.filter(u=>u.type!=="custom").length?Q("",!0):(b(),S("p",Ga,x(t.$t("needGenerateIdx")),1)),I("div",qa,[(b(!0),S(te,null,ue(P.value,([u,ee])=>(b(),S("ul",{class:"tag-list",key:u},[I("h3",{class:"cat-name",onClick:$=>h.value.includes(u)?h.value.splice(h.value.indexOf(u),1):h.value.push(u)},[v(T(ma),{class:_e(["arrow",{down:h.value.includes(u)}])},null,8,["class"]),G(" "+x(t.$t(u)),1)],8,Ha),v(H,{ghost:"",activeKey:h.value,"onUpdate:activeKey":i[6]||(i[6]=$=>h.value=$)},{expandIcon:F(()=>[]),default:F(()=>[(b(),W(D,{key:u},{default:F(()=>[(b(!0),S(te,null,ue(ee.slice(0,w(u)),($,Ie)=>(b(),W(Ka,{onClick:ae=>q($),onRemove:ae=>_($.id),onToggleAnd:ae=>R($.id,l.value.and_tags),onToggleOr:ae=>R($.id,l.value.or_tags),onToggleNot:ae=>R($.id,l.value.not_tags),key:$.id,idx:Ie,name:u,tag:$,selected:M.value.has($.id)},null,8,["onClick","onRemove","onToggleAnd","onToggleOr","onToggleNot","idx","name","tag","selected"]))),128)),u==="custom"?(b(),S("li",{key:0,class:"tag",onClick:i[5]||(i[5]=$=>c.value=!0)},[c.value?(b(),W(E,{key:0,compact:""},{default:F(()=>[v(y,{value:d.value,"onUpdate:value":i[4]||(i[4]=$=>d.value=$),style:{width:"128px"},loading:r.value,"allow-clear":"",size:"small"},null,8,["value","loading"]),v(N,{size:"small",type:"primary",onClickCapture:ye(C,["stop"]),loading:r.value},{default:F(()=>[G(x(d.value?t.$t("submit"):t.$t("cancel")),1)]),_:1},8,["onClickCapture","loading"])]),_:1})):(b(),S(te,{key:1},[v(T(ta)),G(" "+x(t.$t("add")),1)],64))])):Q("",!0),w(u)<ee.length?(b(),S("div",Wa,[v(N,{block:"",onClick:$=>O.set(u,w(u)+512)},{default:F(()=>[G(x(t.$t("loadmore")),1)]),_:2},1032,["onClick"])])):Q("",!0)]),_:2},1024))]),_:2},1032,["activeKey"])]))),128))])],64)):(b(),S("div",Qa,[v(V,{size:"large"})]))])}}});const at=be(Xa,[["__scopeId","data-v-99a98b90"]]);export{at as default};
