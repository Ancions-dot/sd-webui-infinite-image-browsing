import{P as j,a2 as ke,d as ee,bg as _e,aK as Se,v as M,bE as Pe,s as be,u as Ce,ag as J,a0 as ne,h as x,c as u,a as Y,bF as Oe,b as Te,f as Be,bG as Ne,bn as ue,bH as Ke,aC as Ee,i as De,aS as Me,bI as Re,bJ as Fe,bK as Le,bL as Ue,a4 as je,aF as Ve,aD as ze,bM as Ge,aE as qe,bN as He,o as _,k as P,l as C,t as $,z as Q,B as D,bO as We,p as X,m as G,C as re,bP as Qe,R as Ie,q as Ae,r as Xe,bQ as Je,bd as Ye,ao as Ze,ak as ea,ai as aa,au as ta,bR as ve,bS as na,a3 as la,bT as pe,bU as oa,bV as sa,n as te,S as se,A as U,I as fe,ah as ia,bW as ra,a9 as ge,a6 as ie,V as ca,bX as da,X as me,bY as ua,W as va,bZ as pa,b_ as fa}from"./index-e8d50841.js";import{S as ga}from"./index-fcab8ca1.js";/* empty css              *//* empty css              */var ma=function(){return{prefixCls:String,activeKey:{type:[Array,Number,String]},defaultActiveKey:{type:[Array,Number,String]},accordion:{type:Boolean,default:void 0},destroyInactivePanel:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},expandIcon:Function,openAnimation:j.object,expandIconPosition:j.oneOf(ke("left","right")),collapsible:{type:String},ghost:{type:Boolean,default:void 0},onChange:Function,"onUpdate:activeKey":Function}},$e=function(){return{openAnimation:j.object,prefixCls:String,header:j.any,headerClass:String,showArrow:{type:Boolean,default:void 0},isActive:{type:Boolean,default:void 0},destroyInactivePanel:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},accordion:{type:Boolean,default:void 0},forceRender:{type:Boolean,default:void 0},expandIcon:Function,extra:j.any,panelKey:j.oneOfType([j.string,j.number]),collapsible:{type:String},role:String,onItemClick:{type:Function}}};function he(s){var e=s;if(!Array.isArray(e)){var t=Te(e);e=t==="number"||t==="string"?[e]:[]}return e.map(function(n){return String(n)})}const Z=ee({compatConfig:{MODE:3},name:"ACollapse",inheritAttrs:!1,props:_e(ma(),{accordion:!1,destroyInactivePanel:!1,bordered:!0,openAnimation:Se("ant-motion-collapse",!1),expandIconPosition:"left"}),slots:["expandIcon"],setup:function(e,t){var n=t.attrs,r=t.slots,i=t.emit,o=M(he(Pe([e.activeKey,e.defaultActiveKey])));be(function(){return e.activeKey},function(){o.value=he(e.activeKey)},{deep:!0});var g=Ce("collapse",e),m=g.prefixCls,O=g.direction,N=J(function(){var f=e.expandIconPosition;return f!==void 0?f:O.value==="rtl"?"right":"left"}),k=function(c){var d=e.expandIcon,h=d===void 0?r.expandIcon:d,p=h?h(c):u(Ke,{rotate:c.isActive?90:void 0},null);return u("div",null,[Ee(Array.isArray(h)?p[0]:p)?ue(p,{class:"".concat(m.value,"-arrow")},!1):p])},K=function(c){e.activeKey===void 0&&(o.value=c);var d=e.accordion?c[0]:c;i("update:activeKey",d),i("change",d)},S=function(c){var d=o.value;if(e.accordion)d=d[0]===c?[]:[c];else{d=De(d);var h=d.indexOf(c),p=h>-1;p?d.splice(h,1):d.push(c)}K(d)},q=function(c,d){var h,p,V;if(!Ne(c)){var H=o.value,R=e.accordion,W=e.destroyInactivePanel,F=e.collapsible,L=e.openAnimation,T=String((h=c.key)!==null&&h!==void 0?h:d),a=c.props||{},l=a.header,y=l===void 0?(p=c.children)===null||p===void 0||(V=p.header)===null||V===void 0?void 0:V.call(p):l,I=a.headerClass,A=a.collapsible,E=a.disabled,B=!1;R?B=H[0]===T:B=H.indexOf(T)>-1;var z=A??F;(E||E==="")&&(z="disabled");var oe={key:T,panelKey:T,header:y,headerClass:I,isActive:B,prefixCls:m.value,destroyInactivePanel:W,openAnimation:L,accordion:R,onItemClick:z==="disabled"?null:S,expandIcon:k,collapsible:z};return ue(c,oe)}},w=function(){var c;return Be((c=r.default)===null||c===void 0?void 0:c.call(r)).map(q)};return function(){var f,c=e.accordion,d=e.bordered,h=e.ghost,p=ne((f={},x(f,m.value,!0),x(f,"".concat(m.value,"-borderless"),!d),x(f,"".concat(m.value,"-icon-position-").concat(N.value),!0),x(f,"".concat(m.value,"-rtl"),O.value==="rtl"),x(f,"".concat(m.value,"-ghost"),!!h),x(f,n.class,!!n.class),f));return u("div",Y(Y({class:p},Oe(n)),{},{style:n.style,role:c?"tablist":null}),[w()])}}}),ha=ee({compatConfig:{MODE:3},name:"PanelContent",props:$e(),setup:function(e,t){var n=t.slots,r=M(!1);return Me(function(){(e.isActive||e.forceRender)&&(r.value=!0)}),function(){var i,o;if(!r.value)return null;var g=e.prefixCls,m=e.isActive,O=e.role;return u("div",{ref:M,class:ne("".concat(g,"-content"),(i={},x(i,"".concat(g,"-content-active"),m),x(i,"".concat(g,"-content-inactive"),!m),i)),role:O},[u("div",{class:"".concat(g,"-content-box")},[(o=n.default)===null||o===void 0?void 0:o.call(n)])])}}}),le=ee({compatConfig:{MODE:3},name:"ACollapsePanel",inheritAttrs:!1,props:_e($e(),{showArrow:!0,isActive:!1,onItemClick:function(){},headerClass:"",forceRender:!1}),slots:["expandIcon","extra","header"],setup:function(e,t){var n=t.slots,r=t.emit,i=t.attrs;Re(e.disabled===void 0,"Collapse.Panel",'`disabled` is deprecated. Please use `collapsible="disabled"` instead.');var o=Ce("collapse",e),g=o.prefixCls,m=function(){r("itemClick",e.panelKey)},O=function(k){(k.key==="Enter"||k.keyCode===13||k.which===13)&&m()};return function(){var N,k,K,S,q=e.header,w=q===void 0?(N=n.header)===null||N===void 0?void 0:N.call(n):q,f=e.headerClass,c=e.isActive,d=e.showArrow,h=e.destroyInactivePanel,p=e.accordion,V=e.forceRender,H=e.openAnimation,R=e.expandIcon,W=R===void 0?n.expandIcon:R,F=e.extra,L=F===void 0?(k=n.extra)===null||k===void 0?void 0:k.call(n):F,T=e.collapsible,a=T==="disabled",l=g.value,y=ne("".concat(l,"-header"),(K={},x(K,f,f),x(K,"".concat(l,"-header-collapsible-only"),T==="header"),K)),I=ne((S={},x(S,"".concat(l,"-item"),!0),x(S,"".concat(l,"-item-active"),c),x(S,"".concat(l,"-item-disabled"),a),x(S,"".concat(l,"-no-arrow"),!d),x(S,"".concat(i.class),!!i.class),S)),A=u("i",{class:"arrow"},null);d&&typeof W=="function"&&(A=W(e));var E=Fe(u(ha,{prefixCls:l,isActive:c,forceRender:V,role:p?"tabpanel":null},{default:n.default}),[[Le,c]]),B=Y({appear:!1,css:!1},H);return u("div",Y(Y({},i),{},{class:I}),[u("div",{class:y,onClick:function(){return T!=="header"&&m()},role:p?"tab":"button",tabindex:a?-1:0,"aria-expanded":c,onKeypress:O},[d&&A,T==="header"?u("span",{onClick:m,class:"".concat(l,"-header-text")},[w]):w,L&&u("div",{class:"".concat(l,"-extra")},[L])]),u(Ue,B,{default:function(){return[!h||c?E:null]}})])}}});Z.Panel=le;Z.install=function(s){return s.component(Z.name,Z),s.component(le.name,le),s};var ya={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"};const _a=ya;function ye(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(r){ba(s,r,t[r])})}return s}function ba(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}var ce=function(e,t){var n=ye({},e,t.attrs);return u(je,ye({},n,{icon:_a}),null)};ce.displayName="ArrowRightOutlined";ce.inheritAttrs=!1;const Ca=ce;function Ia(s,e,t,n){for(var r=-1,i=s==null?0:s.length;++r<i;){var o=s[r];e(n,o,t(o),s)}return n}function Aa(s){return function(e,t,n){for(var r=-1,i=Object(e),o=n(e),g=o.length;g--;){var m=o[s?g:++r];if(t(i[m],m,i)===!1)break}return e}}var $a=Aa();const xa=$a;function wa(s,e){return s&&xa(s,e,Ve)}function ka(s,e){return function(t,n){if(t==null)return t;if(!ze(t))return s(t,n);for(var r=t.length,i=e?r:-1,o=Object(t);(e?i--:++i<r)&&n(o[i],i,o)!==!1;);return t}}var Sa=ka(wa);const Pa=Sa;function Oa(s,e,t,n){return Pa(s,function(r,i,o){e(n,r,t(r),o)}),n}function Ta(s,e){return function(t,n){var r=Ge(t)?Ia:Oa,i=e?e():{};return r(t,s,qe(n),i)}}var Ba=Object.prototype,Na=Ba.hasOwnProperty,Ka=Ta(function(s,e,t){Na.call(s,t)?s[t].push(e):He(s,t,[e])});const Ea=Ka;const Da={class:"tag-wrap"},Ma={class:"float-actions"},Ra=["title"],Fa=ee({__name:"TagSearchItem",props:{tag:{},name:{},selected:{type:Boolean},idx:{}},emits:["remove","toggleAnd","toggleNot","toggleOr","click"],setup(s){const e=(t,n=!1)=>(n?`[${t.type}] `:"")+(t.display_name?`${t.display_name} : ${t.name}`:t.name);return(t,n)=>(_(),P("div",Da,[C("div",Ma,[C("div",{onClick:n[0]||(n[0]=r=>t.$emit("toggleAnd"))},$(t.$t("exactMatch")),1),C("div",{onClick:n[1]||(n[1]=r=>t.$emit("toggleOr"))},$(t.$t("anyMatch")),1),C("div",{onClick:n[2]||(n[2]=r=>t.$emit("toggleNot"))},$(t.$t("exclude")),1)]),C("li",{class:Ie(["tag",{selected:t.selected}]),title:e(t.tag),onClick:n[4]||(n[4]=r=>t.$emit("click"))},[t.selected?(_(),Q(D(We),{key:0})):X("",!0),G(" "+$(e(t.tag))+" ",1),t.name==="custom"&&t.idx!==0?(_(),P("span",{key:1,class:"remove",onClickCapture:n[3]||(n[3]=re(r=>t.$emit("remove"),["stop"]))},[u(D(Qe))],32)):X("",!0)],10,Ra)]))}});const La=Ae(Fa,[["__scopeId","data-v-7d7d9bbd"]]),Ua={class:"container"},ja={class:"search-bar"},Va={class:"form-name"},za={class:"search-bar"},Ga={class:"form-name"},qa={class:"search-bar"},Ha={class:"form-name"},Wa={class:"search-bar"},Qa={class:"form-name"},Xa={key:0,class:"generate-idx-hint"},Ja={class:"list-container"},Ya=["onClick"],Za={key:1},et={key:2,class:"spin-container"},at=ee({__name:"TagSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(s){const e=s,t=Xe(),n=Je(),r=J(()=>!n.isIdle),i=M(),o=M({and_tags:[],or_tags:[],not_tags:[],folder_paths_str:e.searchScope}),g=J(()=>i.value?i.value.tags.slice().sort((a,l)=>l.count-a.count):[]),m=["custom","Source Identifier","Model","lora","lyco","pos","size","Postprocess upscaler","Postprocess upscale by","Sampler"].reduce((a,l,y)=>(a[l]=y,a),{}),O=J(()=>Object.entries(Ea(g.value,a=>a.type)).sort((a,l)=>m[a[0]]-m[l[0]])),N=Ye(new Map),k=a=>N.get(a)??512,K=M({}),S=M({});be(K,Ze(a=>{S.value=ea(a)},300),{deep:!0});const q=aa(),w=M(O.value.map(a=>a[0]));ta(async()=>{console.log(new Date().toLocaleString()),i.value=await ve(),await na(20),console.log(new Date().toLocaleString()),w.value=O.value.map(a=>a[0]),la(()=>{console.log(new Date().toLocaleString())}),i.value.img_count&&i.value.expired&&await f(),e.searchScope&&c()}),pe("searchIndexExpired",()=>i.value&&(i.value.expired=!0));const f=oa(()=>n.pushAction(async()=>(await fa(),i.value=await ve(),w.value=O.value.map(a=>a[0]),i.value)).res),c=()=>{t.openTagSearchMatchedImageGridInRight(e.tabIdx,q,o.value)};pe("returnToIIB",async()=>{const a=await n.pushAction(sa).res;i.value.expired=a.expired});const d=(a,l=!1)=>(l?`[${a.type}] `:"")+(a.display_name?`${a.display_name} : ${a.name}`:a.name),h=M(!1),p=M(""),V=async()=>{var l,y,I;if(!p.value){h.value=!1;return}const a=await n.pushAction(()=>ra({tag_name:p.value})).res;a.type!=="custom"&&ge.error(ie("existInOtherType")),(l=i.value)!=null&&l.tags.find(A=>A.id===a.id)?ge.error(ie("alreadyExists")):((y=i.value)==null||y.tags.push(a),(I=t.conf)==null||I.all_custom_tags.push(a)),p.value="",h.value=!1},H=a=>{ca.confirm({title:ie("confirmDelete"),async onOk(){var y,I,A,E;await da({tag_id:a});const l=((y=i.value)==null?void 0:y.tags.findIndex(B=>B.id===a))??-1;(I=i.value)==null||I.tags.splice(l,1),(E=t.conf)==null||E.all_custom_tags.splice((A=t.conf)==null?void 0:A.all_custom_tags.findIndex(B=>B.id===a),1)}})},R=J(()=>new Set([o.value.and_tags,o.value.or_tags,o.value.not_tags].flat())),W=a=>{R.value.has(a.id)?(o.value.and_tags=o.value.and_tags.filter(l=>l!==a.id),o.value.or_tags=o.value.or_tags.filter(l=>l!==a.id),o.value.not_tags=o.value.not_tags.filter(l=>l!==a.id)):o.value.and_tags.push(a.id)},F={value:a=>a.id,text:d,optionText:a=>d(a,!0)},L=(a,l)=>{const y=l.indexOf(a);y===-1?l.push(a):l.splice(y,1)},T=(a,l)=>{const y=k(l);let I=S.value[l];return I&&(I=I.trim(),a=a.filter(A=>d(A).toLowerCase().includes(I.toLowerCase()))),a.slice(0,y)};return(a,l)=>{const y=me,I=ua,A=va,E=me,B=pa,z=le,oe=Z,xe=ga;return _(),P("div",Ua,[X("",!0),i.value?(_(),P(te,{key:1},[C("div",null,[C("div",ja,[C("div",Va,$(a.$t("exactMatch")),1),u(D(se),{conv:F,mode:"multiple",style:{width:"100%"},options:g.value,value:o.value.and_tags,"onUpdate:value":l[0]||(l[0]=v=>o.value.and_tags=v),disabled:!g.value.length,placeholder:a.$t("selectExactMatchTag")},null,8,["options","value","disabled","placeholder"]),i.value.expired||!i.value.img_count?(_(),Q(y,{key:0,onClick:D(f),loading:!D(n).isIdle,type:"primary"},{default:U(()=>[G($(i.value.img_count===0?a.$t("generateIndexHint"):a.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(_(),Q(y,{key:1,type:"primary",onClick:c,loading:!D(n).isIdle},{default:U(()=>[G($(a.$t("search")),1)]),_:1},8,["loading"]))]),C("div",za,[C("div",Ga,$(a.$t("anyMatch")),1),u(D(se),{conv:F,mode:"multiple",style:{width:"100%"},options:g.value,value:o.value.or_tags,"onUpdate:value":l[1]||(l[1]=v=>o.value.or_tags=v),disabled:!g.value.length,placeholder:a.$t("selectAnyMatchTag")},null,8,["options","value","disabled","placeholder"])]),C("div",qa,[C("div",Ha,$(a.$t("exclude")),1),u(D(se),{conv:F,mode:"multiple",style:{width:"100%"},options:g.value,value:o.value.not_tags,"onUpdate:value":l[2]||(l[2]=v=>o.value.not_tags=v),disabled:!g.value.length,placeholder:a.$t("selectExcludeTag")},null,8,["options","value","disabled","placeholder"])]),C("div",Wa,[C("div",Qa,$(a.$t("searchScope")),1),u(I,{"auto-size":{maxRows:8},value:o.value.folder_paths_str,"onUpdate:value":l[3]||(l[3]=v=>o.value.folder_paths_str=v),placeholder:a.$t("specifiedSearchFolder")},null,8,["value","placeholder"])])]),g.value.filter(v=>v.type!=="custom").length?X("",!0):(_(),P("p",Xa,$(a.$t("needGenerateIdx")),1)),C("div",Ja,[(_(!0),P(te,null,fe(O.value,([v,de])=>(_(),P("ul",{class:"tag-list",key:v},[C("h3",{class:"cat-name",onClick:b=>w.value.includes(v)?w.value.splice(w.value.indexOf(v),1):w.value.push(v)},[u(D(Ca),{class:Ie(["arrow",{down:w.value.includes(v)}])},null,8,["class"]),G(" "+$(a.$t(v))+" ",1),C("div",{onClick:l[4]||(l[4]=re(()=>{},["stop","prevent"])),class:"filter-input"},[u(A,{value:K.value[v],"onUpdate:value":b=>K.value[v]=b,size:"small",allowClear:"",placeholder:a.$t("filterByKeyword")},null,8,["value","onUpdate:value","placeholder"])])],8,Ya),u(oe,{ghost:"",activeKey:w.value,"onUpdate:activeKey":l[7]||(l[7]=b=>w.value=b)},{expandIcon:U(()=>[]),default:U(()=>[(_(),Q(z,{key:v},{default:U(()=>[(_(!0),P(te,null,fe(T(de,v),(b,we)=>(_(),Q(La,{onClick:ae=>W(b),onRemove:ae=>H(b.id),onToggleAnd:ae=>L(b.id,o.value.and_tags),onToggleOr:ae=>L(b.id,o.value.or_tags),onToggleNot:ae=>L(b.id,o.value.not_tags),key:b.id,idx:we,name:v,tag:b,selected:R.value.has(b.id)},null,8,["onClick","onRemove","onToggleAnd","onToggleOr","onToggleNot","idx","name","tag","selected"]))),128)),v==="custom"?(_(),P("li",{key:0,class:"tag",onClick:l[6]||(l[6]=b=>h.value=!0)},[h.value?(_(),Q(B,{key:0,compact:""},{default:U(()=>[u(A,{value:p.value,"onUpdate:value":l[5]||(l[5]=b=>p.value=b),style:{width:"128px"},loading:r.value,"allow-clear":"",size:"small"},null,8,["value","loading"]),u(E,{size:"small",type:"primary",onClickCapture:re(V,["stop"]),loading:r.value},{default:U(()=>[G($(p.value?a.$t("submit"):a.$t("cancel")),1)]),_:1},8,["onClickCapture","loading"])]),_:1})):(_(),P(te,{key:1},[u(D(ia)),G(" "+$(a.$t("add")),1)],64))])):X("",!0),k(v)<de.length?(_(),P("div",Za,[u(E,{block:"",onClick:b=>N.set(v,k(v)+512)},{default:U(()=>[G($(a.$t("loadmore")),1)]),_:2},1032,["onClick"])])):X("",!0)]),_:2},1024))]),_:2},1032,["activeKey"])]))),128))])],64)):(_(),P("div",et,[u(xe,{size:"large"})]))])}}});const st=Ae(at,[["__scopeId","data-v-021c3218"]]);export{st as default};
