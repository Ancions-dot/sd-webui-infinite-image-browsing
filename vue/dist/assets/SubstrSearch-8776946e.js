import{d as Y,$ as D,ay as Z,bS as V,bU as ee,bT as B,bV as ne,o,y as b,c as r,r as e,b$ as ae,m,n as d,x as k,v,C as g,s as F,p as U,t as te,L as se,N as A,c0 as le,az as ie,ar as oe,ai as re,U as de,V as ue,Q as ce,R as pe,b_ as me,X as ve}from"./index-7af0768f.js";import{L as ge,R as fe,f as be,S as ke}from"./fullScreenContextMenu-fc7f1e89.js";/* empty css              */import{g as we,F as ye}from"./FileItem-48c80f0a.js";import{u as Ie}from"./hook-ded05678.js";import"./shortcut-a76ce587.js";const xe={key:0,class:"search-bar"},Ce={class:"hint"},_e={key:1,class:"preview-switch"},he=Y({__name:"SubstrSearch",setup(Se){const{queue:l,images:t,onContextMenuClickU:w,stackViewEl:T,previewIdx:u,previewing:y,onPreviewVisibleChange:E,previewImgMove:I,canPreview:x,itemSize:C,gridItems:R,showGenInfo:c,imageGenInfo:_,q:N,multiSelectedIdxs:L,onFileItemClick:P,scroller:h,showMenuIdx:f,onFileDragStart:q,onFileDragEnd:G,cellWidth:K,onScroll:O,updateImageTag:Q}=Ie(),p=D(""),a=D();Z(async()=>{a.value=await V(),a.value.img_count&&a.value.expired&&S()});const S=ee(()=>l.pushAction(async()=>(await me(),a.value=await V(),a.value)).res),z=async()=>{t.value=await l.pushAction(()=>le(p.value)).res,await ie(),Q(),h.value.scrollToItem(0),t.value.length||oe.info(re("fuzzy-search-noResults"))};return B("returnToIIB",async()=>{const i=await l.pushAction(ne).res;a.value.expired=i.expired}),B("searchIndexExpired",()=>a.value&&(a.value.expired=!0)),(i,n)=>{const H=de,M=ue,W=ce,X=pe,j=ke;return o(),b("div",{class:"container",ref_key:"stackViewEl",ref:T},[a.value?(o(),b("div",xe,[r(H,{value:p.value,"onUpdate:value":n[0]||(n[0]=s=>p.value=s),placeholder:i.$t("fuzzy-search-placeholder"),disabled:!e(l).isIdle,onKeydown:ae(z,["enter"])},null,8,["value","placeholder","disabled","onKeydown"]),a.value.expired||!a.value.img_count?(o(),m(M,{key:0,onClick:e(S),loading:!e(l).isIdle,type:"primary"},{default:d(()=>[k(v(a.value.img_count===0?i.$t("generateIndexHint"):i.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(o(),m(M,{key:1,type:"primary",onClick:z,loading:!e(l).isIdle,disabled:!p.value},{default:d(()=>[k(v(i.$t("search")),1)]),_:1},8,["loading","disabled"]))])):g("",!0),r(j,{size:"large",spinning:!e(l).isIdle},{default:d(()=>[r(X,{visible:e(c),"onUpdate:visible":n[2]||(n[2]=s=>F(c)?c.value=s:null),width:"70vw","mask-closable":"",onOk:n[3]||(n[3]=s=>c.value=!1)},{cancelText:d(()=>[]),default:d(()=>[r(W,{active:"",loading:!e(N).isIdle},{default:d(()=>[U("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:n[1]||(n[1]=s=>e(te)(e(_)))},[U("div",Ce,v(i.$t("doubleClickToCopy")),1),k(" "+v(e(_)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(t)?(o(),m(e(we),{key:0,ref_key:"scroller",ref:h,class:"file-list",items:e(t),"item-size":e(C).first,"key-field":"fullpath","item-secondary-size":e(C).second,gridItems:e(R),onScroll:e(O)},{default:d(({item:s,index:$})=>[r(ye,{idx:$,file:s,"show-menu-idx":e(f),"onUpdate:showMenuIdx":n[4]||(n[4]=J=>F(f)?f.value=J:null),onFileItemClick:e(P),"full-screen-preview-image-url":e(t)[e(u)]?e(se)(e(t)[e(u)]):"","cell-width":e(K),selected:e(L).includes($),onContextMenuClick:e(w),onDragstart:e(q),onDragend:e(G),onPreviewVisibleChange:e(E)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):g("",!0),e(y)?(o(),b("div",_e,[r(e(ge),{onClick:n[5]||(n[5]=s=>e(I)("prev")),class:A({disable:!e(x)("prev")})},null,8,["class"]),r(e(fe),{onClick:n[6]||(n[6]=s=>e(I)("next")),class:A({disable:!e(x)("next")})},null,8,["class"])])):g("",!0)]),_:1},8,["spinning"]),e(y)&&e(t)&&e(t)[e(u)]?(o(),m(be,{key:1,file:e(t)[e(u)],idx:e(u),onContextMenuClick:e(w)},null,8,["file","idx","onContextMenuClick"])):g("",!0)],512)}}});const Fe=ve(he,[["__scopeId","data-v-bb005cb9"]]);export{Fe as default};
