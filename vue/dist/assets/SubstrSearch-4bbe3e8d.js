import{d as te,$ as x,aw as ne,bQ as le,bP as E,o as i,y,q as A,c as o,r as e,bT as ae,p as m,N as I,m as g,n as r,x as C,v as f,C as w,s as T,t as ie,L as oe,ax as re,al as de,ai as ue,U as ce,V as pe,Q as ve,R as me,X as ge}from"./index-54d35579.js";import{L as fe,R as we,f as ke,S as xe}from"./fullScreenContextMenu-9e3be5a3.js";/* empty css              */import{g as ye,F as Ie}from"./FileItem-ced5f921.js";import{b as K,c as Ce,f as N,u as be}from"./db-8d04be33.js";import{c as _e,u as he}from"./hook-9c9eb74d.js";import"./shortcut-dae64d46.js";const Se="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",Me=["src"],ze={class:"hint"},De={key:1,class:"preview-switch"},$e=te({__name:"SubstrSearch",setup(Be){const p=x(!1),u=x(""),b=_e(n=>p.value?N("",n,u.value):N(u.value,n)),{queue:d,images:a,onContextMenuClickU:_,stackViewEl:P,previewIdx:c,previewing:h,onPreviewVisibleChange:q,previewImgMove:S,canPreview:M,itemSize:z,gridItems:L,showGenInfo:v,imageGenInfo:D,q:G,multiSelectedIdxs:O,onFileItemClick:Q,scroller:$,showMenuIdx:k,onFileDragStart:H,onFileDragEnd:W,cellWidth:X,onScroll:B}=he(b),t=x();ne(async()=>{t.value=await K(),t.value.img_count&&t.value.expired&&V()});const V=le(()=>d.pushAction(async()=>(await be(),t.value=await K(),t.value)).res),F=async()=>{await b.reset({refetch:!0}),await re(),B(),$.value.scrollToItem(0),a.value.length||de.info(ue("fuzzy-search-noResults"))};E("returnToIIB",async()=>{const n=await d.pushAction(Ce).res;t.value.expired=n.expired}),E("searchIndexExpired",()=>t.value&&(t.value.expired=!0));const j=()=>{p.value=!p.value};return(n,s)=>{const J=ce,R=pe,Y=ve,Z=me,ee=xe;return i(),y("div",{class:"container",ref_key:"stackViewEl",ref:P},[t.value?(i(),y("div",{key:0,class:"search-bar",onKeydown:s[2]||(s[2]=A(()=>{},["stop"]))},[o(J,{value:u.value,"onUpdate:value":s[0]||(s[0]=l=>u.value=l),placeholder:n.$t("fuzzy-search-placeholder"),disabled:!e(d).isIdle,onKeydown:ae(F,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),m("div",{class:I(["regex-icon",{selected:p.value}]),onKeydown:s[1]||(s[1]=A(()=>{},["stop"])),onClick:j,title:"Use Regular Expression"},[m("img",{src:e(Se)},null,8,Me)],34),t.value.expired||!t.value.img_count?(i(),g(R,{key:0,onClick:e(V),loading:!e(d).isIdle,type:"primary"},{default:r(()=>[C(f(t.value.img_count===0?n.$t("generateIndexHint"):n.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(i(),g(R,{key:1,type:"primary",onClick:F,loading:!e(d).isIdle,disabled:!u.value},{default:r(()=>[C(f(n.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):w("",!0),o(ee,{size:"large",spinning:!e(d).isIdle},{default:r(()=>[o(Z,{visible:e(v),"onUpdate:visible":s[4]||(s[4]=l=>T(v)?v.value=l:null),width:"70vw","mask-closable":"",onOk:s[5]||(s[5]=l=>v.value=!1)},{cancelText:r(()=>[]),default:r(()=>[o(Y,{active:"",loading:!e(G).isIdle},{default:r(()=>[m("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[3]||(s[3]=l=>e(ie)(e(D)))},[m("div",ze,f(n.$t("doubleClickToCopy")),1),C(" "+f(e(D)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(a)?(i(),g(e(ye),{key:0,ref_key:"scroller",ref:$,class:"file-list",items:e(a),"item-size":e(z).first,"key-field":"fullpath","item-secondary-size":e(z).second,gridItems:e(L),onScroll:e(B)},{default:r(({item:l,index:U})=>[o(Ie,{idx:U,file:l,"show-menu-idx":e(k),"onUpdate:showMenuIdx":s[6]||(s[6]=se=>T(k)?k.value=se:null),onFileItemClick:e(Q),"full-screen-preview-image-url":e(a)[e(c)]?e(oe)(e(a)[e(c)]):"","cell-width":e(X),selected:e(O).includes(U),onContextMenuClick:e(_),onDragstart:e(H),onDragend:e(W),onPreviewVisibleChange:e(q)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):w("",!0),e(h)?(i(),y("div",De,[o(e(fe),{onClick:s[7]||(s[7]=l=>e(S)("prev")),class:I({disable:!e(M)("prev")})},null,8,["class"]),o(e(we),{onClick:s[8]||(s[8]=l=>e(S)("next")),class:I({disable:!e(M)("next")})},null,8,["class"])])):w("",!0)]),_:1},8,["spinning"]),e(h)&&e(a)&&e(a)[e(c)]?(i(),g(ke,{key:1,file:e(a)[e(c)],idx:e(c),onContextMenuClick:e(_)},null,8,["file","idx","onContextMenuClick"])):w("",!0)],512)}}});const Ke=ge($e,[["__scopeId","data-v-64c2d73c"]]);export{Ke as default};
