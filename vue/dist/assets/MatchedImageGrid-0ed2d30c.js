import{d as ne,k as R,av as ie,W as ae,N as u,O as k,c as s,Z as e,Y as o,a0 as V,Q as r,E as re,S as a,R as m,X as D,a9 as de,U as _,aa as z,ac as ce,ad as ue,af as B,aI as pe,aJ as me,bN as ge,V as fe}from"./index-be06106a.js";import{S as ve}from"./index-d1061a15.js";import{L as Ie,R as ke,f as _e,M as Ce}from"./MultiSelectKeep-849654db.js";import{c as he,d as we,F as Se}from"./FileItem-ac3569ad.js";import{c as be,u as xe}from"./hook-d824347a.js";import{a as ye}from"./functionalCallableComp-baf9af26.js";import"./shortcut-268ffd02.js";import"./Checkbox-bb8542f0.js";/* empty css              */import"./index-158b20aa.js";const Me=d=>(pe("data-v-fbf8262b"),d=d(),me(),d),Ae={class:"hint"},Te={class:"action-bar"},$e=Me(()=>r("div",{style:{padding:"16px 0 512px"}},null,-1)),Fe={key:1},Re={class:"no-res-hint"},Ve={class:"hint"},De={key:2,class:"preview-switch"},ze=ne({__name:"MatchedImageGrid",props:{tabIdx:{},paneIdx:{},selectedTagIds:{},id:{}},setup(d){const g=d,f=be(t=>ge(g.selectedTagIds,t)),{queue:N,images:i,onContextMenuClickU:C,stackViewEl:G,previewIdx:c,previewing:h,onPreviewVisibleChange:U,previewImgMove:w,canPreview:S,itemSize:b,gridItems:E,showGenInfo:p,imageGenInfo:x,q:J,multiSelectedIdxs:v,onFileItemClick:L,scroller:y,showMenuIdx:I,onFileDragStart:O,onFileDragEnd:P,cellWidth:K,onScroll:M,saveAllFileAsJson:q,props:Q,saveLoadedFileAsJson:W}=xe(f);R(()=>g.selectedTagIds,async()=>{var t;await f.reset(),await ie(),(t=y.value)==null||t.scrollToItem(0),M()},{immediate:!0}),R(()=>g,async t=>{Q.value=t},{deep:!0,immediate:!0});const X=ae(),{onClearAllSelected:Y,onSelectAll:Z,onReverseSelect:j}=he();return(t,l)=>{const H=Ce,ee=ce,te=ue,A=B,le=B,se=ve;return u(),k("div",{class:"container",ref_key:"stackViewEl",ref:G},[s(H,{show:!!e(v).length||e(X).keepMultiSelect,onClearAllSelected:e(Y),onSelectAll:e(Z),onReverseSelect:e(j)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),s(se,{size:"large",spinning:!e(N).isIdle},{default:o(()=>{var T,$;return[s(te,{visible:e(p),"onUpdate:visible":l[1]||(l[1]=n=>V(p)?p.value=n:null),width:"70vw","mask-closable":"",onOk:l[2]||(l[2]=n=>p.value=!1)},{cancelText:o(()=>[]),default:o(()=>[s(ee,{active:"",loading:!e(J).isIdle},{default:o(()=>[r("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:l[0]||(l[0]=n=>e(re)(e(x)))},[r("div",Ae,a(t.$t("doubleClickToCopy")),1),m(" "+a(e(x)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),r("div",Te,[s(A,{onClick:e(W)},{default:o(()=>[m(a(t.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),s(A,{onClick:e(q)},{default:o(()=>[m(a(t.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),(T=e(i))!=null&&T.length?(u(),D(e(we),{key:0,ref_key:"scroller",ref:y,class:"file-list",items:e(i),"item-size":e(b).first,"key-field":"fullpath","item-secondary-size":e(b).second,gridItems:e(E),onScroll:e(M)},{after:o(()=>[$e]),default:o(({item:n,index:F})=>[s(Se,{idx:F,file:n,"cell-width":e(K),"show-menu-idx":e(I),"onUpdate:showMenuIdx":l[3]||(l[3]=oe=>V(I)?I.value=oe:null),onDragstart:e(O),onDragend:e(P),onFileItemClick:e(L),"full-screen-preview-image-url":e(i)[e(c)]?e(de)(e(i)[e(c)]):"",selected:e(v).includes(F),onContextMenuClick:e(C),onPreviewVisibleChange:e(U),"is-selected-mutil-files":e(v).length>1},null,8,["idx","file","cell-width","show-menu-idx","onDragstart","onDragend","onFileItemClick","full-screen-preview-image-url","selected","onContextMenuClick","onPreviewVisibleChange","is-selected-mutil-files"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):e(f).load&&t.selectedTagIds.and_tags.length===1&&!(($=t.selectedTagIds.folder_paths_str)!=null&&$.trim())?(u(),k("div",Fe,[r("div",Re,[r("p",Ve,a(t.$t("tagSearchNoResultsMessage")),1),s(le,{onClick:l[4]||(l[4]=n=>e(ye)()),type:"primary"},{default:o(()=>[m(a(t.$t("rebuildImageIndex")),1)]),_:1})])])):_("",!0),e(h)?(u(),k("div",De,[s(e(Ie),{onClick:l[5]||(l[5]=n=>e(w)("prev")),class:z({disable:!e(S)("prev")})},null,8,["class"]),s(e(ke),{onClick:l[6]||(l[6]=n=>e(w)("next")),class:z({disable:!e(S)("next")})},null,8,["class"])])):_("",!0)]}),_:1},8,["spinning"]),e(h)&&e(i)&&e(i)[e(c)]?(u(),D(_e,{key:0,file:e(i)[e(c)],idx:e(c),onContextMenuClick:e(C)},null,8,["file","idx","onContextMenuClick"])):_("",!0)],512)}}});const qe=fe(ze,[["__scopeId","data-v-fbf8262b"]]);export{qe as default};
