import{c8 as ct,l as ie,ba as Ze,c as r,A as le,v as K,x as S,n as ut,J as q,k as ne,t as dt,c9 as We,ca as vt,bX as $e,ad as re,af as te,cb as ft,r as J,cc as Re,C as Ne,a9 as Q,cd as pt,ce as mt,R as x,a8 as gt,cf as Oe,I as ue,cg as ht,E as pe,ch as yt,ci as _t,c7 as wt,cj as bt,ck as kt,o as et,av as Ot,W as xe,ah as Et,B as G,cl as Lt,cm as $t,d as tt,cn as xt,co as St,L as je,cp as Be,N as _,O as $,Z as u,U as j,Q as P,X as de,Y as y,cq as Ct,T as Y,S as w,a2 as ye,aa as Ue,a1 as Pt,a0 as ve,cr as _e,$ as It,ag as Mt,cs as Ft,M as Dt,bH as At,ct as Tt,cu as zt,aI as Wt,aJ as Nt,V as nt}from"./index-28dbaa5b.js";import{u as ge,e as Ee,g as B,f as He,h as me,r as jt,t as we,i as Bt,s as be,j as fe,_ as Ut}from"./FileItem-a9860a66.js";import{M as lt,c as Ht,m as at,l as Le,b as Vt,d as qt}from"./functionalCallableComp-168f8428.js";import{C as Xt,g as Yt,_ as Gt,a as Kt}from"./shortcut-aef21d22.js";/* empty css              */import{D as Jt}from"./index-6980ed51.js";var Qt="Expected a function";function Zt(e,t,a){var l=!0,o=!0;if(typeof e!="function")throw new TypeError(Qt);return ct(a)&&(l="leading"in a?!!a.leading:l,o="trailing"in a?!!a.trailing:o),ie(e,t,{leading:l,maxWait:t,trailing:o})}const ce=(...e)=>{document.addEventListener(...e),Ze(()=>document.removeEventListener(...e))};var Rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M855 160.1l-189.2 23.5c-6.6.8-9.3 8.8-4.7 13.5l54.7 54.7-153.5 153.5a8.03 8.03 0 000 11.3l45.1 45.1c3.1 3.1 8.2 3.1 11.3 0l153.6-153.6 54.7 54.7a7.94 7.94 0 0013.5-4.7L863.9 169a7.9 7.9 0 00-8.9-8.9zM416.6 562.3a8.03 8.03 0 00-11.3 0L251.8 715.9l-54.7-54.7a7.94 7.94 0 00-13.5 4.7L160.1 855c-.6 5.2 3.7 9.5 8.9 8.9l189.2-23.5c6.6-.8 9.3-8.8 4.7-13.5l-54.7-54.7 153.6-153.6c3.1-3.1 3.1-8.2 0-11.3l-45.2-45z"}}]},name:"arrows-alt",theme:"outlined"};const en=Rt;function Ve(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){tn(e,o,a[o])})}return e}function tn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Se=function(t,a){var l=Ve({},t,a.attrs);return r(le,Ve({},l,{icon:en}),null)};Se.displayName="ArrowsAltOutlined";Se.inheritAttrs=!1;const nn=Se;var ln={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 00-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 00-11.3 0L405.6 242.3a7.23 7.23 0 005.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 00.1-11.4z"}}]},name:"drag",theme:"outlined"};const an=ln;function qe(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){sn(e,o,a[o])})}return e}function sn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ce=function(t,a){var l=qe({},t,a.attrs);return r(le,qe({},l,{icon:an}),null)};Ce.displayName="DragOutlined";Ce.inheritAttrs=!1;const on=Ce;var rn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 000 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 00391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 00-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]},name:"fullscreen-exit",theme:"outlined"};const cn=rn;function Xe(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){un(e,o,a[o])})}return e}function un(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Pe=function(t,a){var l=Xe({},t,a.attrs);return r(le,Xe({},l,{icon:cn}),null)};Pe.displayName="FullscreenExitOutlined";Pe.inheritAttrs=!1;const dn=Pe;var vn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0013.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 000 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 00-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]},name:"fullscreen",theme:"outlined"};const fn=vn;function Ye(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){pn(e,o,a[o])})}return e}function pn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ie=function(t,a){var l=Ye({},t,a.attrs);return r(le,Ye({},l,{icon:fn}),null)};Ie.displayName="FullscreenOutlined";Ie.inheritAttrs=!1;const mn=Ie;var gn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M603.3 327.5l-246 178a7.95 7.95 0 000 12.9l246 178c5.3 3.8 12.7 0 12.7-6.5V643c0-10.2-4.9-19.9-13.2-25.9L457.4 512l145.4-105.2c8.3-6 13.2-15.6 13.2-25.9V334c0-6.5-7.4-10.3-12.7-6.5z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"left-circle",theme:"outlined"};const hn=gn;function Ge(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){yn(e,o,a[o])})}return e}function yn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Me=function(t,a){var l=Ge({},t,a.attrs);return r(le,Ge({},l,{icon:hn}),null)};Me.displayName="LeftCircleOutlined";Me.inheritAttrs=!1;const ml=Me;var _n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M666.7 505.5l-246-178A8 8 0 00408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512 421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"right-circle",theme:"outlined"};const wn=_n;function Ke(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){bn(e,o,a[o])})}return e}function bn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Fe=function(t,a){var l=Ke({},t,a.attrs);return r(le,Ke({},l,{icon:wn}),null)};Fe.displayName="RightCircleOutlined";Fe.inheritAttrs=!1;const gl=Fe,kn="/infinite_image_browsing/fe-static/assets/fullscreen-7f54b926.svg";function hl(){const{previewIdx:e,eventEmitter:t,canLoadNext:a,previewing:l,sortedFiles:o,scroller:m,props:L}=ge().toRefs(),{state:C}=ge();let I=null;const W=(g,c)=>{var f;l.value=g,I!=null&&!g&&c&&((f=m.value)==null||f.scrollToItem(I),I=null)},N=()=>{L.value.mode==="walk"&&!b("next")&&a&&(K.info(S("loadingNextFolder")),t.value.emit("loadNextDir",!0))};ce("keydown",g=>{var c;if(l.value){let f=e.value;if(["ArrowDown","ArrowRight"].includes(g.key))for(f++;o.value[f]&&!q(o.value[f].name);)f++;else if(["ArrowUp","ArrowLeft"].includes(g.key))for(f--;o.value[f]&&!q(o.value[f].name);)f--;if(q((c=o.value[f])==null?void 0:c.name)??""){e.value=f;const k=m.value;k&&!(f>=k.$_startIndex&&f<=k.$_endIndex)&&(I=f)}N()}});const F=g=>{var f;let c=e.value;if(g==="next")for(c++;o.value[c]&&!q(o.value[c].name);)c++;else if(g==="prev")for(c--;o.value[c]&&!q(o.value[c].name);)c--;if(q((f=o.value[c])==null?void 0:f.name)??""){e.value=c;const k=m.value;k&&!(c>=k.$_startIndex&&c<=k.$_endIndex)&&(I=c)}N()},b=g=>{var f;let c=e.value;if(g==="next")for(c++;o.value[c]&&!q(o.value[c].name);)c++;else if(g==="prev")for(c--;o.value[c]&&!q(o.value[c].name);)c--;return q((f=o.value[c])==null?void 0:f.name)??""};return Ee("removeFiles",async()=>{var g;l.value&&!C.sortedFiles[e.value]&&(K.info(S("manualExitFullScreen"),5),await ut(500),(g=document.querySelector(".ant-image-preview-operations-operation .anticon-close"))==null||g.click(),e.value=-1)}),{previewIdx:e,onPreviewVisibleChange:W,previewing:l,previewImgMove:F,canPreview:b}}function ke(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ft(e)}function yl(){const{currLocation:e,sortedFiles:t,currPage:a,multiSelectedIdxs:l,eventEmitter:o,walker:m}=ge().toRefs(),L=()=>{l.value=[]};return ce("click",()=>{B.keepMultiSelect||L()}),ce("blur",()=>{B.keepMultiSelect||L()}),ne(a,L),{onFileDragStart:(N,F)=>{const b=dt(t.value[F]);He.fileDragging=!0,console.log("onFileDragStart set drag file ",N,F,b);const g=[b];let c=b.type==="dir";if(l.value.includes(F)){const k=l.value.map(T=>t.value[T]);g.push(...k),c=k.some(T=>T.type==="dir")}const f={includeDir:c,loc:e.value||"search-result",path:We(g,"fullpath").map(k=>k.fullpath),nodes:We(g,"fullpath"),__id:"FileTransferData"};N.dataTransfer.setData("text/plain",JSON.stringify(f))},onDrop:async N=>{if(m.value)return;const F=vt(N);if(!F)return;const b=e.value;if(F.loc===b)return;const g=$e(),c=async()=>g.pushAction(async()=>{await Ht(F.path,b),o.value.emit("refresh"),re.destroyAll()}),f=()=>g.pushAction(async()=>{await at(F.path,b),me.emit("removeFiles",{paths:F.path,loc:F.loc}),o.value.emit("refresh"),re.destroyAll()});re.confirm({title:S("confirm")+"?",width:"60vw",content:()=>{let k,T,O;return r("div",null,[r("div",null,[`${S("moveSelectedFilesTo")} ${b}`,r("ol",{style:{maxHeight:"50vh",overflow:"auto"}},[F.path.map(E=>r("li",null,[E.split(/[/\\]/).pop()]))])]),r(lt,null,null),r("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},class:"actions"},[r(te,{onClick:re.destroyAll},ke(k=S("cancel"))?k:{default:()=>[k]}),r(te,{type:"primary",loading:!g.isIdle,onClick:c},ke(T=S("copy"))?T:{default:()=>[T]}),r(te,{type:"primary",loading:!g.isIdle,onClick:f},ke(O=S("move"))?O:{default:()=>[O]})])])},maskClosable:!0,wrapClassName:"hidden-antd-btns-modal"})},multiSelectedIdxs:l,onFileDragEnd:()=>{He.fileDragging=!1}}}function _l({openNext:e}){const t=J(!1),a=J(""),{sortedFiles:l,previewIdx:o,multiSelectedIdxs:m,stack:L,currLocation:C,spinning:I,previewing:W,stackViewEl:N,eventEmitter:F,props:b,deletedFiles:g}=ge().toRefs(),c=Ne;Ee("removeFiles",({paths:E,loc:s})=>{c(s)!==c(C.value)||!Le(L.value)||(E.forEach(d=>g.value.add(d)),E.filter(q).forEach(d=>g.value.add(d.replace(/\.\w+$/,".txt"))))}),Ee("addFiles",({files:E,loc:s})=>{if(c(s)!==c(C.value))return;const p=Le(L.value);p&&p.files.unshift(...E)});const f=$e(),k=async(E,s,p)=>{o.value=p,B.fullscreenPreviewInitialUrl=Q(s);const d=m.value.indexOf(p);if(E.shiftKey){if(d!==-1)m.value.splice(d,1);else{m.value.push(p),m.value.sort((z,U)=>z-U);const A=m.value[0],H=m.value[m.value.length-1];m.value=jt(A,H+1)}E.stopPropagation()}else E.ctrlKey||E.metaKey?(d!==-1?m.value.splice(d,1):m.value.push(p),E.stopPropagation()):await e(s)},T=async(E,s,p)=>{var Z,ee,se;const d=Q(s),A=C.value,H={IIB_container_id:parent.IIB_container_id},z=()=>{let v=[];return m.value.includes(p)?v=m.value.map(n=>l.value[n]):v.push(s),v},U=async v=>{if(!I.value)try{I.value=!0,await bt(s.fullpath),fe.postMessage({...H,event:"click_hidden_button",btnEleId:"iib_hidden_img_update_trigger"}),await kt(),fe.postMessage({...H,event:"click_hidden_button",btnEleId:`iib_hidden_tab_${v}`})}catch(n){console.error(n),K.error("发送图像失败，请携带console的错误消息找开发者")}finally{I.value=!1}},V=`${E.key}`;if(V.startsWith("toggle-tag-")){const v=+V.split("toggle-tag-")[1],{is_remove:n}=await pt({tag_id:v,img_path:s.fullpath}),i=(ee=(Z=B.conf)==null?void 0:Z.all_custom_tags.find(M=>M.id===v))==null?void 0:ee.name;await we.refreshTags([s.fullpath]),K.success(S(n?"removedTagFromImage":"addedTagToImage",{tag:i}));return}else if(V.startsWith("batch-add-tag-")||V.startsWith("batch-remove-tag-")){const v=+V.split("-tag-")[1],n=V.includes("add")?"add":"remove",i=z().map(M=>M.fullpath);await mt({tag_id:v,img_paths:i,action:n}),await we.refreshTags(i),K.success(S(n==="add"?"addCompleted":"removeCompleted"));return}switch(E.key){case"previewInNewWindow":return window.open(d);case"saveSelectedAsJson":return wt(z());case"openWithDefaultApp":return _t(s.fullpath);case"download":{const v=z();yt(v.map(n=>Q(n,!0)));break}case"copyPreviewUrl":return pe(parent.document.location.origin+d);case"rename":{let v=await Vt(s.fullpath);v=Ne(v);const n=we.tagMap;n.set(v,n.get(s.fullpath)??[]),n.delete(s.fullpath),s.fullpath=v,s.name=v.split(/[\\/]/).pop()??"";return}case"send2txt2img":return U("txt2img");case"send2img2img":return U("img2img");case"send2inpaint":return U("inpaint");case"send2extras":return U("extras");case"send2savedDir":{const v=B.quickMovePaths.find(M=>M.key==="outdir_save");if(!v)return K.error(S("unknownSavedDir"));const n=ht(v.dir,(se=B.conf)==null?void 0:se.sd_cwd),i=z();await at(i.map(M=>M.fullpath),n,!0),me.emit("removeFiles",{paths:i.map(M=>M.fullpath),loc:C.value}),me.emit("addFiles",{files:i,loc:n});break}case"send2controlnet-img2img":case"send2controlnet-txt2img":{const v=E.key.split("-")[1];fe.postMessage({...H,event:"send_to_control_net",type:v,url:Q(s)});break}case"send2outpaint":{a.value=await f.pushAction(()=>Oe(s.fullpath)).res;const[v,n]=(a.value||"").split(`
`);fe.postMessage({...H,event:"send_to_outpaint",url:Q(s),prompt:v,negPrompt:n.slice(17)});break}case"openWithWalkMode":{be.set(A,L.value);const v=B.tabList[b.value.tabIdx],n={type:"local",key:ue(),path:s.fullpath,name:S("local"),stackKey:A,mode:"walk"};v.panes.push(n),v.key=n.key;break}case"openInNewTab":{be.set(A,L.value);const v=B.tabList[b.value.tabIdx],n={type:"local",key:ue(),path:s.fullpath,name:S("local"),stackKey:A};v.panes.push(n),v.key=n.key;break}case"openOnTheRight":{be.set(A,L.value);let v=B.tabList[b.value.tabIdx+1];v||(v={panes:[],key:"",id:ue()},B.tabList[b.value.tabIdx+1]=v);const n={type:"local",key:ue(),path:s.fullpath,name:S("local"),stackKey:A};v.panes.push(n),v.key=n.key;break}case"send2BatchDownload":{Bt.addFiles(z());break}case"viewGenInfo":{t.value=!0,a.value=await f.pushAction(()=>Oe(s.fullpath)).res;break}case"openWithLocalFileBrowser":{await gt(s.fullpath);break}case"deleteFiles":{const v=z(),n=async()=>{const i=v.map(M=>M.fullpath);await qt(i),K.success(S("deleteSuccess")),me.emit("removeFiles",{paths:i,loc:C.value})};if(v.length===1&&B.ignoredConfirmActions.deleteOneOnly)return n();await new Promise(i=>{re.confirm({title:S("confirmDelete"),maskClosable:!0,width:"60vw",content:()=>r("div",null,[r("ol",{style:{maxHeight:"50vh",overflow:"auto"}},[v.map(M=>r("li",null,[M.fullpath.split(/[/\\]/).pop()]))]),r(lt,null,null),r(Xt,{checked:B.ignoredConfirmActions.deleteOneOnly,"onUpdate:checked":M=>B.ignoredConfirmActions.deleteOneOnly=M},{default:()=>[S("deleteOneOnlySkipConfirm"),x(" ("),S("resetOnGlobalSettingsPage"),x(")")]})]),async onOk(){await n(),i()}})});break}}return{}},{isOutside:O}=Re(N);return ce("keydown",E=>{var p,d,A;const s=Yt(E);if(W.value){s==="Esc"&&(W.value=!1);const H=(p=Object.entries(B.shortcut).find(z=>z[1]===s&&z[1]))==null?void 0:p[0];if(H){E.stopPropagation(),E.preventDefault();const z=o.value,U=l.value[z];switch(H){case"delete":return Q(U)===B.fullscreenPreviewInitialUrl?K.warn(S("fullscreenRestriction")):T({key:"deleteFiles"},U,z);case"download":return T({key:"download"},U,z);default:{const V=(d=/^toggle_tag_(.*)$/.exec(H))==null?void 0:d[1],Z=(A=B.conf)==null?void 0:A.all_custom_tags.find(ee=>ee.name===V);return Z?T({key:`toggle-tag-${Z.id}`},U,z):void 0}}}}else!O.value&&["Ctrl + KeyA","Cmd + KeyA"].includes(s)&&(E.preventDefault(),E.stopPropagation(),F.value.emit("selectAll"))}),{onFileItemClick:k,onContextMenuClick:T,showGenInfo:t,imageGenInfo:a,q:f}}function On(e,t,a,l){let o=0,m=0,L=typeof(l==null?void 0:l.width)=="number"?l.width:0,C=typeof(l==null?void 0:l.height)=="number"?l.height:0,I=typeof(l==null?void 0:l.left)=="number"?l.left:0,W=typeof(l==null?void 0:l.top)=="number"?l.top:0,N=!1;const F=s=>{s.stopPropagation(),s.preventDefault(),!(!e.value||!t.value)&&(o=s instanceof MouseEvent?s.clientX:s.touches[0].clientX,m=s instanceof MouseEvent?s.clientY:s.touches[0].clientY,L=e.value.offsetWidth,C=e.value.offsetHeight,t.value.offsetLeft,t.value.offsetTop,document.documentElement.addEventListener("mousemove",b),document.documentElement.addEventListener("touchmove",b),document.documentElement.addEventListener("mouseup",g),document.documentElement.addEventListener("touchend",g))},b=s=>{if(!e.value||!t.value)return;let p=L+((s instanceof MouseEvent?s.clientX:s.touches[0].clientX)-o),d=C+((s instanceof MouseEvent?s.clientY:s.touches[0].clientY)-m);e.value.offsetLeft+p>window.innerWidth&&(p=window.innerWidth-e.value.offsetLeft),e.value.offsetTop+d>window.innerHeight&&(d=window.innerHeight-e.value.offsetTop),e.value.style.width=`${p}px`,e.value.style.height=`${d}px`,l!=null&&l.onResize&&l.onResize(p,d)},g=()=>{document.documentElement.removeEventListener("mousemove",b),document.documentElement.removeEventListener("touchmove",b),document.documentElement.removeEventListener("mouseup",g),document.documentElement.removeEventListener("touchend",g)},c=s=>{s.stopPropagation(),s.preventDefault(),!(!e.value||!a.value)&&(N=!0,I=e.value.offsetLeft,W=e.value.offsetTop,o=s instanceof MouseEvent?s.clientX:s.touches[0].clientX,m=s instanceof MouseEvent?s.clientY:s.touches[0].clientY,document.documentElement.addEventListener("mousemove",f),document.documentElement.addEventListener("touchmove",f),document.documentElement.addEventListener("mouseup",k),document.documentElement.addEventListener("touchend",k))},f=s=>{if(!e.value||!a.value||!N)return;const p=I+((s instanceof MouseEvent?s.clientX:s.touches[0].clientX)-o),d=W+((s instanceof MouseEvent?s.clientY:s.touches[0].clientY)-m);p<0?e.value.style.left="0px":p+e.value.offsetWidth>window.innerWidth?e.value.style.left=`${window.innerWidth-e.value.offsetWidth}px`:e.value.style.left=`${p}px`,d<0?e.value.style.top="0px":d+e.value.offsetHeight>window.innerHeight?e.value.style.top=`${window.innerHeight-e.value.offsetHeight}px`:e.value.style.top=`${d}px`,l!=null&&l.onDrag&&l.onDrag(p,d)},k=()=>{N=!1,document.documentElement.removeEventListener("mousemove",f),document.documentElement.removeEventListener("touchmove",f),document.documentElement.removeEventListener("mouseup",k),document.documentElement.removeEventListener("touchend",k)},T=()=>{if(!e.value||!t.value)return;let s=e.value.offsetLeft,p=e.value.offsetTop,d=e.value.offsetWidth,A=e.value.offsetHeight;s+d>window.innerWidth&&(s=window.innerWidth-d,s<0&&(s=0,d=window.innerWidth)),p+A>window.innerHeight&&(p=window.innerHeight-A,p<0&&(p=0,A=window.innerHeight)),e.value.style.left=`${s}px`,e.value.style.top=`${p}px`,e.value.style.width=`${d}px`,e.value.style.height=`${A}px`},O=()=>{!e.value||!l||(typeof l.width=="number"&&(e.value.style.width=`${l.width}px`),typeof l.height=="number"&&(e.value.style.height=`${l.height}px`),typeof l.left=="number"&&(e.value.style.left=`${l.left}px`),typeof l.top=="number"&&(e.value.style.top=`${l.top}px`),T(),window.addEventListener("resize",T))},E=()=>{document.documentElement.removeEventListener("mousemove",b),document.documentElement.removeEventListener("touchmove",b),document.documentElement.removeEventListener("mouseup",g),document.documentElement.removeEventListener("touchend",g),document.documentElement.removeEventListener("mousemove",f),document.documentElement.removeEventListener("touchmove",f),document.documentElement.removeEventListener("mouseup",k),document.documentElement.removeEventListener("touchend",k),window.removeEventListener("resize",T)};return et(O),Ze(E),ne(()=>l==null?void 0:l.disbaled,async s=>{await Ot(),s!==void 0&&(s?E():O())}),ne(()=>[e.value,t.value,a.value],([s,p,d])=>{s&&p&&(p.addEventListener("mousedown",F),p.addEventListener("touchstart",F)),s&&d&&(d.addEventListener("mousedown",c),d.addEventListener("touchstart",c))}),{handleResizeMouseDown:F,handleDragMouseDown:c}}let Je=null;const En=()=>{var C,I;const e=xe(),t=Et(Je??((I=(C=e.conf)==null?void 0:C.app_fe_setting)==null?void 0:I.fullscreen_layout)??{enable:!1,panelWidth:384,alwaysOn:!0}),a="--iib-lr-layout-info-panel-width",l=G(()=>t.alwaysOn&&t.enable?t.panelWidth:0);ne(t,()=>{Qe(t,a,l),Ln(t),Je=t},{deep:!0}),et(()=>Qe(t,a,l));const{enable:o,panelWidth:m,alwaysOn:L}=Lt(t);return{state:t,isLeftRightLayout:o,panelwidtrhStyleVarName:a,lrLayoutInfoPanelWidth:m,lrMenuAlwaysOn:L}},Ln=ie(e=>$t("fullscreen_layout",e),300),Qe=ie((e,t,a)=>{e.enable?(document.body.classList.add("fullscreen-lr-layout"),document.documentElement.style.setProperty(t,`${e.panelWidth}px`),document.documentElement.style.setProperty("--iib-lr-layout-container-offset",`${a.value}px`)):(document.documentElement.style.removeProperty(t),document.documentElement.style.removeProperty("--iib-lr-layout-container-offset"),document.body.classList.remove("fullscreen-lr-layout"))},300),ae=e=>(Wt("data-v-c28ac32d"),e=e(),Nt(),e),$n={key:0},xn={class:"container"},Sn={class:"action-bar"},Cn=["title"],Pn=["title"],In=["title"],Mn=["src"],Fn={key:0,class:"icon",style:{cursor:"pointer"}},Dn={key:2,"flex-placeholder":""},An={key:3,class:"action-bar"},Tn={key:0,class:"gen-info"},zn={class:"info-tags"},Wn={class:"name"},Nn={class:"value"},jn={key:0,class:"tags-container"},Bn=["onClick"],Un={class:"lr-layout-control"},Hn={class:"ctrl-item"},Vn={class:"ctrl-item"},qn={class:"ctrl-item"},Xn=ae(()=>P("br",null,null,-1)),Yn=ae(()=>P("h3",null,"Prompt",-1)),Gn=["innerHTML"],Kn=ae(()=>P("br",null,null,-1)),Jn=ae(()=>P("h3",null,"Negative Prompt",-1)),Qn=["innerHTML"],Zn=ae(()=>P("br",null,null,-1)),Rn=ae(()=>P("h3",null,"Params",-1)),el={style:{"font-weight":"600","text-transform":"capitalize"}},tl=["onDblclick"],nl=["onDblclick"],ll=["title"],al=tt({__name:"fullScreenContextMenu",props:{file:{},idx:{}},emits:["contextMenuClick"],setup(e,{emit:t}){const a=e;xt(n=>({"0b6ae20a":u(p)?0:"46px","31990f06":u(s)+"px",c56370fe:`calc(100vw - ${u(s)}px)`}));const l=xe(),o=St(),m=J(),L=G(()=>o.tagMap.get(a.file.fullpath)??[]),C=J(""),I=$e(),W=J(""),N=G(()=>W.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),F=G(()=>N.value.split(`
`)),b=G(()=>je(N.value)),g=G(()=>{let n=je(N.value);return delete n.prompt,delete n.negativePrompt,n});ne(()=>{var n;return(n=a==null?void 0:a.file)==null?void 0:n.fullpath},async n=>{n&&(I.tasks.forEach(i=>i.cancel()),I.pushAction(()=>Oe(n)).res.then(i=>{W.value=i}))},{immediate:!0});const c=Be("iib@fullScreenContextMenu.prompt-tab","structedData"),f=J(),k=J(),T={left:100,top:100,width:512,height:384,expanded:!0},O=Be("fullScreenContextMenu.vue-drag",T);O.value&&(O.value.left<0||O.value.top<0)&&(O.value={...T});const{isLeftRightLayout:E,lrLayoutInfoPanelWidth:s,lrMenuAlwaysOn:p}=En(),d=E;On(m,f,k,{disbaled:d,...O.value,onDrag:ie(function(n,i){O.value={...O.value,left:n,top:i}},300),onResize:ie(function(n,i){O.value={...O.value,width:n,height:i}},300)});const A=J(!1),{isOutside:H}=Re(G(()=>!d.value||p.value?null:A.value?m.value:Le(document.querySelectorAll(".iib-tab-edge-trigger"))));ne(H,Zt(n=>{A.value=!n},300));function z(n){return n.parentNode}function U(n){if(!n)return"";let i="";const M=n.split(/[\n,]+/).map(D=>D.trim()).filter(D=>D);let X=!1;for(let D=0;D<M.length;D++){const oe=M[D];X||(X=oe.includes("(")),i+=`<span class="${X?"has-parentheses":""}">${oe}</span>`,D<M.length-1&&(i+=","),X&&(X=!oe.includes(")"))}return i}ce("load",n=>{const i=n.target;i.className==="ant-image-preview-img"&&(C.value=`${i.naturalWidth} x ${i.naturalHeight}`)},{capture:!0});const V=G(()=>{const n=[{name:S("fileName"),val:a.file.name},{name:S("fileSize"),val:a.file.size}];return C.value&&n.push({name:S("resolution"),val:C.value}),n}),Z=()=>{const n="Negative prompt:",i=W.value.includes(n)?W.value.split(n)[0]:F.value[0]??"";pe(_e(i.trim()))},ee=()=>document.body.requestFullscreen(),se=n=>{pe(typeof n=="object"?JSON.stringify(n,null,4):n)},v=n=>{n.key.startsWith("Arrow")?(n.stopPropagation(),n.preventDefault(),document.dispatchEvent(new KeyboardEvent("keydown",n))):n.key==="Escape"&&(document.fullscreenElement?document.exitFullscreen():document.dispatchEvent(new KeyboardEvent("keydown",n)))};return(n,i)=>{var ze;const M=Jt,X=te,D=Mt,oe=Ft,De=Dt,st=te,Ae=Gt,ot=Kt,rt=At,Te=Tt,it=zt;return _(),$("div",{ref_key:"el",ref:m,class:Ue(["full-screen-menu",{"unset-size":!u(O).expanded,lr:u(d),"always-on":u(p),"mouse-in":A.value}]),onWheelCapture:i[9]||(i[9]=It(()=>{},["stop"])),onKeydownCapture:v},[u(d)?(_(),$("div",$n)):j("",!0),P("div",xn,[P("div",Sn,[u(d)?j("",!0):(_(),$("div",{key:0,ref_key:"dragHandle",ref:k,class:"icon",style:{cursor:"grab"},title:u(S)("dragToMovePanel")},[r(u(on))],8,Cn)),u(d)?j("",!0):(_(),$("div",{key:1,class:"icon",style:{cursor:"pointer"},onClick:i[0]||(i[0]=h=>u(O).expanded=!u(O).expanded),title:u(S)("clickToToggleMaximizeMinimize")},[u(O).expanded?(_(),de(u(dn),{key:0})):(_(),de(u(mn),{key:1}))],8,Pn)),P("div",{style:{display:"flex","flex-direction":"column","align-items":"center",cursor:"grab"},class:"icon",title:u(S)("fullscreenview"),onClick:ee},[P("img",{src:u(kn),style:{width:"21px",height:"21px","padding-bottom":"2px"},alt:""},null,8,Mn)],8,In),r(M,{"get-popup-container":z},{overlay:y(()=>[r(Ut,{file:n.file,idx:n.idx,"selected-tag":L.value,"disable-delete":u(Q)(n.file)===u(l).fullscreenPreviewInitialUrl,onContextMenuClick:i[1]||(i[1]=(h,R,he)=>t("contextMenuClick",h,R,he))},null,8,["file","idx","selected-tag","disable-delete"])]),default:y(()=>[u(O).expanded?j("",!0):(_(),$("div",Fn,[r(u(Ct))]))]),_:1}),u(O).expanded?(_(),$("div",Dn)):j("",!0),u(O).expanded?(_(),$("div",An,[r(M,{trigger:["hover"],"get-popup-container":z},{overlay:y(()=>[r(De,{onClick:i[2]||(i[2]=h=>t("contextMenuClick",h,n.file,n.idx))},{default:y(()=>{var h;return[((h=u(l).conf)==null?void 0:h.launch_mode)!=="server"?(_(),$(Y,{key:0},[r(D,{key:"send2txt2img"},{default:y(()=>[x(w(n.$t("sendToTxt2img")),1)]),_:1}),r(D,{key:"send2img2img"},{default:y(()=>[x(w(n.$t("sendToImg2img")),1)]),_:1}),r(D,{key:"send2inpaint"},{default:y(()=>[x(w(n.$t("sendToInpaint")),1)]),_:1}),r(D,{key:"send2extras"},{default:y(()=>[x(w(n.$t("sendToExtraFeatures")),1)]),_:1}),r(oe,{key:"sendToThirdPartyExtension",title:n.$t("sendToThirdPartyExtension")},{default:y(()=>[r(D,{key:"send2controlnet-txt2img"},{default:y(()=>[x("ControlNet - "+w(n.$t("t2i")),1)]),_:1}),r(D,{key:"send2controlnet-img2img"},{default:y(()=>[x("ControlNet - "+w(n.$t("i2i")),1)]),_:1}),r(D,{key:"send2outpaint"},{default:y(()=>[x("openOutpaint")]),_:1})]),_:1},8,["title"])],64)):j("",!0),r(D,{key:"send2BatchDownload"},{default:y(()=>[x(w(n.$t("sendToBatchDownload")),1)]),_:1}),r(D,{key:"send2savedDir"},{default:y(()=>[x(w(n.$t("send2savedDir")),1)]),_:1}),r(D,{key:"deleteFiles",disabled:u(Q)(n.file)===u(l).fullscreenPreviewInitialUrl},{default:y(()=>[x(w(n.$t("deleteSelected")),1)]),_:1},8,["disabled"]),r(D,{key:"previewInNewWindow"},{default:y(()=>[x(w(n.$t("previewInNewWindow")),1)]),_:1}),r(D,{key:"copyPreviewUrl"},{default:y(()=>[x(w(n.$t("copySourceFilePreviewLink")),1)]),_:1})]}),_:1})]),default:y(()=>[r(X,null,{default:y(()=>[x(w(u(S)("openContextMenu")),1)]),_:1})]),_:1}),r(st,{onClick:i[3]||(i[3]=h=>t("contextMenuClick",{key:"download"},a.file,a.idx))},{default:y(()=>[x(w(n.$t("download")),1)]),_:1}),W.value?(_(),de(X,{key:0,onClick:i[4]||(i[4]=h=>u(pe)(W.value))},{default:y(()=>[x(w(n.$t("copyPrompt")),1)]),_:1})):j("",!0),W.value?(_(),de(X,{key:1,onClick:Z},{default:y(()=>[x(w(n.$t("copyPositivePrompt")),1)]),_:1})):j("",!0)])):j("",!0)]),u(O).expanded?(_(),$("div",Tn,[P("div",zn,[(_(!0),$(Y,null,ye(V.value,h=>(_(),$("span",{class:"info-tag",key:h.name},[P("span",Wn,w(h.name),1),P("span",Nn,w(h.val),1)]))),128))]),(ze=u(l).conf)!=null&&ze.all_custom_tags?(_(),$("div",jn,[(_(!0),$(Y,null,ye(u(l).conf.all_custom_tags,h=>(_(),$("div",{class:Ue(["tag",{selected:L.value.some(R=>R.id===h.id)}]),onClick:R=>t("contextMenuClick",{key:`toggle-tag-${h.id}`},n.file,n.idx),key:h.id,style:Pt({"--tag-color":u(o).getColor(h.name)})},w(h.name),15,Bn))),128))])):j("",!0),P("div",Un,[P("div",Hn,[x(w(n.$t("experimentalLRLayout"))+"： ",1),r(Ae,{checked:u(d),"onUpdate:checked":i[5]||(i[5]=h=>ve(d)?d.value=h:null),size:"small"},null,8,["checked"])]),u(d)?(_(),$(Y,{key:0},[P("div",Vn,[x(w(n.$t("width"))+": ",1),r(ot,{value:u(s),"onUpdate:value":i[6]||(i[6]=h=>ve(s)?s.value=h:null),style:{width:"64px"},step:16,min:128,max:1024},null,8,["value"])]),r(rt,{title:n.$t("alwaysOnTooltipInfo")},{default:y(()=>[P("div",qn,[x(w(n.$t("alwaysOn"))+"： ",1),r(Ae,{checked:u(p),"onUpdate:checked":i[7]||(i[7]=h=>ve(p)?p.value=h:null),size:"small"},null,8,["checked"])])]),_:1},8,["title"])],64)):j("",!0)]),r(it,{activeKey:u(c),"onUpdate:activeKey":i[8]||(i[8]=h=>ve(c)?c.value=h:null)},{default:y(()=>[r(Te,{key:"structedData",tab:n.$t("structuredData")},{default:y(()=>[P("div",null,[b.value.prompt?(_(),$(Y,{key:0},[Xn,Yn,P("code",{innerHTML:U(b.value.prompt??"")},null,8,Gn)],64)):j("",!0),b.value.negativePrompt?(_(),$(Y,{key:1},[Kn,Jn,P("code",{innerHTML:U(b.value.negativePrompt??"")},null,8,Qn)],64)):j("",!0)]),Object.keys(g.value).length?(_(),$(Y,{key:0},[Zn,Rn,P("table",null,[(_(!0),$(Y,null,ye(g.value,(h,R)=>(_(),$("tr",{key:R,class:"gen-info-frag"},[P("td",el,w(R),1),typeof h=="object"?(_(),$("td",{key:0,style:{cursor:"pointer"},onDblclick:he=>se(h)},[P("code",null,w(h),1)],40,tl)):(_(),$("td",{key:1,style:{cursor:"pointer"},onDblclick:he=>se(u(_e)(h))},w(u(_e)(h)),41,nl))]))),128))])],64)):j("",!0)]),_:1},8,["tab"]),r(Te,{key:"sourceText",tab:n.$t("sourceText")},{default:y(()=>[P("code",null,w(W.value),1)]),_:1},8,["tab"])]),_:1},8,["activeKey"])])):j("",!0)]),u(O).expanded&&!u(d)?(_(),$("div",{key:1,class:"mouse-sensor",ref_key:"resizeHandle",ref:f,title:u(S)("dragToResizePanel")},[r(u(nn))],8,ll)):j("",!0)],34)}}});const wl=nt(al,[["__scopeId","data-v-c28ac32d"]]),sl={key:0,class:"float-panel"},ol={key:0,class:"select-actions"},rl={key:1},il=tt({__name:"MultiSelectKeep",props:{show:{type:Boolean}},emits:["selectAll","reverseSelect","clearAllSelected"],setup(e,{emit:t}){const a=xe(),l=()=>{t("clearAllSelected"),a.keepMultiSelect=!1},o=()=>{a.keepMultiSelect=!0};return(m,L)=>{const C=te;return m.show?(_(),$("div",sl,[u(a).keepMultiSelect?(_(),$("div",ol,[r(C,{size:"small",onClick:L[0]||(L[0]=I=>t("selectAll"))},{default:y(()=>[x(w(m.$t("select-all")),1)]),_:1}),r(C,{size:"small",onClick:L[1]||(L[1]=I=>t("reverseSelect"))},{default:y(()=>[x(w(m.$t("rerverse-select")),1)]),_:1}),r(C,{size:"small",onClick:L[2]||(L[2]=I=>t("clearAllSelected"))},{default:y(()=>[x(w(m.$t("clear-all-selected")),1)]),_:1}),r(C,{size:"small",onClick:l},{default:y(()=>[x(w(m.$t("exit")),1)]),_:1})])):(_(),$("div",rl,[r(C,{size:"small",type:"primary",onClick:o},{default:y(()=>[x(w(m.$t("keep-multi-selected")),1)]),_:1})]))])):j("",!0)}}});const bl=nt(il,[["__scopeId","data-v-b04c3508"]]);export{ml as L,bl as M,gl as R,yl as a,_l as b,hl as c,wl as f,ce as u};
