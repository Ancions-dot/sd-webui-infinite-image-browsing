import{d as ve,r as S,o as me,c2 as q,x as ge,au as fe,t as we,v as he,y as G,c3 as ke,V as Se,L as c,N as A,c as n,Y as e,Z as J,c9 as Ie,O as r,a9 as M,W as I,X as o,Q as w,R as d,T as _,$ as O,E as _e,a8 as xe,ad as Ce,ae as P,c6 as ye,ab as be,ac as Ae,aH as Me,aI as $e,ca as Re,c8 as ze,U as Fe}from"./index-06baaf1e.js";import{S as De}from"./index-9fe933a9.js";/* empty css              */import{c as Be,d as Ee,F as Ue}from"./FileItem-e645123d.js";import{M as Ve,L as Te,R as Ke,f as Le}from"./MultiSelectKeep-179c3c7a.js";import{c as Ne,u as qe}from"./hook-64eb59b0.js";import"./functionalCallableComp-8073cb42.js";import"./index-34bbd6b0.js";/* empty css              */import"./shortcut-b18fa359.js";import"./Checkbox-afa15909.js";const Ge="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",Je=p=>(Me("data-v-ecedc00a"),p=p(),$e(),p),Oe=["src"],Pe={class:"search-bar"},He={class:"form-name"},Qe={class:"search-bar last actions"},We={class:"hint"},Xe=Je(()=>r("div",{style:{padding:"16px 0 512px"}},null,-1)),Ye={key:1,class:"preview-switch"},Ze=ve({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(p){const $=p,v=S(!1),m=S(""),h=S($.searchScope??""),x=Ne(s=>{const l={cursor:s,regexp:v.value?m.value:"",surstr:v.value?"":m.value,folder_paths:(h.value??"").split(/,|\n/).map(f=>f.trim()).filter(f=>f)};return Re(l)}),{queue:u,images:i,onContextMenuClickU:R,stackViewEl:H,previewIdx:g,previewing:z,onPreviewVisibleChange:Q,previewImgMove:F,canPreview:D,itemSize:B,gridItems:W,showGenInfo:k,imageGenInfo:E,q:X,multiSelectedIdxs:C,onFileItemClick:Y,scroller:U,showMenuIdx:y,onFileDragStart:Z,onFileDragEnd:j,cellWidth:ee,onScroll:V,saveAllFileAsJson:le,saveLoadedFileAsJson:se}=qe(x),t=S();me(async()=>{t.value=await q(),t.value.img_count&&t.value.expired&&await T(),$.searchScope&&await b()});const T=ge(()=>u.pushAction(async()=>(await ze(),t.value=await q(),t.value)).res),b=async()=>{await x.reset({refetch:!0}),await fe(),V(),U.value.scrollToItem(0),i.value.length||we.info(he("fuzzy-search-noResults"))};G("returnToIIB",async()=>{const s=await u.pushAction(ke).res;t.value.expired=s.expired}),G("searchIndexExpired",()=>t.value&&(t.value.expired=!0));const te=()=>{v.value=!v.value},ae=Se(),{onClearAllSelected:ne,onSelectAll:oe,onReverseSelect:ie}=Be();return(s,l)=>{const f=Ce,K=P,re=ye,L=P,ce=be,de=Ae,ue=De;return c(),A("div",{class:"container",ref_key:"stackViewEl",ref:H},[n(Ve,{show:!!e(C).length||e(ae).keepMultiSelect,onClearAllSelected:e(ne),onSelectAll:e(oe),onReverseSelect:e(ie)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),t.value?(c(),A("div",{key:0,class:"search-bar",onKeydown:l[2]||(l[2]=J(()=>{},["stop"]))},[n(f,{value:m.value,"onUpdate:value":l[0]||(l[0]=a=>m.value=a),placeholder:s.$t("fuzzy-search-placeholder")+" "+s.$t("regexSearchEnabledHint"),disabled:!e(u).isIdle,onKeydown:Ie(b,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),r("div",{class:M(["regex-icon",{selected:v.value}]),onKeydown:l[1]||(l[1]=J(()=>{},["stop"])),onClick:te,title:"Use Regular Expression"},[r("img",{src:e(Ge)},null,8,Oe)],34),t.value.expired||!t.value.img_count?(c(),I(K,{key:0,onClick:e(T),loading:!e(u).isIdle,type:"primary"},{default:o(()=>[w(d(t.value.img_count===0?s.$t("generateIndexHint"):s.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(c(),I(K,{key:1,type:"primary",onClick:b,loading:!e(u).isIdle||e(x).loading,disabled:!m.value&&!h.value},{default:o(()=>[w(d(s.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):_("",!0),r("div",Pe,[r("div",He,d(s.$t("searchScope")),1),n(re,{"auto-size":{maxRows:8},value:h.value,"onUpdate:value":l[3]||(l[3]=a=>h.value=a),placeholder:s.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),r("div",Qe,[n(L,{onClick:e(se)},{default:o(()=>[w(d(s.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),n(L,{onClick:e(le)},{default:o(()=>[w(d(s.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),n(ue,{size:"large",spinning:!e(u).isIdle},{default:o(()=>[n(de,{visible:e(k),"onUpdate:visible":l[5]||(l[5]=a=>O(k)?k.value=a:null),width:"70vw","mask-closable":"",onOk:l[6]||(l[6]=a=>k.value=!1)},{cancelText:o(()=>[]),default:o(()=>[n(ce,{active:"",loading:!e(X).isIdle},{default:o(()=>[r("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:l[4]||(l[4]=a=>e(_e)(e(E)))},[r("div",We,d(s.$t("doubleClickToCopy")),1),w(" "+d(e(E)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(i)?(c(),I(e(Ee),{key:0,ref_key:"scroller",ref:U,class:"file-list",items:e(i),"item-size":e(B).first,"key-field":"fullpath","item-secondary-size":e(B).second,gridItems:e(W),onScroll:e(V)},{after:o(()=>[Xe]),default:o(({item:a,index:N})=>[n(Ue,{idx:N,file:a,"show-menu-idx":e(y),"onUpdate:showMenuIdx":l[7]||(l[7]=pe=>O(y)?y.value=pe:null),onFileItemClick:e(Y),"full-screen-preview-image-url":e(i)[e(g)]?e(xe)(e(i)[e(g)]):"","cell-width":e(ee),selected:e(C).includes(N),onContextMenuClick:e(R),onDragstart:e(Z),onDragend:e(j),"is-selected-mutil-files":e(C).length>1,onPreviewVisibleChange:e(Q)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):_("",!0),e(z)?(c(),A("div",Ye,[n(e(Te),{onClick:l[8]||(l[8]=a=>e(F)("prev")),class:M({disable:!e(D)("prev")})},null,8,["class"]),n(e(Ke),{onClick:l[9]||(l[9]=a=>e(F)("next")),class:M({disable:!e(D)("next")})},null,8,["class"])])):_("",!0)]),_:1},8,["spinning"]),e(z)&&e(i)&&e(i)[e(g)]?(c(),I(Le,{key:1,file:e(i)[e(g)],idx:e(g),onContextMenuClick:e(R)},null,8,["file","idx","onContextMenuClick"])):_("",!0)],512)}}});const dl=Fe(Ze,[["__scopeId","data-v-ecedc00a"]]);export{dl as default};
