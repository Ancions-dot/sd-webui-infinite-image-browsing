import{c1 as Se,c2 as xe,aK as Ie,c3 as Pe,c4 as Fe,c5 as Me,ao as pe,c6 as Ee,ak as ae,bd as Te,c7 as Le,c as _e,ag as Ce,c8 as ie,c9 as De,ca as Ne,k as Oe,cb as ge,ai as q,bu as $,ah as C,cc as K,$ as _,l as ne,be as se,ax as $e,cd as z,ce as ze,cf as oe,cg as ce,al as he,bq as ue,br as Ae,ch as X,ci as qe,aB as Re,bp as We,cj as Ue,bY as A,ck as H,t as me,cl as Ge,O as we,I as Ve,b$ as je,aj as Q,cm as He,cn as Be,co as Ke,cp as Je,cq as Qe,cr as Ye}from"./index-812384b6.js";import{b as Xe,h as Ze,i as et,t as tt}from"./db-6cb27576.js";var fe=1/0,at=17976931348623157e292;function ee(s){if(!s)return s===0?s:0;if(s=Se(s),s===fe||s===-fe){var r=s<0?-1:1;return r*at}return s===s?s:0}function G(s){var r=s==null?0:s.length;return r?s[r-1]:void 0}function nt(s,r,a){if(!xe(a))return!1;var o=typeof r;return(o=="number"?Ie(a)&&Pe(r,a.length):o=="string"&&r in a)?Fe(a[r],s):!1}var st=Math.ceil,rt=Math.max;function it(s,r,a,o){for(var c=-1,p=rt(st((r-s)/(a||1)),0),f=Array(p);p--;)f[o?p:++c]=s,s+=a;return f}function ot(s){return function(r,a,o){return o&&typeof o!="number"&&nt(r,a,o)&&(a=o=void 0),r=ee(r),a===void 0?(a=r,r=0):a=ee(a),o=o===void 0?r<a?1:-1:ee(o),it(r,a,o,s)}}var lt=ot();const ct=lt;function ut(s,r){return s&&s.length?Me(s,Xe(r)):[]}const J=(...s)=>{document.addEventListener(...s),pe(()=>document.removeEventListener(...s))},Y=new WeakMap;function ft(s,r){return{useHookShareState:o=>{const c=Ee();ae(c),Y.has(c)||(Y.set(c,Te(s(c,o??(r==null?void 0:r())))),pe(()=>{Y.delete(c)}));const p=Y.get(c);return ae(p),{state:p,toRefs(){return Le(p)}}}}}var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"};const vt=dt;function de(s){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?Object(arguments[r]):{},o=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(a).filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable}))),o.forEach(function(c){pt(s,c,a[c])})}return s}function pt(s,r,a){return r in s?Object.defineProperty(s,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[r]=a,s}var le=function(r,a){var o=de({},r,a.attrs);return _e(Ce,de({},o,{icon:vt}),null)};le.displayName="DatabaseOutlined";le.inheritAttrs=!1;const gt=le,j=async s=>(await ie.get("/files",{params:{folder_path:s}})).data,ht=async s=>(await ie.post("/delete_files",{file_paths:s})).data,ye=async(s,r)=>(await ie.post("/move_files",{file_paths:s,dest:r})).data;var be={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */(function(s,r){(function(a,o){s.exports=o})(De,function(){var a={};a.version="0.3.5";var o=a.settings={minimum:.08,easing:"linear",positionUsing:"",speed:200,trickle:!0,trickleSpeed:200,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};a.configure=function(t){var e,n;for(e in t)n=t[e],n!==void 0&&t.hasOwnProperty(e)&&(o[e]=n);return this},a.status=null,a.set=function(t){var e=a.isStarted();t=c(t,o.minimum,1),a.status=t===1?null:t;var n=a.render(!e),l=n.querySelector(o.barSelector),h=o.speed,m=o.easing;return n.offsetWidth,y(function(d){o.positionUsing===""&&(o.positionUsing=a.getPositioningCSS()),S(l,f(t,h,m)),t===1?(S(n,{transition:"none",opacity:1}),n.offsetWidth,setTimeout(function(){S(n,{transition:"all "+h+"ms linear",opacity:0}),setTimeout(function(){a.remove(),d()},h)},h)):setTimeout(d,h)}),this},a.isStarted=function(){return typeof a.status=="number"},a.start=function(){a.status||a.set(0);var t=function(){setTimeout(function(){a.status&&(a.trickle(),t())},o.trickleSpeed)};return o.trickle&&t(),this},a.done=function(t){return!t&&!a.status?this:a.inc(.3+.5*Math.random()).set(1)},a.inc=function(t){var e=a.status;return e?e>1?void 0:(typeof t!="number"&&(e>=0&&e<.2?t=.1:e>=.2&&e<.5?t=.04:e>=.5&&e<.8?t=.02:e>=.8&&e<.99?t=.005:t=0),e=c(e+t,0,.994),a.set(e)):a.start()},a.trickle=function(){return a.inc()},function(){var t=0,e=0;a.promise=function(n){return!n||n.state()==="resolved"?this:(e===0&&a.start(),t++,e++,n.always(function(){e--,e===0?(t=0,a.done()):a.set((t-e)/t)}),this)}}(),a.getElement=function(){var t=a.getParent();if(t){var e=Array.prototype.slice.call(t.querySelectorAll(".nprogress")).filter(function(n){return n.parentElement===t});if(e.length>0)return e[0]}return null},a.getParent=function(){if(o.parent instanceof HTMLElement)return o.parent;if(typeof o.parent=="string")return document.querySelector(o.parent)},a.render=function(t){if(a.isRendered())return a.getElement();L(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.className="nprogress",e.innerHTML=o.template;var n=e.querySelector(o.barSelector),l=t?"-100":p(a.status||0),h=a.getParent(),m;return S(n,{transition:"all 0 linear",transform:"translate3d("+l+"%,0,0)"}),o.showSpinner||(m=e.querySelector(o.spinnerSelector),m&&P(m)),h!=document.body&&L(h,"nprogress-custom-parent"),h.appendChild(e),e},a.remove=function(){a.status=null,F(document.documentElement,"nprogress-busy"),F(a.getParent(),"nprogress-custom-parent");var t=a.getElement();t&&P(t)},a.isRendered=function(){return!!a.getElement()},a.getPositioningCSS=function(){var t=document.body.style,e="WebkitTransform"in t?"Webkit":"MozTransform"in t?"Moz":"msTransform"in t?"ms":"OTransform"in t?"O":"";return e+"Perspective"in t?"translate3d":e+"Transform"in t?"translate":"margin"};function c(t,e,n){return t<e?e:t>n?n:t}function p(t){return(-1+t)*100}function f(t,e,n){var l;return o.positionUsing==="translate3d"?l={transform:"translate3d("+p(t)+"%,0,0)"}:o.positionUsing==="translate"?l={transform:"translate("+p(t)+"%,0)"}:l={"margin-left":p(t)+"%"},l.transition="all "+e+"ms "+n,l}var y=function(){var t=[];function e(){var n=t.shift();n&&n(e)}return function(n){t.push(n),t.length==1&&e()}}(),S=function(){var t=["Webkit","O","Moz","ms"],e={};function n(d){return d.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(b,x){return x.toUpperCase()})}function l(d){var b=document.body.style;if(d in b)return d;for(var x=t.length,I=d.charAt(0).toUpperCase()+d.slice(1),M;x--;)if(M=t[x]+I,M in b)return M;return d}function h(d){return d=n(d),e[d]||(e[d]=l(d))}function m(d,b,x){b=h(b),d.style[b]=x}return function(d,b){var x=arguments,I,M;if(x.length==2)for(I in b)M=b[I],M!==void 0&&b.hasOwnProperty(I)&&m(d,I,M);else m(d,x[1],x[2])}}();function w(t,e){var n=typeof t=="string"?t:T(t);return n.indexOf(" "+e+" ")>=0}function L(t,e){var n=T(t),l=n+e;w(n,e)||(t.className=l.substring(1))}function F(t,e){var n=T(t),l;w(t,e)&&(l=n.replace(" "+e+" "," "),t.className=l.substring(1,l.length-1))}function T(t){return(" "+(t&&t.className||"")+" ").replace(/\s+/gi," ")}function P(t){t&&t.parentNode&&t.parentNode.removeChild(t)}return a})})(be);var mt=be.exports;const wt=Ne(mt),te=new Map,k=Oe(),ve=new BroadcastChannel("iib-image-transfer-bus"),B=encodeURIComponent,V=(s,r=!1)=>`/infinite_image_browsing/file?path=${B(s.fullpath)}&t=${B(s.date)}${r?`&disposition=${B(s.name)}`:""}`,kt=(s,r)=>`/infinite_image_browsing/image-thumbnail?path=${B(s.fullpath)}&size=${r}&t=${B(s.date)}`,{eventEmitter:Z,useEventListen:re}=ge(),{useHookShareState:R}=ft((s,{images:r})=>{const a=_({tabIdx:-1,paneIdx:-1}),o=q(()=>G(c.value)),c=_([]),p=q(()=>{var e;return c.value.map(n=>n.curr).slice((e=k.conf)!=null&&e.is_win?1:0)}),f=q(()=>oe(...p.value)),y=_(k.defaultSortingMethod),S=q(()=>{var m;if(r.value)return r.value;if(!o.value)return[];const e=((m=o.value)==null?void 0:m.files)??[],n=y.value,{walkFiles:l}=o.value,h=d=>k.onlyFoldersAndImages?d.filter(b=>b.type==="dir"||A(b.name)):d;return a.value.walkModePath?l?l.map(d=>H(h(d),n)).flat():H(h(e),n):H(h(e),n)}),w=_([]),L=_(-1),F=_(!0),T=_(!1),P=_(!1),t=()=>k.tabList[a.value.tabIdx].panes[a.value.paneIdx];return{previewing:P,spinning:T,canLoadNext:F,multiSelectedIdxs:w,previewIdx:L,basePath:p,currLocation:f,currPage:o,stack:c,sortMethod:y,sortedFiles:S,scroller:_(),stackViewEl:_(),props:a,getPane:t,...ge()}},()=>({images:_()})),St=["detailList","largePreviewGrid","previewGrid"];function xt(s,r){const{previewIdx:a,eventEmitter:o,canLoadNext:c,previewing:p}=R().toRefs(),{state:f}=R(),y=q(()=>(r==null?void 0:r.files.value)??f.sortedFiles),S=q(()=>(r==null?void 0:r.scroller.value)??f.scroller);let w=null;const L=(t,e)=>{var n;p.value=t,w!=null&&!t&&e&&((n=S.value)==null||n.scrollToItem(w),w=null)},F=()=>{s.walkModePath&&!P("next")&&c&&($.info(C("loadingNextFolder")),o.value.emit("loadNextDir",!0))};J("keydown",t=>{var e;if(p.value){let n=a.value;if(["ArrowDown","ArrowRight"].includes(t.key))for(n++;y.value[n]&&!A(y.value[n].name);)n++;else if(["ArrowUp","ArrowLeft"].includes(t.key))for(n--;y.value[n]&&!A(y.value[n].name);)n--;if(A((e=y.value[n])==null?void 0:e.name)??""){a.value=n;const l=S.value;l&&!(n>=l.$_startIndex&&n<=l.$_endIndex)&&(w=n)}F()}});const T=t=>{var n;let e=a.value;if(t==="next")for(e++;y.value[e]&&!A(y.value[e].name);)e++;else if(t==="prev")for(e--;y.value[e]&&!A(y.value[e].name);)e--;if(A((n=y.value[e])==null?void 0:n.name)??""){a.value=e;const l=S.value;l&&!(e>=l.$_startIndex&&e<=l.$_endIndex)&&(w=e)}F()},P=t=>{var n;let e=a.value;if(t==="next")for(e++;y.value[e]&&!A(y.value[e].name);)e++;else if(t==="prev")for(e--;y.value[e]&&!A(y.value[e].name);)e--;return A((n=y.value[e])==null?void 0:n.name)??""};return re("removeFiles",async()=>{var t;p.value&&!f.sortedFiles[a.value]&&($.info(C("manualExitFullScreen"),5),await K(500),(t=document.querySelector(".ant-image-preview-operations-operation .anticon-close"))==null||t.click(),a.value=-1)}),{previewIdx:a,onPreviewVisibleChange:L,previewing:p,previewImgMove:T,canPreview:P}}function It(s){const r=_(),{scroller:a,stackViewEl:o,stack:c,currPage:p,currLocation:f,sortMethod:y,useEventListen:S,eventEmitter:w,getPane:L}=R().toRefs();ne(()=>c.value.length,se((i,u)=>{var g;i!==u&&((g=a.value)==null||g.scrollToItem(0))},300));const F=async i=>{if(await n(i),s.walkModePath){await K();const[u]=H(p.value.files,y.value).filter(g=>g.type==="dir");u&&await n(u.fullpath),await w.value.emit("loadNextDir")}};$e(async()=>{var i;if(!c.value.length){const u=await j("/");c.value.push({files:u.files,curr:"/"})}r.value=new wt,r.value.configure({parent:o.value}),s.path&&s.path!=="/"?await F(s.walkModePath??s.path):(i=k.conf)!=null&&i.home&&n(k.conf.home)}),ne(f,se(i=>{const u=L.value();u.path=i;const g=u.path.split("/").pop(),E=(()=>{var O;if(!s.walkModePath){const N=X(i);for(const[W,U]of Object.entries(k.pathAliasMap))if(N.startsWith(U))return N.replace(U,W);return g}return"Walk: "+(((O=k.quickMovePaths.find(N=>N.dir===u.walkModePath))==null?void 0:O.zh)??g)})();u.name=z("div",{style:"display:flex;align-items:center"},[z(gt),z("span",{class:"line-clamp-1",style:"max-width: 256px"},E)]),u.nameFallbackStr=E,k.recent=k.recent.filter(O=>O.key!==u.key),k.recent.unshift({path:i,key:u.key}),k.recent.length>20&&(k.recent=k.recent.slice(0,20))},300));const T=()=>me(f.value),P=async i=>{var u,g;if(i.type==="dir")try{(u=r.value)==null||u.start();const{files:D}=await j(i.fullpath);c.value.push({files:D,curr:i.name})}finally{(g=r.value)==null||g.done()}},t=i=>{for(;i<c.value.length-1;)c.value.pop()},e=(i,u)=>(ae(k.conf,"global.conf load failed"),k.conf.is_win?i.toLowerCase()==u.toLowerCase():i==u),n=async i=>{var g,D;const u=c.value.slice();try{ze(i)||(i=oe(((g=k.conf)==null?void 0:g.sd_cwd)??"/",i));const E=ce(i),O=c.value.map(N=>N.curr);for(O.shift();O[0]&&E[0]&&e(O[0],E[0]);)O.shift(),E.shift();for(let N=0;N<O.length;N++)c.value.pop();if(!E.length)return l();for(const N of E){const W=(D=p.value)==null?void 0:D.files.find(U=>e(U.name,N));if(!W)throw console.error({frags:E,frag:N,stack:he(c.value)}),new Error(`${N} not found`);await P(W)}}catch(E){throw $.error(C("moveFailedCheckPath")+(E instanceof Error?E.message:"")),console.error(i,ce(i),p.value),c.value=u,E}},l=ue(async()=>{var i,u,g;try{if((i=r.value)==null||i.start(),s.walkModePath)t(0),await F(s.walkModePath);else{const{files:D}=await j(c.value.length===1?"/":f.value);G(c.value).files=D}(u=a.value)==null||u.scrollToItem(0),$.success(C("refreshCompleted"))}finally{(g=r.value)==null||g.done()}});Ae("return-to-iib",ue(async()=>{var i,u;if(!s.walkModePath)try{(i=r.value)==null||i.start();const{files:g}=await j(c.value.length===1?"/":f.value);G(c.value).files.map(E=>E.date).join()!==g.map(E=>E.date).join()&&(G(c.value).files=g,$.success(C("autoUpdate")))}finally{(u=r.value)==null||u.done()}})),S.value("refresh",l);const h=i=>{s.walkModePath&&(L.value().walkModePath=i),F(i)},m=q(()=>k.quickMovePaths.map(i=>({...i,path:X(i.dir)}))),d=q(()=>{const i=X(f.value);return m.value.find(g=>g.path===i)}),b=async()=>{const i=d.value;if(i){if(!i.can_delete)return;await Ze(f.value),$.success(C("removeComplete"))}else await et(f.value),$.success(C("addComplete"));await Ge.emit("updateGlobalSetting")},x=_(!1),I=_(f.value),M=()=>{x.value=!0,I.value=f.value},v=async()=>{await n(I.value),x.value=!1};return J("click",()=>{x.value=!1}),{locInputValue:I,isLocationEditing:x,onLocEditEnter:v,onEditBtnClick:M,addToSearchScanPathAndQuickMove:b,searchPathInfo:d,refresh:l,copyLocation:T,back:t,openNext:P,currPage:p,currLocation:f,to:n,stack:c,scroller:a,quickMoveTo:h}}function Pt(s){const{scroller:r,sortedFiles:a,stack:o,sortMethod:c,currLocation:p,currPage:f,stackViewEl:y,canLoadNext:S,previewIdx:w}=R().toRefs(),{state:L}=R(),F=_(!1),T=_(k.defaultViewMode),P=272,t=64,e=P*2,{width:n}=qe(y),l=q(()=>{const I=n.value;if(!(T.value==="detailList"||!I))return~~(I/(T.value==="previewGrid"?P:e))}),h=q(()=>{const I=T.value;if(I==="detailList")return{first:80,second:void 0};const M=I==="previewGrid"?P:e;return{first:M+t,second:M}}),m=_(!1),d=async()=>{var I;if(!(m.value||!s.walkModePath||!S.value))try{m.value=!0;const M=o.value[o.value.length-2],v=H(M.files,c.value),i=v.findIndex(u=>{var g;return u.name===((g=f.value)==null?void 0:g.curr)});if(i!==-1){const u=v[i+1],g=oe(p.value,"../",u.name),D=await j(g),E=f.value;E.curr=u.name,E.walkFiles||(E.walkFiles=[E.files]),E.walkFiles.push(D.files),console.log("curr page files length",(I=f.value)==null?void 0:I.files.length)}}catch(M){console.error("loadNextDir",M),S.value=!1}finally{m.value=!1}},b=async(I=!1)=>{const M=r.value,v=()=>I?w.value:(M==null?void 0:M.$_endIndex)??0;for(;!a.value.length||v()>a.value.length-20&&S.value;)await K(100),await d()};L.useEventListen("loadNextDir",b);const x=se(()=>b(),300);return{gridItems:l,sortedFiles:a,sortMethodConv:Re,moreActionsDropdownShow:F,viewMode:T,gridSize:P,sortMethod:c,largeGridSize:e,onScroll:x,loadNextDir:d,loadNextDirLoading:m,canLoadNext:S,itemSize:h}}const ke=()=>z("p",{style:{background:"var(--zp-secondary-background)",padding:"8px",borderLeft:"4px solid var(--primary-color)"}},`Tips: ${C("multiSelectTips")}`);function Ft(){const{currLocation:s,sortedFiles:r,currPage:a,multiSelectedIdxs:o,eventEmitter:c}=R().toRefs(),p=()=>{o.value=[]};return J("click",p),J("blur",p),ne(a,p),{onFileDragStart:(S,w)=>{const L=he(r.value[w]);console.log("onFileDragStart set drag file ",S,w,L);const F=[L];let T=L.type==="dir";if(o.value.includes(w)){const P=o.value.map(t=>r.value[t]);F.push(...P),T=P.some(t=>t.type==="dir")}S.dataTransfer.setData("text/plain",JSON.stringify({includeDir:T,loc:s.value||"search-result",path:ut(F,"fullpath").map(P=>P.fullpath)}))},onDrop:async S=>{var L;const w=JSON.parse(((L=S.dataTransfer)==null?void 0:L.getData("text"))||"{}");if(console.log(w),w.path&&typeof w.includeDir<"u"&&w.loc){const F=s.value;if(w.loc===F)return;const T=z("div",[z("div",`${C("moveSelectedFilesTo")}${F}`),z("ol",w.path.map(P=>P.split(/[/\\]/).pop()).map(P=>z("li",P))),ke()]);we.confirm({title:C("confirm"),content:T,maskClosable:!0,async onOk(){await ye(w.path,F),Z.emit("removeFiles",{paths:w.path,loc:w.loc}),await c.value.emit("refresh")}})}},multiSelectedIdxs:o}}function Mt(s,{openNext:r}){const a=_(!1),o=_(""),{sortedFiles:c,previewIdx:p,multiSelectedIdxs:f,stack:y,currLocation:S,spinning:w,previewing:L}=R().toRefs(),F=X;re("removeFiles",({paths:e,loc:n})=>{if(F(n)!==F(S.value))return;const l=G(y.value);l&&(l.files=l.files.filter(h=>!e.includes(h.fullpath)),l.walkFiles&&(l.walkFiles=l.walkFiles.map(h=>h.filter(m=>!e.includes(m.fullpath)))))}),re("addFiles",({files:e,loc:n})=>{if(F(n)!==F(S.value))return;const l=G(y.value);l&&l.files.unshift(...e)});const T=We(),P=async(e,n,l)=>{p.value=l,k.fullscreenPreviewInitialUrl=V(n);const h=f.value.indexOf(l);if(e.shiftKey){if(h!==-1)f.value.splice(h,1);else{f.value.push(l),f.value.sort((b,x)=>b-x);const m=f.value[0],d=f.value[f.value.length-1];f.value=ct(m,d+1)}e.stopPropagation()}else e.ctrlKey||e.metaKey?(h!==-1?f.value.splice(h,1):f.value.push(l),e.stopPropagation()):await r(n)},t=async(e,n,l)=>{var x,I,M;const h=V(n),m=S.value,d=()=>{let v=[];return f.value.includes(l)?v=f.value.map(i=>c.value[i]):v.push(n),v},b=async v=>{if(!w.value)try{w.value=!0,await Ke(n.fullpath),ve.postMessage("iib_hidden_img_update_trigger");const i=setTimeout(()=>Je.warn({message:C("long_loading"),duration:20}),5e3);await Qe(),clearTimeout(i),ve.postMessage(`iib_hidden_tab_${v}`)}catch(i){console.error(i),$.error("发送图像失败，请携带console的错误消息找开发者")}finally{w.value=!1}};if(`${e.key}`.startsWith("toggle-tag-")){const v=+`${e.key}`.split("toggle-tag-")[1],{is_remove:i}=await tt({tag_id:v,img_path:n.fullpath}),u=(I=(x=k.conf)==null?void 0:x.all_custom_tags.find(g=>g.id===v))==null?void 0:I.name;$.success(C(i?"removedTagFromImage":"addedTagToImage",{tag:u}));return}switch(e.key){case"previewInNewWindow":return window.open(h);case"download":return window.open(V(n,!0));case"copyPreviewUrl":return me(parent.document.location.origin+h);case"send2txt2img":return b("txt2img");case"send2img2img":return b("img2img");case"send2inpaint":return b("inpaint");case"send2extras":return b("extras");case"send2savedDir":{const v=k.quickMovePaths.find(g=>g.key==="outdir_save");if(!v)return $.error(C("unknownSavedDir"));const i=Be(v.dir,(M=k.conf)==null?void 0:M.sd_cwd),u=d();await ye(u.map(g=>g.fullpath),i),Z.emit("removeFiles",{paths:u.map(g=>g.fullpath),loc:S.value}),Z.emit("addFiles",{files:u,loc:i});break}case"send2controlnet-img2img":case"send2controlnet-txt2img":{const v=He(),i=Ye(),u=e.key.split("-")[1];u==="img2img"?i.switch_to_img2img():i.switch_to_txt2img(),await K(100);const D=v.querySelector(`#${u}_controlnet`).querySelector(".label-wrap");D.className.includes("open")||(D.click(),await K(100)),D.scrollIntoView();const O=await(await fetch(V(n))).blob(),N=new File([O],"image.jpg",{type:O.type,lastModified:Date.now()}),W=new DataTransfer;W.items.add(N);const U=new ClipboardEvent("paste",{clipboardData:W,bubbles:!0});D.dispatchEvent(U);break}case"openWithWalkMode":{te.set(m,y.value);const v=k.tabList[s.tabIdx],i={type:"local",key:Q(),path:n.fullpath,name:C("local"),stackKey:m,walkModePath:n.fullpath};v.panes.push(i),v.key=i.key;break}case"openInNewTab":{te.set(m,y.value);const v=k.tabList[s.tabIdx],i={type:"local",key:Q(),path:n.fullpath,name:C("local"),stackKey:m};v.panes.push(i),v.key=i.key;break}case"openOnTheRight":{te.set(m,y.value);let v=k.tabList[s.tabIdx+1];v||(v={panes:[],key:"",id:Q()},k.tabList[s.tabIdx+1]=v);const i={type:"local",key:Q(),path:n.fullpath,name:C("local"),stackKey:m};v.panes.push(i),v.key=i.key;break}case"viewGenInfo":{a.value=!0,o.value=await T.pushAction(()=>je(n.fullpath)).res;break}case"openWithLocalFileBrowser":{await Ve(n.fullpath);break}case"deleteFiles":{const v=d();await new Promise(i=>{we.confirm({title:C("confirmDelete"),maskClosable:!0,content:z("div",[z("ol",{style:"max-height:50vh;overflow:auto;"},v.map(u=>u.fullpath.split(/[/\\]/).pop()).map(u=>z("li",u))),ke()]),async onOk(){const u=v.map(g=>g.fullpath);await ht(u),$.success(C("deleteSuccess")),Z.emit("removeFiles",{paths:u,loc:S.value}),i()}})});break}}return{}};return J("keydown",e=>{var n,l,h;if(L.value){const m=[];if(e.shiftKey&&m.push("Shift"),e.ctrlKey&&m.push("Ctrl"),e.code.startsWith("Key")||e.code.startsWith("Digit")){m.push(e.code);const d=m.join(" + "),b=(n=Object.entries(k.shortcut).find(x=>x[1]===d))==null?void 0:n[0];if(b){e.stopPropagation(),e.preventDefault();const x=p.value,I=c.value[x];switch(b){case"delete":return V(I)===k.fullscreenPreviewInitialUrl?$.warn(C("fullscreenRestriction")):t({key:"deleteFiles"},I,x);default:{const M=(l=/^toggle_tag_(.*)$/.exec(b))==null?void 0:l[1],v=(h=k.conf)==null?void 0:h.all_custom_tags.find(i=>i.name===M);return v?t({key:`toggle-tag-${v.id}`},I,x):void 0}}}}}}),{onFileItemClick:P,onContextMenuClick:t,showGenInfo:a,imageGenInfo:o,q:T}}const Et=()=>{const{stackViewEl:s}=R().toRefs(),r=_(-1);return Ue(s,a=>{var c;let o=a.target;for(;o.parentElement;)if(o=o.parentElement,o.tagName.toLowerCase()==="li"&&o.classList.contains("file-item-trigger")){const p=(c=o.dataset)==null?void 0:c.idx;p&&Number.isSafeInteger(+p)&&(r.value=+p);return}}),{showMenuIdx:r}};export{It as a,Pt as b,Ft as c,Mt as d,xt as e,Et as f,ee as g,re as h,kt as i,G as l,te as s,V as t,R as u,St as v};
