import{c8 as rt,l as re,ba as Ke,c as i,A as ne,v as G,x,n as it,J as q,k as te,t as ut,c9 as Ae,ca as ct,bX as Le,ad as oe,af as ee,cb as dt,r as J,cc as Qe,C as ze,a9 as K,cd as vt,ce as ft,R as $,a8 as pt,cf as ke,I as ue,cg as mt,E as fe,ch as gt,ci as ht,c7 as yt,cj as _t,ck as wt,o as Ze,av as bt,W as Ee,ah as kt,B as Y,cl as Ot,cm as Lt,d as Re,cn as Et,co as $t,L as Ne,cp as We,N as y,O as E,Z as d,U as j,Q as P,X as ce,Y as h,cq as xt,T as X,S as _,a2 as he,aa as je,a1 as St,a0 as de,cr as ye,$ as Ct,ag as Pt,cs as It,M as Mt,bH as Ft,ct as Dt,cu as Tt,aI as At,aJ as zt,V as et}from"./index-21be9ddc.js";import{u as me,e as Oe,g as B,f as Be,h as pe,r as Nt,t as _e,i as Wt,s as we,j as ve,_ as jt}from"./FileItem-710a9007.js";import{M as tt,c as Bt,m as nt,l as Ue,b as Ut,d as Ht}from"./functionalCallableComp-30a754a4.js";import{C as Vt,g as qt,_ as Xt,a as Yt}from"./shortcut-2bfc6446.js";/* empty css              */import{D as Gt}from"./index-b9ad3c90.js";var Jt="Expected a function";function Kt(e,t,a){var l=!0,r=!0;if(typeof e!="function")throw new TypeError(Jt);return rt(a)&&(l="leading"in a?!!a.leading:l,r="trailing"in a?!!a.trailing:r),re(e,t,{leading:l,maxWait:t,trailing:r})}const ie=(...e)=>{document.addEventListener(...e),Ke(()=>document.removeEventListener(...e))};var Qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M855 160.1l-189.2 23.5c-6.6.8-9.3 8.8-4.7 13.5l54.7 54.7-153.5 153.5a8.03 8.03 0 000 11.3l45.1 45.1c3.1 3.1 8.2 3.1 11.3 0l153.6-153.6 54.7 54.7a7.94 7.94 0 0013.5-4.7L863.9 169a7.9 7.9 0 00-8.9-8.9zM416.6 562.3a8.03 8.03 0 00-11.3 0L251.8 715.9l-54.7-54.7a7.94 7.94 0 00-13.5 4.7L160.1 855c-.6 5.2 3.7 9.5 8.9 8.9l189.2-23.5c6.6-.8 9.3-8.8 4.7-13.5l-54.7-54.7 153.6-153.6c3.1-3.1 3.1-8.2 0-11.3l-45.2-45z"}}]},name:"arrows-alt",theme:"outlined"};const Zt=Qt;function He(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),l.forEach(function(r){Rt(e,r,a[r])})}return e}function Rt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var $e=function(t,a){var l=He({},t,a.attrs);return i(ne,He({},l,{icon:Zt}),null)};$e.displayName="ArrowsAltOutlined";$e.inheritAttrs=!1;const en=$e;var tn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 00-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 00-11.3 0L405.6 242.3a7.23 7.23 0 005.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 00.1-11.4z"}}]},name:"drag",theme:"outlined"};const nn=tn;function Ve(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),l.forEach(function(r){ln(e,r,a[r])})}return e}function ln(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var xe=function(t,a){var l=Ve({},t,a.attrs);return i(ne,Ve({},l,{icon:nn}),null)};xe.displayName="DragOutlined";xe.inheritAttrs=!1;const an=xe;var sn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 000 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 00391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 00-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]},name:"fullscreen-exit",theme:"outlined"};const on=sn;function qe(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),l.forEach(function(r){rn(e,r,a[r])})}return e}function rn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Se=function(t,a){var l=qe({},t,a.attrs);return i(ne,qe({},l,{icon:on}),null)};Se.displayName="FullscreenExitOutlined";Se.inheritAttrs=!1;const un=Se;var cn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0013.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 000 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 00-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]},name:"fullscreen",theme:"outlined"};const dn=cn;function Xe(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),l.forEach(function(r){vn(e,r,a[r])})}return e}function vn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ce=function(t,a){var l=Xe({},t,a.attrs);return i(ne,Xe({},l,{icon:dn}),null)};Ce.displayName="FullscreenOutlined";Ce.inheritAttrs=!1;const fn=Ce;var pn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M603.3 327.5l-246 178a7.95 7.95 0 000 12.9l246 178c5.3 3.8 12.7 0 12.7-6.5V643c0-10.2-4.9-19.9-13.2-25.9L457.4 512l145.4-105.2c8.3-6 13.2-15.6 13.2-25.9V334c0-6.5-7.4-10.3-12.7-6.5z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"left-circle",theme:"outlined"};const mn=pn;function Ye(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),l.forEach(function(r){gn(e,r,a[r])})}return e}function gn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Pe=function(t,a){var l=Ye({},t,a.attrs);return i(ne,Ye({},l,{icon:mn}),null)};Pe.displayName="LeftCircleOutlined";Pe.inheritAttrs=!1;const fl=Pe;var hn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M666.7 505.5l-246-178A8 8 0 00408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512 421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"right-circle",theme:"outlined"};const yn=hn;function Ge(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),l.forEach(function(r){_n(e,r,a[r])})}return e}function _n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ie=function(t,a){var l=Ge({},t,a.attrs);return i(ne,Ge({},l,{icon:yn}),null)};Ie.displayName="RightCircleOutlined";Ie.inheritAttrs=!1;const pl=Ie,wn="/infinite_image_browsing/fe-static/assets/fullscreen-7f54b926.svg";function ml(){const{previewIdx:e,eventEmitter:t,canLoadNext:a,previewing:l,sortedFiles:r,scroller:p,props:L}=me().toRefs(),{state:C}=me();let I=null;const N=(m,u)=>{var v;l.value=m,I!=null&&!m&&u&&((v=p.value)==null||v.scrollToItem(I),I=null)},W=()=>{L.value.mode==="walk"&&!w("next")&&a&&(G.info(x("loadingNextFolder")),t.value.emit("loadNextDir",!0))};ie("keydown",m=>{var u;if(l.value){let v=e.value;if(["ArrowDown","ArrowRight"].includes(m.key))for(v++;r.value[v]&&!q(r.value[v].name);)v++;else if(["ArrowUp","ArrowLeft"].includes(m.key))for(v--;r.value[v]&&!q(r.value[v].name);)v--;if(q((u=r.value[v])==null?void 0:u.name)??""){e.value=v;const b=p.value;b&&!(v>=b.$_startIndex&&v<=b.$_endIndex)&&(I=v)}W()}});const M=m=>{var v;let u=e.value;if(m==="next")for(u++;r.value[u]&&!q(r.value[u].name);)u++;else if(m==="prev")for(u--;r.value[u]&&!q(r.value[u].name);)u--;if(q((v=r.value[u])==null?void 0:v.name)??""){e.value=u;const b=p.value;b&&!(u>=b.$_startIndex&&u<=b.$_endIndex)&&(I=u)}W()},w=m=>{var v;let u=e.value;if(m==="next")for(u++;r.value[u]&&!q(r.value[u].name);)u++;else if(m==="prev")for(u--;r.value[u]&&!q(r.value[u].name);)u--;return q((v=r.value[u])==null?void 0:v.name)??""};return Oe("removeFiles",async()=>{var m;l.value&&!C.sortedFiles[e.value]&&(G.info(x("manualExitFullScreen"),5),await it(500),(m=document.querySelector(".ant-image-preview-operations-operation .anticon-close"))==null||m.click(),e.value=-1)}),{previewIdx:e,onPreviewVisibleChange:N,previewing:l,previewImgMove:M,canPreview:w}}function be(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!dt(e)}function gl(){const{currLocation:e,sortedFiles:t,currPage:a,multiSelectedIdxs:l,eventEmitter:r,walker:p}=me().toRefs(),L=()=>{l.value=[]};return ie("click",()=>{B.keepMultiSelect||L()}),ie("blur",()=>{B.keepMultiSelect||L()}),te(a,L),{onFileDragStart:(W,M)=>{const w=ut(t.value[M]);Be.fileDragging=!0,console.log("onFileDragStart set drag file ",W,M,w);const m=[w];let u=w.type==="dir";if(l.value.includes(M)){const b=l.value.map(A=>t.value[A]);m.push(...b),u=b.some(A=>A.type==="dir")}const v={includeDir:u,loc:e.value||"search-result",path:Ae(m,"fullpath").map(b=>b.fullpath),nodes:Ae(m,"fullpath"),__id:"FileTransferData"};W.dataTransfer.setData("text/plain",JSON.stringify(v))},onDrop:async W=>{if(p.value)return;const M=ct(W);if(!M)return;const w=e.value;if(M.loc===w)return;const m=Le(),u=async()=>m.pushAction(async()=>{await Bt(M.path,w),r.value.emit("refresh"),oe.destroyAll()}),v=()=>m.pushAction(async()=>{await nt(M.path,w),pe.emit("removeFiles",{paths:M.path,loc:M.loc}),r.value.emit("refresh"),oe.destroyAll()});oe.confirm({title:x("confirm")+"?",width:"60vw",content:()=>{let b,A,k;return i("div",null,[i("div",null,[`${x("moveSelectedFilesTo")} ${w}`,i("ol",{style:{maxHeight:"50vh",overflow:"auto"}},[M.path.map(O=>i("li",null,[O.split(/[/\\]/).pop()]))])]),i(tt,null,null),i("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},class:"actions"},[i(ee,{onClick:oe.destroyAll},be(b=x("cancel"))?b:{default:()=>[b]}),i(ee,{type:"primary",loading:!m.isIdle,onClick:u},be(A=x("copy"))?A:{default:()=>[A]}),i(ee,{type:"primary",loading:!m.isIdle,onClick:v},be(k=x("move"))?k:{default:()=>[k]})])])},maskClosable:!0,wrapClassName:"hidden-antd-btns-modal"})},multiSelectedIdxs:l,onFileDragEnd:()=>{Be.fileDragging=!1}}}function hl({openNext:e}){const t=J(!1),a=J(""),{sortedFiles:l,previewIdx:r,multiSelectedIdxs:p,stack:L,currLocation:C,spinning:I,previewing:N,stackViewEl:W,eventEmitter:M,props:w,deletedFiles:m}=me().toRefs(),u=ze;Oe("removeFiles",({paths:O,loc:s})=>{u(s)!==u(C.value)||!Ue(L.value)||(O.forEach(c=>m.value.add(c)),O.filter(q).forEach(c=>m.value.add(c.replace(/\.\w+$/,".txt"))))}),Oe("addFiles",({files:O,loc:s})=>{if(u(s)!==u(C.value))return;const f=Ue(L.value);f&&f.files.unshift(...O)});const v=Le(),b=async(O,s,f)=>{r.value=f,B.fullscreenPreviewInitialUrl=K(s);const c=p.value.indexOf(f);if(O.shiftKey){if(c!==-1)p.value.splice(c,1);else{p.value.push(f),p.value.sort((z,U)=>z-U);const D=p.value[0],H=p.value[p.value.length-1];p.value=Nt(D,H+1)}O.stopPropagation()}else O.ctrlKey||O.metaKey?(c!==-1?p.value.splice(c,1):p.value.push(f),O.stopPropagation()):await e(s)},A=async(O,s,f)=>{var Q,R,ae;const c=K(s),D=C.value,H={IIB_container_id:parent.IIB_container_id},z=()=>{let n=[];return p.value.includes(f)?n=p.value.map(o=>l.value[o]):n.push(s),n},U=async n=>{if(!I.value)try{I.value=!0,await _t(s.fullpath),ve.postMessage({...H,event:"click_hidden_button",btnEleId:"iib_hidden_img_update_trigger"}),await wt(),ve.postMessage({...H,event:"click_hidden_button",btnEleId:`iib_hidden_tab_${n}`})}catch(o){console.error(o),G.error("发送图像失败，请携带console的错误消息找开发者")}finally{I.value=!1}},V=`${O.key}`;if(V.startsWith("toggle-tag-")){const n=+V.split("toggle-tag-")[1],{is_remove:o}=await vt({tag_id:n,img_path:s.fullpath}),T=(R=(Q=B.conf)==null?void 0:Q.all_custom_tags.find(S=>S.id===n))==null?void 0:R.name;await _e.refreshTags([s.fullpath]),G.success(x(o?"removedTagFromImage":"addedTagToImage",{tag:T}));return}else if(V.startsWith("batch-add-tag-")||V.startsWith("batch-remove-tag-")){const n=+V.split("-tag-")[1],o=V.includes("add")?"add":"remove",T=z().map(S=>S.fullpath);await ft({tag_id:n,img_paths:T,action:o}),await _e.refreshTags(T),G.success(x(o==="add"?"addCompleted":"removeCompleted"));return}switch(O.key){case"previewInNewWindow":return window.open(c);case"saveSelectedAsJson":return yt(z());case"openWithDefaultApp":return ht(s.fullpath);case"download":{const n=z();gt(n.map(o=>K(o,!0)));break}case"copyPreviewUrl":return fe(parent.document.location.origin+c);case"rename":{let n=await Ut(s.fullpath);n=ze(n);const o=_e.tagMap;o.set(n,o.get(s.fullpath)??[]),o.delete(s.fullpath),s.fullpath=n,s.name=n.split(/[\\/]/).pop()??"";return}case"send2txt2img":return U("txt2img");case"send2img2img":return U("img2img");case"send2inpaint":return U("inpaint");case"send2extras":return U("extras");case"send2savedDir":{const n=B.quickMovePaths.find(S=>S.key==="outdir_save");if(!n)return G.error(x("unknownSavedDir"));const o=mt(n.dir,(ae=B.conf)==null?void 0:ae.sd_cwd),T=z();await nt(T.map(S=>S.fullpath),o,!0),pe.emit("removeFiles",{paths:T.map(S=>S.fullpath),loc:C.value}),pe.emit("addFiles",{files:T,loc:o});break}case"send2controlnet-img2img":case"send2controlnet-txt2img":{const n=O.key.split("-")[1];ve.postMessage({...H,event:"send_to_control_net",type:n,url:K(s)});break}case"send2outpaint":{a.value=await v.pushAction(()=>ke(s.fullpath)).res;const[n,o]=(a.value||"").split(`
`);ve.postMessage({...H,event:"send_to_outpaint",url:K(s),prompt:n,negPrompt:o.slice(17)});break}case"openWithWalkMode":{we.set(D,L.value);const n=B.tabList[w.value.tabIdx],o={type:"local",key:ue(),path:s.fullpath,name:x("local"),stackKey:D,mode:"walk"};n.panes.push(o),n.key=o.key;break}case"openInNewTab":{we.set(D,L.value);const n=B.tabList[w.value.tabIdx],o={type:"local",key:ue(),path:s.fullpath,name:x("local"),stackKey:D};n.panes.push(o),n.key=o.key;break}case"openOnTheRight":{we.set(D,L.value);let n=B.tabList[w.value.tabIdx+1];n||(n={panes:[],key:"",id:ue()},B.tabList[w.value.tabIdx+1]=n);const o={type:"local",key:ue(),path:s.fullpath,name:x("local"),stackKey:D};n.panes.push(o),n.key=o.key;break}case"send2BatchDownload":{Wt.addFiles(z());break}case"viewGenInfo":{t.value=!0,a.value=await v.pushAction(()=>ke(s.fullpath)).res;break}case"openWithLocalFileBrowser":{await pt(s.fullpath);break}case"deleteFiles":{const n=z(),o=async()=>{const T=n.map(S=>S.fullpath);await Ht(T),G.success(x("deleteSuccess")),pe.emit("removeFiles",{paths:T,loc:C.value})};if(n.length===1&&B.ignoredConfirmActions.deleteOneOnly)return o();await new Promise(T=>{oe.confirm({title:x("confirmDelete"),maskClosable:!0,width:"60vw",content:()=>i("div",null,[i("ol",{style:{maxHeight:"50vh",overflow:"auto"}},[n.map(S=>i("li",null,[S.fullpath.split(/[/\\]/).pop()]))]),i(tt,null,null),i(Vt,{checked:B.ignoredConfirmActions.deleteOneOnly,"onUpdate:checked":S=>B.ignoredConfirmActions.deleteOneOnly=S},{default:()=>[x("deleteOneOnlySkipConfirm"),$(" ("),x("resetOnGlobalSettingsPage"),$(")")]})]),async onOk(){await o(),T()}})});break}}return{}},{isOutside:k}=Qe(W);return ie("keydown",O=>{var f,c,D;const s=qt(O);if(N.value){s==="Esc"&&(N.value=!1);const H=(f=Object.entries(B.shortcut).find(z=>z[1]===s&&z[1]))==null?void 0:f[0];if(H){O.stopPropagation(),O.preventDefault();const z=r.value,U=l.value[z];switch(H){case"delete":return K(U)===B.fullscreenPreviewInitialUrl?G.warn(x("fullscreenRestriction")):A({key:"deleteFiles"},U,z);case"download":return A({key:"download"},U,z);default:{const V=(c=/^toggle_tag_(.*)$/.exec(H))==null?void 0:c[1],Q=(D=B.conf)==null?void 0:D.all_custom_tags.find(R=>R.name===V);return Q?A({key:`toggle-tag-${Q.id}`},U,z):void 0}}}}else!k.value&&["Ctrl + KeyA","Cmd + KeyA"].includes(s)&&(O.preventDefault(),O.stopPropagation(),M.value.emit("selectAll"))}),{onFileItemClick:b,onContextMenuClick:A,showGenInfo:t,imageGenInfo:a,q:v}}function bn(e,t,a,l){let r=0,p=0,L=typeof(l==null?void 0:l.width)=="number"?l.width:0,C=typeof(l==null?void 0:l.height)=="number"?l.height:0,I=typeof(l==null?void 0:l.left)=="number"?l.left:0,N=typeof(l==null?void 0:l.top)=="number"?l.top:0,W=!1;const M=s=>{s.stopPropagation(),s.preventDefault(),!(!e.value||!t.value)&&(r=s instanceof MouseEvent?s.clientX:s.touches[0].clientX,p=s instanceof MouseEvent?s.clientY:s.touches[0].clientY,L=e.value.offsetWidth,C=e.value.offsetHeight,t.value.offsetLeft,t.value.offsetTop,document.documentElement.addEventListener("mousemove",w),document.documentElement.addEventListener("touchmove",w),document.documentElement.addEventListener("mouseup",m),document.documentElement.addEventListener("touchend",m))},w=s=>{if(!e.value||!t.value)return;let f=L+((s instanceof MouseEvent?s.clientX:s.touches[0].clientX)-r),c=C+((s instanceof MouseEvent?s.clientY:s.touches[0].clientY)-p);e.value.offsetLeft+f>window.innerWidth&&(f=window.innerWidth-e.value.offsetLeft),e.value.offsetTop+c>window.innerHeight&&(c=window.innerHeight-e.value.offsetTop),e.value.style.width=`${f}px`,e.value.style.height=`${c}px`,l!=null&&l.onResize&&l.onResize(f,c)},m=()=>{document.documentElement.removeEventListener("mousemove",w),document.documentElement.removeEventListener("touchmove",w),document.documentElement.removeEventListener("mouseup",m),document.documentElement.removeEventListener("touchend",m)},u=s=>{s.stopPropagation(),s.preventDefault(),!(!e.value||!a.value)&&(W=!0,I=e.value.offsetLeft,N=e.value.offsetTop,r=s instanceof MouseEvent?s.clientX:s.touches[0].clientX,p=s instanceof MouseEvent?s.clientY:s.touches[0].clientY,document.documentElement.addEventListener("mousemove",v),document.documentElement.addEventListener("touchmove",v),document.documentElement.addEventListener("mouseup",b),document.documentElement.addEventListener("touchend",b))},v=s=>{if(!e.value||!a.value||!W)return;const f=I+((s instanceof MouseEvent?s.clientX:s.touches[0].clientX)-r),c=N+((s instanceof MouseEvent?s.clientY:s.touches[0].clientY)-p);f<0?e.value.style.left="0px":f+e.value.offsetWidth>window.innerWidth?e.value.style.left=`${window.innerWidth-e.value.offsetWidth}px`:e.value.style.left=`${f}px`,c<0?e.value.style.top="0px":c+e.value.offsetHeight>window.innerHeight?e.value.style.top=`${window.innerHeight-e.value.offsetHeight}px`:e.value.style.top=`${c}px`,l!=null&&l.onDrag&&l.onDrag(f,c)},b=()=>{W=!1,document.documentElement.removeEventListener("mousemove",v),document.documentElement.removeEventListener("touchmove",v),document.documentElement.removeEventListener("mouseup",b),document.documentElement.removeEventListener("touchend",b)},A=()=>{if(!e.value||!t.value)return;let s=e.value.offsetLeft,f=e.value.offsetTop,c=e.value.offsetWidth,D=e.value.offsetHeight;s+c>window.innerWidth&&(s=window.innerWidth-c,s<0&&(s=0,c=window.innerWidth)),f+D>window.innerHeight&&(f=window.innerHeight-D,f<0&&(f=0,D=window.innerHeight)),e.value.style.left=`${s}px`,e.value.style.top=`${f}px`,e.value.style.width=`${c}px`,e.value.style.height=`${D}px`},k=()=>{!e.value||!l||(typeof l.width=="number"&&(e.value.style.width=`${l.width}px`),typeof l.height=="number"&&(e.value.style.height=`${l.height}px`),typeof l.left=="number"&&(e.value.style.left=`${l.left}px`),typeof l.top=="number"&&(e.value.style.top=`${l.top}px`),A(),window.addEventListener("resize",A))},O=()=>{document.documentElement.removeEventListener("mousemove",w),document.documentElement.removeEventListener("touchmove",w),document.documentElement.removeEventListener("mouseup",m),document.documentElement.removeEventListener("touchend",m),document.documentElement.removeEventListener("mousemove",v),document.documentElement.removeEventListener("touchmove",v),document.documentElement.removeEventListener("mouseup",b),document.documentElement.removeEventListener("touchend",b),window.removeEventListener("resize",A)};return Ze(k),Ke(O),te(()=>l==null?void 0:l.disbaled,async s=>{await bt(),s!==void 0&&(s?O():k())}),te(()=>[e.value,t.value,a.value],([s,f,c])=>{s&&f&&(f.addEventListener("mousedown",M),f.addEventListener("touchstart",M)),s&&c&&(c.addEventListener("mousedown",u),c.addEventListener("touchstart",u))}),{handleResizeMouseDown:M,handleDragMouseDown:u}}const kn=()=>{var C,I;const e=Ee(),t=kt(((I=(C=e.conf)==null?void 0:C.app_fe_setting)==null?void 0:I.fullscreen_layout)??{enable:!1,panelWidth:384,alwaysOn:!0}),a="--iib-lr-layout-info-panel-width",l=Y(()=>t.alwaysOn&&t.enable?t.panelWidth:0);te(t,()=>{Je(t,a,l),On(t)},{deep:!0}),Ze(()=>Je(t,a,l));const{enable:r,panelWidth:p,alwaysOn:L}=Ot(t);return{state:t,isLeftRightLayout:r,panelwidtrhStyleVarName:a,lrLayoutInfoPanelWidth:p,lrMenuAlwaysOn:L}},On=re(e=>Lt("fullscreen_layout",e),300),Je=re((e,t,a)=>{e.enable?(document.body.classList.add("fullscreen-lr-layout"),document.documentElement.style.setProperty(t,`${e.panelWidth}px`),document.documentElement.style.setProperty("--iib-lr-layout-container-offset",`${a.value}px`)):(document.documentElement.style.removeProperty(t),document.documentElement.style.removeProperty("--iib-lr-layout-container-offset"),document.body.classList.remove("fullscreen-lr-layout"))},300),le=e=>(At("data-v-ac92d96e"),e=e(),zt(),e),Ln={key:0},En={class:"container"},$n={class:"action-bar"},xn=["title"],Sn=["title"],Cn=["title"],Pn=["src"],In={key:0,class:"icon",style:{cursor:"pointer"}},Mn={key:2,"flex-placeholder":""},Fn={key:3,class:"action-bar"},Dn={key:0,class:"gen-info"},Tn={class:"info-tags"},An={class:"name"},zn={class:"value"},Nn={key:0,class:"tags-container"},Wn=["onClick"],jn={class:"lr-layout-control"},Bn={class:"ctrl-item"},Un={class:"ctrl-item"},Hn={class:"ctrl-item"},Vn=le(()=>P("br",null,null,-1)),qn=le(()=>P("h3",null,"Prompt",-1)),Xn=["innerHTML"],Yn=le(()=>P("br",null,null,-1)),Gn=le(()=>P("h3",null,"Negative Prompt",-1)),Jn=["innerHTML"],Kn=le(()=>P("br",null,null,-1)),Qn=le(()=>P("h3",null,"Params",-1)),Zn={style:{"font-weight":"600","text-transform":"capitalize"}},Rn=["onDblclick"],el=["onDblclick"],tl=["title"],nl=Re({__name:"fullScreenContextMenu",props:{file:{},idx:{}},emits:["contextMenuClick"],setup(e,{emit:t}){const a=e;Et(n=>({"314a6198":d(s)+"px","9284b548":`calc(100vw - ${d(s)}px)`}));const l=Ee(),r=$t(),p=J(),L=Y(()=>r.tagMap.get(a.file.fullpath)??[]),C=J(""),I=Le(),N=J(""),W=Y(()=>N.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),M=Y(()=>W.value.split(`
`)),w=Y(()=>Ne(W.value)),m=Y(()=>{let n=Ne(W.value);return delete n.prompt,delete n.negativePrompt,n});te(()=>{var n;return(n=a==null?void 0:a.file)==null?void 0:n.fullpath},async n=>{n&&(I.tasks.forEach(o=>o.cancel()),I.pushAction(()=>ke(n)).res.then(o=>{N.value=o}))},{immediate:!0});const u=We("iib@fullScreenContextMenu.prompt-tab","structedData"),v=J(),b=J(),A={left:100,top:100,width:512,height:384,expanded:!0},k=We("fullScreenContextMenu.vue-drag",A);k.value&&(k.value.left<0||k.value.top<0)&&(k.value={...A});const{isLeftRightLayout:O,lrLayoutInfoPanelWidth:s,lrMenuAlwaysOn:f}=kn(),c=O;bn(p,v,b,{disbaled:c,...k.value,onDrag:re(function(n,o){k.value={...k.value,left:n,top:o}},300),onResize:re(function(n,o){k.value={...k.value,width:n,height:o}},300)});const D=J(!1),{isOutside:H}=Qe(Y(()=>!c.value||f.value?null:D.value?p.value:document.querySelector(".iib-tab-edge-trigger")));te(H,Kt(n=>{D.value=!n},300));function z(n){return n.parentNode}function U(n){if(!n)return"";let o="";const T=n.split(/[\n,]+/).map(F=>F.trim()).filter(F=>F);let S=!1;for(let F=0;F<T.length;F++){const se=T[F];S||(S=se.includes("(")),o+=`<span class="${S?"has-parentheses":""}">${se}</span>`,F<T.length-1&&(o+=","),S&&(S=!se.includes(")"))}return o}ie("load",n=>{const o=n.target;o.className==="ant-image-preview-img"&&(C.value=`${o.naturalWidth} x ${o.naturalHeight}`)},{capture:!0});const V=Y(()=>{const n=[{name:x("fileName"),val:a.file.name},{name:x("fileSize"),val:a.file.size}];return C.value&&n.push({name:x("resolution"),val:C.value}),n}),Q=()=>{const n="Negative prompt:",o=N.value.includes(n)?N.value.split(n)[0]:M.value[0]??"";fe(ye(o.trim()))},R=()=>document.body.requestFullscreen(),ae=n=>{fe(typeof n=="object"?JSON.stringify(n,null,4):n)};return(n,o)=>{var Te;const T=Gt,S=ee,F=Pt,se=It,Me=Mt,lt=ee,Fe=Xt,at=Yt,st=Ft,De=Dt,ot=Tt;return y(),E("div",{ref_key:"el",ref:p,class:je(["full-screen-menu",{"unset-size":!d(k).expanded,lr:d(c),"always-on":d(f),"mouse-in":D.value}]),onWheelCapture:o[9]||(o[9]=Ct(()=>{},["stop"]))},[d(c)?(y(),E("div",Ln)):j("",!0),P("div",En,[P("div",$n,[d(c)?j("",!0):(y(),E("div",{key:0,ref_key:"dragHandle",ref:b,class:"icon",style:{cursor:"grab"},title:d(x)("dragToMovePanel")},[i(d(an))],8,xn)),d(c)?j("",!0):(y(),E("div",{key:1,class:"icon",style:{cursor:"pointer"},onClick:o[0]||(o[0]=g=>d(k).expanded=!d(k).expanded),title:d(x)("clickToToggleMaximizeMinimize")},[d(k).expanded?(y(),ce(d(un),{key:0})):(y(),ce(d(fn),{key:1}))],8,Sn)),P("div",{style:{display:"flex","flex-direction":"column","align-items":"center",cursor:"grab"},class:"icon",title:d(x)("fullscreenview"),onClick:R},[P("img",{src:d(wn),style:{width:"21px",height:"21px","padding-bottom":"2px"},alt:""},null,8,Pn)],8,Cn),i(T,{"get-popup-container":z},{overlay:h(()=>[i(jt,{file:n.file,idx:n.idx,"selected-tag":L.value,"disable-delete":d(K)(n.file)===d(l).fullscreenPreviewInitialUrl,onContextMenuClick:o[1]||(o[1]=(g,Z,ge)=>t("contextMenuClick",g,Z,ge))},null,8,["file","idx","selected-tag","disable-delete"])]),default:h(()=>[d(k).expanded?j("",!0):(y(),E("div",In,[i(d(xt))]))]),_:1}),d(k).expanded?(y(),E("div",Mn)):j("",!0),d(k).expanded?(y(),E("div",Fn,[i(T,{trigger:["hover"],"get-popup-container":z},{overlay:h(()=>[i(Me,{onClick:o[2]||(o[2]=g=>t("contextMenuClick",g,n.file,n.idx))},{default:h(()=>{var g;return[((g=d(l).conf)==null?void 0:g.launch_mode)!=="server"?(y(),E(X,{key:0},[i(F,{key:"send2txt2img"},{default:h(()=>[$(_(n.$t("sendToTxt2img")),1)]),_:1}),i(F,{key:"send2img2img"},{default:h(()=>[$(_(n.$t("sendToImg2img")),1)]),_:1}),i(F,{key:"send2inpaint"},{default:h(()=>[$(_(n.$t("sendToInpaint")),1)]),_:1}),i(F,{key:"send2extras"},{default:h(()=>[$(_(n.$t("sendToExtraFeatures")),1)]),_:1}),i(se,{key:"sendToThirdPartyExtension",title:n.$t("sendToThirdPartyExtension")},{default:h(()=>[i(F,{key:"send2controlnet-txt2img"},{default:h(()=>[$("ControlNet - "+_(n.$t("t2i")),1)]),_:1}),i(F,{key:"send2controlnet-img2img"},{default:h(()=>[$("ControlNet - "+_(n.$t("i2i")),1)]),_:1}),i(F,{key:"send2outpaint"},{default:h(()=>[$("openOutpaint")]),_:1})]),_:1},8,["title"])],64)):j("",!0),i(F,{key:"send2BatchDownload"},{default:h(()=>[$(_(n.$t("sendToBatchDownload")),1)]),_:1}),i(F,{key:"send2savedDir"},{default:h(()=>[$(_(n.$t("send2savedDir")),1)]),_:1}),i(F,{key:"deleteFiles",disabled:d(K)(n.file)===d(l).fullscreenPreviewInitialUrl},{default:h(()=>[$(_(n.$t("deleteSelected")),1)]),_:1},8,["disabled"]),i(F,{key:"previewInNewWindow"},{default:h(()=>[$(_(n.$t("previewInNewWindow")),1)]),_:1}),i(F,{key:"copyPreviewUrl"},{default:h(()=>[$(_(n.$t("copySourceFilePreviewLink")),1)]),_:1})]}),_:1})]),default:h(()=>[i(S,null,{default:h(()=>[$(_(d(x)("openContextMenu")),1)]),_:1})]),_:1}),i(lt,{onClick:o[3]||(o[3]=g=>t("contextMenuClick",{key:"download"},a.file,a.idx))},{default:h(()=>[$(_(n.$t("download")),1)]),_:1}),N.value?(y(),ce(S,{key:0,onClick:o[4]||(o[4]=g=>d(fe)(N.value))},{default:h(()=>[$(_(n.$t("copyPrompt")),1)]),_:1})):j("",!0),N.value?(y(),ce(S,{key:1,onClick:Q},{default:h(()=>[$(_(n.$t("copyPositivePrompt")),1)]),_:1})):j("",!0)])):j("",!0)]),d(k).expanded?(y(),E("div",Dn,[P("div",Tn,[(y(!0),E(X,null,he(V.value,g=>(y(),E("span",{class:"info-tag",key:g.name},[P("span",An,_(g.name),1),P("span",zn,_(g.val),1)]))),128))]),(Te=d(l).conf)!=null&&Te.all_custom_tags?(y(),E("div",Nn,[(y(!0),E(X,null,he(d(l).conf.all_custom_tags,g=>(y(),E("div",{class:je(["tag",{selected:L.value.some(Z=>Z.id===g.id)}]),onClick:Z=>t("contextMenuClick",{key:`toggle-tag-${g.id}`},n.file,n.idx),key:g.id,style:St({"--tag-color":d(r).getColor(g.name)})},_(g.name),15,Wn))),128))])):j("",!0),P("div",jn,[P("div",Bn,[$(_(n.$t("experimentalLRLayout"))+"： ",1),i(Fe,{checked:d(c),"onUpdate:checked":o[5]||(o[5]=g=>de(c)?c.value=g:null),size:"small"},null,8,["checked"])]),d(c)?(y(),E(X,{key:0},[P("div",Un,[$(_(n.$t("width"))+": ",1),i(at,{value:d(s),"onUpdate:value":o[6]||(o[6]=g=>de(s)?s.value=g:null),style:{width:"64px"},step:16,min:128,max:1024},null,8,["value"])]),i(st,{title:n.$t("alwaysOnTooltipInfo")},{default:h(()=>[P("div",Hn,[$(_(n.$t("alwaysOn"))+"： ",1),i(Fe,{checked:d(f),"onUpdate:checked":o[7]||(o[7]=g=>de(f)?f.value=g:null),size:"small"},null,8,["checked"])])]),_:1},8,["title"])],64)):j("",!0)]),i(ot,{activeKey:d(u),"onUpdate:activeKey":o[8]||(o[8]=g=>de(u)?u.value=g:null)},{default:h(()=>[i(De,{key:"structedData",tab:n.$t("structuredData")},{default:h(()=>[P("div",null,[w.value.prompt?(y(),E(X,{key:0},[Vn,qn,P("code",{innerHTML:U(w.value.prompt??"")},null,8,Xn)],64)):j("",!0),w.value.negativePrompt?(y(),E(X,{key:1},[Yn,Gn,P("code",{innerHTML:U(w.value.negativePrompt??"")},null,8,Jn)],64)):j("",!0)]),Object.keys(m.value).length?(y(),E(X,{key:0},[Kn,Qn,P("table",null,[(y(!0),E(X,null,he(m.value,(g,Z)=>(y(),E("tr",{key:Z,class:"gen-info-frag"},[P("td",Zn,_(Z),1),typeof g=="object"?(y(),E("td",{key:0,style:{cursor:"pointer"},onDblclick:ge=>ae(g)},[P("code",null,_(g),1)],40,Rn)):(y(),E("td",{key:1,style:{cursor:"pointer"},onDblclick:ge=>ae(d(ye)(g))},_(d(ye)(g)),41,el))]))),128))])],64)):j("",!0)]),_:1},8,["tab"]),i(De,{key:"sourceText",tab:n.$t("sourceText")},{default:h(()=>[P("code",null,_(N.value),1)]),_:1},8,["tab"])]),_:1},8,["activeKey"])])):j("",!0)]),d(k).expanded&&!d(c)?(y(),E("div",{key:1,class:"mouse-sensor",ref_key:"resizeHandle",ref:v,title:d(x)("dragToResizePanel")},[i(d(en))],8,tl)):j("",!0)],34)}}});const yl=et(nl,[["__scopeId","data-v-ac92d96e"]]),ll={key:0,class:"float-panel"},al={key:0,class:"select-actions"},sl={key:1},ol=Re({__name:"MultiSelectKeep",props:{show:{type:Boolean}},emits:["selectAll","reverseSelect","clearAllSelected"],setup(e,{emit:t}){const a=Ee(),l=()=>{t("clearAllSelected"),a.keepMultiSelect=!1},r=()=>{a.keepMultiSelect=!0};return(p,L)=>{const C=ee;return p.show?(y(),E("div",ll,[d(a).keepMultiSelect?(y(),E("div",al,[i(C,{size:"small",onClick:L[0]||(L[0]=I=>t("selectAll"))},{default:h(()=>[$(_(p.$t("select-all")),1)]),_:1}),i(C,{size:"small",onClick:L[1]||(L[1]=I=>t("reverseSelect"))},{default:h(()=>[$(_(p.$t("rerverse-select")),1)]),_:1}),i(C,{size:"small",onClick:L[2]||(L[2]=I=>t("clearAllSelected"))},{default:h(()=>[$(_(p.$t("clear-all-selected")),1)]),_:1}),i(C,{size:"small",onClick:l},{default:h(()=>[$(_(p.$t("exit")),1)]),_:1})])):(y(),E("div",sl,[i(C,{size:"small",type:"primary",onClick:r},{default:h(()=>[$(_(p.$t("keep-multi-selected")),1)]),_:1})]))])):j("",!0)}}});const _l=et(ol,[["__scopeId","data-v-b04c3508"]]);export{fl as L,_l as M,pl as R,gl as a,hl as b,ml as c,yl as f,ie as u};
