import{d as xe,r as k,o as Ce,b_ as Q,k as Ie,y as Re,aw as $e,v as Ae,x as Me,z as W,b$ as ze,X as Fe,O as c,Q as I,c as t,Z as s,$ as e,R as u,S as i,T as o,Y as m,V as v,a0 as X,c5 as Ue,ab as U,a1 as Y,E as De,aa as Be,U as Ee,ae as Z,af as Ve,ag as j,c2 as Ke,ad as Te,aK as He,aL as Le,c6 as Oe,c4 as qe,W as Ge}from"./index-1961a2a7.js";import{S as Je}from"./index-374f1119.js";/* empty css              */import"./index-7e005f25.js";import{c as Ne,d as Pe,F as Qe}from"./FileItem-97e3c353.js";import{M as We,L as Xe,R as Ye,f as Ze}from"./MultiSelectKeep-95a62820.js";import{c as je,u as es}from"./hook-384ae324.js";import{f as R,H as ee,_ as ss,a as ts}from"./searchHistory-c4b23c63.js";import"./functionalCallableComp-0536b145.js";import"./index-8dbf40be.js";/* empty css              */import"./shortcut-14bd4711.js";import"./Checkbox-0e82a685.js";const ls="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",D=w=>(He("data-v-9cf612bf"),w=w(),Le(),w),as={style:{"padding-right":"16px"}},ns=D(()=>u("div",null,null,-1)),os=["src"],is={class:"search-bar"},rs={class:"form-name"},us={class:"search-bar last actions"},ds={class:"hint"},cs={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},ps={style:{margin:"16px 32px 16px"}},vs={style:{"padding-right":"16px"}},fs=D(()=>u("div",null,null,-1)),ms=D(()=>u("div",{style:{padding:"16px 0 512px"}},null,-1)),_s={key:2,class:"preview-switch"},gs=xe({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(w){const $=w,_=k(!1),g=k(""),h=k($.searchScope??""),b=k(!1),B=k(0),A=je(l=>{const a={cursor:l,regexp:_.value?g.value:"",surstr:_.value?"":g.value,folder_paths:(h.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r)};return Oe(a)}),{queue:y,images:p,onContextMenuClickU:E,stackViewEl:se,previewIdx:S,previewing:V,onPreviewVisibleChange:te,previewImgMove:K,canPreview:T,itemSize:H,gridItems:le,showGenInfo:x,imageGenInfo:L,q:ae,multiSelectedIdxs:M,onFileItemClick:ne,scroller:O,showMenuIdx:z,onFileDragStart:oe,onFileDragEnd:ie,cellWidth:re,onScroll:q,saveAllFileAsJson:ue,saveLoadedFileAsJson:de,props:ce}=es(A),d=k();Ce(async()=>{d.value=await Q(),d.value.img_count&&d.value.expired&&await G(),$.searchScope&&await C()}),Ie(()=>$,async l=>{ce.value=l},{deep:!0,immediate:!0});const G=Re(()=>y.pushAction(async()=>(await qe(),d.value=await Q(),d.value)).res),J=l=>{g.value=l.substr,h.value=l.folder_paths_str,_.value=l.isRegex,b.value=!1,C()},C=async()=>{B.value++,R.value.add({substr:g.value,folder_paths_str:h.value,isRegex:_.value}),await A.reset({refetch:!0}),await $e(),q(),O.value.scrollToItem(0),p.value.length||Ae.info(Me("fuzzy-search-noResults"))};W("returnToIIB",async()=>{const l=await y.pushAction(ze).res;d.value.expired=l.expired}),W("searchIndexExpired",()=>d.value&&(d.value.expired=!0));const pe=()=>{_.value=!_.value},ve=Fe(),{onClearAllSelected:fe,onSelectAll:me,onReverseSelect:_e}=Ne();return(l,a)=>{const r=ss,f=ts,ge=Z,he=Ve,N=j,ye=Ke,F=j,ke=Te,we=Z,be=Je;return c(),I(Ee,null,[t(ge,{visible:b.value,"onUpdate:visible":a[0]||(a[0]=n=>b.value=n),width:"70vw","mask-closable":"",onOk:a[1]||(a[1]=n=>b.value=!1)},{default:s(()=>[t(ee,{records:e(R),onReuseRecord:J},{default:s(({record:n})=>[u("div",as,[t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(c(),m(f,{key:0},{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):v("",!0),t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("time"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),ns])]),_:1},8,["records"])]),_:1},8,["visible"]),u("div",{class:"container",ref_key:"stackViewEl",ref:se},[t(We,{show:!!e(M).length||e(ve).keepMultiSelect,onClearAllSelected:e(fe),onSelectAll:e(me),onReverseSelect:e(_e)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),d.value?(c(),I("div",{key:0,class:"search-bar",onKeydown:a[4]||(a[4]=X(()=>{},["stop"]))},[t(he,{value:g.value,"onUpdate:value":a[2]||(a[2]=n=>g.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(y).isIdle,onKeydown:Ue(C,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),u("div",{class:U(["regex-icon",{selected:_.value}]),onKeydown:a[3]||(a[3]=X(()=>{},["stop"])),onClick:pe,title:"Use Regular Expression"},[u("img",{src:e(ls)},null,8,os)],34),d.value.expired||!d.value.img_count?(c(),m(N,{key:0,onClick:e(G),loading:!e(y).isIdle,type:"primary"},{default:s(()=>[i(o(d.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(c(),m(N,{key:1,type:"primary",onClick:C,loading:!e(y).isIdle||e(A).loading,disabled:!g.value&&!h.value},{default:s(()=>[i(o(l.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):v("",!0),u("div",is,[u("div",rs,o(l.$t("searchScope")),1),t(ye,{"auto-size":{maxRows:8},value:h.value,"onUpdate:value":a[5]||(a[5]=n=>h.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),u("div",us,[e(p).length?(c(),m(F,{key:0,onClick:e(de)},{default:s(()=>[i(o(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):v("",!0),e(p).length?(c(),m(F,{key:1,onClick:e(ue)},{default:s(()=>[i(o(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):v("",!0),t(F,{onClick:a[6]||(a[6]=n=>b.value=!0)},{default:s(()=>[i(o(l.$t("history")),1)]),_:1})]),t(be,{size:"large",spinning:!e(y).isIdle},{default:s(()=>[t(we,{visible:e(x),"onUpdate:visible":a[8]||(a[8]=n=>Y(x)?x.value=n:null),width:"70vw","mask-closable":"",onOk:a[9]||(a[9]=n=>x.value=!1)},{cancelText:s(()=>[]),default:s(()=>[t(ke,{active:"",loading:!e(ae).isIdle},{default:s(()=>[u("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:a[7]||(a[7]=n=>e(De)(e(L)))},[u("div",ds,o(l.$t("doubleClickToCopy")),1),i(" "+o(e(L)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),B.value===0&&!e(p).length&&e(R).getRecords().length?(c(),I("div",cs,[u("h2",ps,o(l.$t("restoreFromHistory")),1),t(ee,{records:e(R),onReuseRecord:J},{default:s(({record:n})=>[u("div",vs,[t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(c(),m(f,{key:0},{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):v("",!0),t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),t(f,null,{default:s(()=>[t(r,{span:4},{default:s(()=>[i(o(l.$t("time"))+":",1)]),_:1}),t(r,{span:20},{default:s(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),fs])]),_:1},8,["records"])])):v("",!0),e(p)?(c(),m(e(Pe),{key:1,ref_key:"scroller",ref:O,class:"file-list",items:e(p),"item-size":e(H).first,"key-field":"fullpath","item-secondary-size":e(H).second,gridItems:e(le),onScroll:e(q)},{after:s(()=>[ms]),default:s(({item:n,index:P})=>[t(Qe,{idx:P,file:n,"show-menu-idx":e(z),"onUpdate:showMenuIdx":a[10]||(a[10]=Se=>Y(z)?z.value=Se:null),onFileItemClick:e(ne),"full-screen-preview-image-url":e(p)[e(S)]?e(Be)(e(p)[e(S)]):"","cell-width":e(re),selected:e(M).includes(P),onContextMenuClick:e(E),onDragstart:e(oe),onDragend:e(ie),"is-selected-mutil-files":e(M).length>1,onPreviewVisibleChange:e(te)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):v("",!0),e(V)?(c(),I("div",_s,[t(e(Xe),{onClick:a[11]||(a[11]=n=>e(K)("prev")),class:U({disable:!e(T)("prev")})},null,8,["class"]),t(e(Ye),{onClick:a[12]||(a[12]=n=>e(K)("next")),class:U({disable:!e(T)("next")})},null,8,["class"])])):v("",!0)]),_:1},8,["spinning"]),e(V)&&e(p)&&e(p)[e(S)]?(c(),m(Ze,{key:1,file:e(p)[e(S)],idx:e(S),onContextMenuClick:e(E)},null,8,["file","idx","onContextMenuClick"])):v("",!0)],512)],64)}}});const zs=Ge(gs,[["__scopeId","data-v-9cf612bf"]]);export{zs as default};
