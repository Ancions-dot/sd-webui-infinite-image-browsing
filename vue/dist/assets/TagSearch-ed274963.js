import{P as j,Y as be,d as ae,br as ge,a_ as _e,Z as F,bt as Ce,l as xe,u as he,ah as Q,$ as X,h as x,c as v,a as Y,bu as Ae,b as Ie,f as we,bv as ke,a2 as se,bw as Pe,a1 as $e,i as Oe,b2 as Se,bx as Be,a4 as Ee,a5 as Te,a6 as Ke,af as Ne,aW as Re,aV as De,by as Me,bz as je,k as Fe,bA as Ue,aj as Ve,aE as Le,bB as oe,bC as ze,o as C,y as S,H as z,z as J,p as D,v as B,r as E,S as te,m as W,n as V,x as q,A as ie,L as re,bD as qe,q as ce,a0 as Ge,ai as He,ap as de,ag as ne,Q as We,U as ue,T as Qe,bE as Ye,W as Ze}from"./index-37f53eea.js";/* empty css              *//* empty css              */import{b as ve,c as Je,d as Xe,r as ea,u as aa}from"./db-587584e4.js";import{b as ta}from"./_baseIteratee-5df75915.js";var na=function(){return{prefixCls:String,activeKey:{type:[Array,Number,String]},defaultActiveKey:{type:[Array,Number,String]},accordion:{type:Boolean,default:void 0},destroyInactivePanel:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},expandIcon:Function,openAnimation:j.object,expandIconPosition:j.oneOf(be("left","right")),collapsible:{type:String},ghost:{type:Boolean,default:void 0},onChange:Function,"onUpdate:activeKey":Function}},me=function(){return{openAnimation:j.object,prefixCls:String,header:j.any,headerClass:String,showArrow:{type:Boolean,default:void 0},isActive:{type:Boolean,default:void 0},destroyInactivePanel:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},accordion:{type:Boolean,default:void 0},forceRender:{type:Boolean,default:void 0},expandIcon:Function,extra:j.any,panelKey:j.oneOfType([j.string,j.number]),collapsible:{type:String},role:String,onItemClick:{type:Function}}};function fe(l){var e=l;if(!Array.isArray(e)){var t=Ie(e);e=t==="number"||t==="string"?[e]:[]}return e.map(function(s){return String(s)})}const Z=ae({compatConfig:{MODE:3},name:"ACollapse",inheritAttrs:!1,props:ge(na(),{accordion:!1,destroyInactivePanel:!1,bordered:!0,openAnimation:_e("ant-motion-collapse",!1),expandIconPosition:"left"}),slots:["expandIcon"],setup:function(e,t){var s=t.attrs,c=t.slots,n=t.emit,o=F(fe(Ce([e.activeKey,e.defaultActiveKey])));xe(function(){return e.activeKey},function(){o.value=fe(e.activeKey)},{deep:!0});var f=he("collapse",e),g=f.prefixCls,P=f.direction,T=Q(function(){var d=e.expandIconPosition;return d!==void 0?d:P.value==="rtl"?"right":"left"}),h=function(r){var u=e.expandIcon,y=u===void 0?c.expandIcon:u,b=y?y(r):v(Pe,{rotate:r.isActive?90:void 0},null);return v("div",null,[$e(Array.isArray(y)?b[0]:b)?se(b,{class:"".concat(g.value,"-arrow")},!1):b])},K=function(r){e.activeKey===void 0&&(o.value=r);var u=e.accordion?r[0]:r;n("update:activeKey",u),n("change",u)},$=function(r){var u=o.value;if(e.accordion)u=u[0]===r?[]:[r];else{u=Oe(u);var y=u.indexOf(r),b=y>-1;b?u.splice(y,1):u.push(r)}K(u)},M=function(r,u){var y,b,R;if(!ke(r)){var a=o.value,i=e.accordion,_=e.destroyInactivePanel,k=e.collapsible,O=e.openAnimation,A=String((y=r.key)!==null&&y!==void 0?y:u),w=r.props||{},I=w.header,p=I===void 0?(b=r.children)===null||b===void 0||(R=b.header)===null||R===void 0?void 0:R.call(b):I,G=w.headerClass,m=w.collapsible,L=w.disabled,U=!1;i?U=a[0]===A:U=a.indexOf(A)>-1;var H=m??k;(L||L==="")&&(H="disabled");var ye={key:A,panelKey:A,header:p,headerClass:G,isActive:U,prefixCls:g.value,destroyInactivePanel:_,openAnimation:O,accordion:i,onItemClick:H==="disabled"?null:$,expandIcon:h,collapsible:H};return se(r,ye)}},N=function(){var r;return we((r=c.default)===null||r===void 0?void 0:r.call(c)).map(M)};return function(){var d,r=e.accordion,u=e.bordered,y=e.ghost,b=X((d={},x(d,g.value,!0),x(d,"".concat(g.value,"-borderless"),!u),x(d,"".concat(g.value,"-icon-position-").concat(T.value),!0),x(d,"".concat(g.value,"-rtl"),P.value==="rtl"),x(d,"".concat(g.value,"-ghost"),!!y),x(d,s.class,!!s.class),d));return v("div",Y(Y({class:b},Ae(s)),{},{style:s.style,role:r?"tablist":null}),[N()])}}}),la=ae({compatConfig:{MODE:3},name:"PanelContent",props:me(),setup:function(e,t){var s=t.slots,c=F(!1);return Se(function(){(e.isActive||e.forceRender)&&(c.value=!0)}),function(){var n,o;if(!c.value)return null;var f=e.prefixCls,g=e.isActive,P=e.role;return v("div",{ref:F,class:X("".concat(f,"-content"),(n={},x(n,"".concat(f,"-content-active"),g),x(n,"".concat(f,"-content-inactive"),!g),n)),role:P},[v("div",{class:"".concat(f,"-content-box")},[(o=s.default)===null||o===void 0?void 0:o.call(s)])])}}}),ee=ae({compatConfig:{MODE:3},name:"ACollapsePanel",inheritAttrs:!1,props:ge(me(),{showArrow:!0,isActive:!1,onItemClick:function(){},headerClass:"",forceRender:!1}),slots:["expandIcon","extra","header"],setup:function(e,t){var s=t.slots,c=t.emit,n=t.attrs;Be(e.disabled===void 0,"Collapse.Panel",'`disabled` is deprecated. Please use `collapsible="disabled"` instead.');var o=he("collapse",e),f=o.prefixCls,g=function(){c("itemClick",e.panelKey)},P=function(h){(h.key==="Enter"||h.keyCode===13||h.which===13)&&g()};return function(){var T,h,K,$,M=e.header,N=M===void 0?(T=s.header)===null||T===void 0?void 0:T.call(s):M,d=e.headerClass,r=e.isActive,u=e.showArrow,y=e.destroyInactivePanel,b=e.accordion,R=e.forceRender,a=e.openAnimation,i=e.expandIcon,_=i===void 0?s.expandIcon:i,k=e.extra,O=k===void 0?(h=s.extra)===null||h===void 0?void 0:h.call(s):k,A=e.collapsible,w=A==="disabled",I=f.value,p=X("".concat(I,"-header"),(K={},x(K,d,d),x(K,"".concat(I,"-header-collapsible-only"),A==="header"),K)),G=X(($={},x($,"".concat(I,"-item"),!0),x($,"".concat(I,"-item-active"),r),x($,"".concat(I,"-item-disabled"),w),x($,"".concat(I,"-no-arrow"),!u),x($,"".concat(n.class),!!n.class),$)),m=v("i",{class:"arrow"},null);u&&typeof _=="function"&&(m=_(e));var L=Ee(v(la,{prefixCls:I,isActive:r,forceRender:R,role:b?"tabpanel":null},{default:s.default}),[[Te,r]]),U=Y({appear:!1,css:!1},a);return v("div",Y(Y({},n),{},{class:G}),[v("div",{class:p,onClick:function(){return A!=="header"&&g()},role:b?"tab":"button",tabindex:w?-1:0,"aria-expanded":r,onKeypress:P},[u&&m,A==="header"?v("span",{onClick:g,class:"".concat(I,"-header-text")},[N]):N,O&&v("div",{class:"".concat(I,"-extra")},[O])]),v(Ke,U,{default:function(){return[!y||r?L:null]}})])}}});Z.Panel=ee;Z.install=function(l){return l.component(Z.name,Z),l.component(ee.name,ee),l};var sa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"};const oa=sa;function pe(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.forEach(function(c){ia(l,c,t[c])})}return l}function ia(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}var le=function(e,t){var s=pe({},e,t.attrs);return v(Ne,pe({},s,{icon:oa}),null)};le.displayName="ArrowRightOutlined";le.inheritAttrs=!1;const ra=le;function ca(l,e,t,s){for(var c=-1,n=l==null?0:l.length;++c<n;){var o=l[c];e(s,o,t(o),l)}return s}function da(l){return function(e,t,s){for(var c=-1,n=Object(e),o=s(e),f=o.length;f--;){var g=o[l?f:++c];if(t(n[g],g,n)===!1)break}return e}}var ua=da();const va=ua;function fa(l,e){return l&&va(l,e,Re)}function pa(l,e){return function(t,s){if(t==null)return t;if(!De(t))return l(t,s);for(var c=t.length,n=e?c:-1,o=Object(t);(e?n--:++n<c)&&s(o[n],n,o)!==!1;);return t}}var ga=pa(fa);const ha=ga;function ma(l,e,t,s){return ha(l,function(c,n,o){e(s,c,t(c),o)}),s}function ya(l,e){return function(t,s){var c=Me(t)?ca:ma,n=e?e():{};return c(t,l,ta(s),n)}}var ba=Object.prototype,_a=ba.hasOwnProperty,Ca=ya(function(l,e,t){_a.call(l,t)?l[t].push(e):je(l,t,[e])});const xa=Ca;const Aa={class:"container"},Ia={class:"search-bar"},wa={class:"form-name"},ka={class:"search-bar"},Pa={class:"form-name"},$a={class:"search-bar"},Oa={class:"form-name"},Sa={key:0,class:"generate-idx-hint"},Ba={class:"list-container"},Ea=["onClick"],Ta=["onClick"],Ka=["onClickCapture"],Na=ae({__name:"TagSearch",props:{tabIdx:{},paneIdx:{}},setup(l){const e=l,t=Fe(),s=Ue(),c=Q(()=>!s.isIdle),n=F(),o=F({and_tags:[],or_tags:[],not_tags:[]}),f=Q(()=>n.value?n.value.tags.slice().sort((a,i)=>i.count-a.count):[]),g=["custom","Model","lora","pos","size","Postprocess upscaler","Postprocess upscale by","Sampler"].reduce((a,i,_)=>(a[i]=_,a),{}),P=Q(()=>Object.entries(xa(f.value,a=>a.type)).sort((a,i)=>g[a[0]]-g[i[0]])),T=Ve(),h=F(P.value.map(a=>a[0]));Le(async()=>{n.value=await ve(),h.value=P.value.map(a=>a[0]),n.value.img_count&&n.value.expired&&K()}),oe("searchIndexExpired",()=>n.value&&(n.value.expired=!0));const K=ze(()=>s.pushAction(async()=>(await aa(),n.value=await ve(),h.value=P.value.map(a=>a[0]),n.value)).res),$=()=>{t.openTagSearchMatchedImageGridInRight(e.tabIdx,T,o.value)};oe("returnToIIB",async()=>{const a=await s.pushAction(Je).res;n.value.expired=a.expired});const M=(a,i=!1)=>(i?`[${a.type}] `:"")+(a.display_name?`${a.display_name} : ${a.name}`:a.name),N=F(!1),d=F(""),r=async()=>{var i,_,k;if(!d.value){N.value=!1;return}const a=await s.pushAction(()=>Xe({tag_name:d.value})).res;a.type!=="custom"&&de.error(ne("existInOtherType")),(i=n.value)!=null&&i.tags.find(O=>O.id===a.id)?de.error(ne("alreadyExists")):((_=n.value)==null||_.tags.push(a),(k=t.conf)==null||k.all_custom_tags.push(a)),d.value="",N.value=!1},u=a=>{We.confirm({title:ne("confirmDelete"),async onOk(){var _,k,O,A;await ea({tag_id:a});const i=((_=n.value)==null?void 0:_.tags.findIndex(w=>w.id===a))??-1;(k=n.value)==null||k.tags.splice(i,1),(A=t.conf)==null||A.all_custom_tags.splice((O=t.conf)==null?void 0:O.all_custom_tags.findIndex(w=>w.id===a),1)}})},y=Q(()=>new Set([o.value.and_tags,o.value.or_tags,o.value.not_tags].flat())),b=a=>{y.value.has(a.id)?(o.value.and_tags=o.value.and_tags.filter(i=>i!==a.id),o.value.or_tags=o.value.or_tags.filter(i=>i!==a.id),o.value.not_tags=o.value.not_tags.filter(i=>i!==a.id)):o.value.and_tags.push(a.id)},R={value:a=>a.id,text:M,optionText:a=>M(a,!0)};return(a,i)=>{const _=ue,k=Qe,O=ue,A=Ye,w=ee,I=Z;return C(),S("div",Aa,[z("",!0),n.value?(C(),S(J,{key:1},[D("div",null,[D("div",Ia,[D("div",wa,B(a.$t("exactMatch")),1),v(E(te),{conv:R,mode:"multiple",style:{width:"100%"},options:f.value,value:o.value.and_tags,"onUpdate:value":i[0]||(i[0]=p=>o.value.and_tags=p),disabled:!f.value.length,placeholder:a.$t("selectExactMatchTag")},null,8,["options","value","disabled","placeholder"]),n.value.expired||!n.value.img_count?(C(),W(_,{key:0,onClick:E(K),loading:!E(s).isIdle,type:"primary"},{default:V(()=>[q(B(n.value.img_count===0?a.$t("generateIndexHint"):a.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(C(),W(_,{key:1,type:"primary",onClick:$,loading:!E(s).isIdle,disabled:!o.value.and_tags.length},{default:V(()=>[q(B(a.$t("search")),1)]),_:1},8,["loading","disabled"]))]),D("div",ka,[D("div",Pa,B(a.$t("anyMatch")),1),v(E(te),{conv:R,mode:"multiple",style:{width:"100%"},options:f.value,value:o.value.or_tags,"onUpdate:value":i[1]||(i[1]=p=>o.value.or_tags=p),disabled:!f.value.length,placeholder:a.$t("selectAnyMatchTag")},null,8,["options","value","disabled","placeholder"])]),D("div",$a,[D("div",Oa,B(a.$t("exclude")),1),v(E(te),{conv:R,mode:"multiple",style:{width:"100%"},options:f.value,value:o.value.not_tags,"onUpdate:value":i[2]||(i[2]=p=>o.value.not_tags=p),disabled:!f.value.length,placeholder:a.$t("selectExcludeTag")},null,8,["options","value","disabled","placeholder"])])]),f.value.filter(p=>p.type!=="custom").length?z("",!0):(C(),S("p",Sa,B(a.$t("needGenerateIdx")),1)),D("div",Ba,[(C(!0),S(J,null,ie(P.value,([p,G])=>(C(),S("ul",{class:"tag-list",key:p},[D("h3",{class:"cat-name",onClick:m=>h.value.includes(p)?h.value.splice(h.value.indexOf(p),1):h.value.push(p)},[v(E(ra),{class:re(["arrow",{down:h.value.includes(p)}])},null,8,["class"]),q(" "+B(a.$t(p)),1)],8,Ea),v(I,{ghost:"",activeKey:h.value,"onUpdate:activeKey":i[5]||(i[5]=m=>h.value=m)},{expandIcon:V(()=>[]),default:V(()=>[(C(),W(w,{key:p},{default:V(()=>[(C(!0),S(J,null,ie(G,(m,L)=>(C(),S("li",{key:m.id,class:re(["tag",{selected:y.value.has(m.id)}]),onClick:U=>b(m)},[y.value.has(m.id)?(C(),W(E(qe),{key:0})):z("",!0),q(" "+B(M(m))+" ",1),p==="custom"&&L!==0?(C(),S("span",{key:1,class:"remove",onClickCapture:ce(U=>u(m.id),["stop"])},[v(E(Ge))],40,Ka)):z("",!0)],10,Ta))),128)),p==="custom"?(C(),S("li",{key:0,class:"tag",onClick:i[4]||(i[4]=m=>N.value=!0)},[N.value?(C(),W(A,{key:0,compact:""},{default:V(()=>[v(k,{value:d.value,"onUpdate:value":i[3]||(i[3]=m=>d.value=m),style:{width:"128px"},loading:c.value,"allow-clear":"",size:"small"},null,8,["value","loading"]),v(O,{size:"small",type:"primary",onClickCapture:ce(r,["stop"]),loading:c.value},{default:V(()=>[q(B(d.value?a.$t("submit"):a.$t("cancel")),1)]),_:1},8,["onClickCapture","loading"])]),_:1})):(C(),S(J,{key:1},[v(E(He)),q(" "+B(a.$t("add")),1)],64))])):z("",!0)]),_:2},1024))]),_:2},1032,["activeKey"])]))),128))])],64)):z("",!0)])}}});const Ua=Ze(Na,[["__scopeId","data-v-f502b717"]]);export{Ua as default};
