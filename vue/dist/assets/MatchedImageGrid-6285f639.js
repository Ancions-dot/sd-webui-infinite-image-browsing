import{d as ne,k as R,aw as ie,X as ae,O as u,Q as k,c as s,$ as e,Z as o,a1 as V,R as r,E as re,T as a,S as m,Y as D,aa as de,V as _,ab as z,ad as ce,ae as ue,ag as B,aK as pe,aL as me,bP as ge,W as fe}from"./index-60751f65.js";import{S as ve}from"./index-a6945554.js";import{L as Ie,R as ke,f as _e,M as we}from"./MultiSelectKeep-38167d1d.js";import{c as Ce,d as he,F as Se}from"./FileItem-497c47ae.js";import{c as be,u as xe}from"./hook-4f760f88.js";import{a as ye}from"./functionalCallableComp-a162d668.js";import"./shortcut-ff083b3f.js";import"./Checkbox-5eeb59a1.js";/* empty css              */import"./index-082f03a8.js";const Me=d=>(pe("data-v-fbf8262b"),d=d(),me(),d),Ae={class:"hint"},Te={class:"action-bar"},$e=Me(()=>r("div",{style:{padding:"16px 0 512px"}},null,-1)),Fe={key:1},Re={class:"no-res-hint"},Ve={class:"hint"},De={key:2,class:"preview-switch"},ze=ne({__name:"MatchedImageGrid",props:{tabIdx:{},paneIdx:{},selectedTagIds:{},id:{}},setup(d){const g=d,f=be(t=>ge(g.selectedTagIds,t)),{queue:G,images:i,onContextMenuClickU:w,stackViewEl:E,previewIdx:c,previewing:C,onPreviewVisibleChange:L,previewImgMove:h,canPreview:S,itemSize:b,gridItems:N,showGenInfo:p,imageGenInfo:x,q:P,multiSelectedIdxs:v,onFileItemClick:U,scroller:y,showMenuIdx:I,onFileDragStart:J,onFileDragEnd:K,cellWidth:O,onScroll:M,saveAllFileAsJson:q,props:Q,saveLoadedFileAsJson:W}=xe(f);R(()=>g.selectedTagIds,async()=>{var t;await f.reset(),await ie(),(t=y.value)==null||t.scrollToItem(0),M()},{immediate:!0}),R(()=>g,async t=>{Q.value=t},{deep:!0,immediate:!0});const X=ae(),{onClearAllSelected:Y,onSelectAll:Z,onReverseSelect:j}=Ce();return(t,l)=>{const H=we,ee=ce,te=ue,A=B,le=B,se=ve;return u(),k("div",{class:"container",ref_key:"stackViewEl",ref:E},[s(H,{show:!!e(v).length||e(X).keepMultiSelect,onClearAllSelected:e(Y),onSelectAll:e(Z),onReverseSelect:e(j)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),s(se,{size:"large",spinning:!e(G).isIdle},{default:o(()=>{var T,$;return[s(te,{visible:e(p),"onUpdate:visible":l[1]||(l[1]=n=>V(p)?p.value=n:null),width:"70vw","mask-closable":"",onOk:l[2]||(l[2]=n=>p.value=!1)},{cancelText:o(()=>[]),default:o(()=>[s(ee,{active:"",loading:!e(P).isIdle},{default:o(()=>[r("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:l[0]||(l[0]=n=>e(re)(e(x)))},[r("div",Ae,a(t.$t("doubleClickToCopy")),1),m(" "+a(e(x)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),r("div",Te,[s(A,{onClick:e(W)},{default:o(()=>[m(a(t.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),s(A,{onClick:e(q)},{default:o(()=>[m(a(t.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),(T=e(i))!=null&&T.length?(u(),D(e(he),{key:0,ref_key:"scroller",ref:y,class:"file-list",items:e(i),"item-size":e(b).first,"key-field":"fullpath","item-secondary-size":e(b).second,gridItems:e(N),onScroll:e(M)},{after:o(()=>[$e]),default:o(({item:n,index:F})=>[s(Se,{idx:F,file:n,"cell-width":e(O),"show-menu-idx":e(I),"onUpdate:showMenuIdx":l[3]||(l[3]=oe=>V(I)?I.value=oe:null),onDragstart:e(J),onDragend:e(K),onFileItemClick:e(U),"full-screen-preview-image-url":e(i)[e(c)]?e(de)(e(i)[e(c)]):"",selected:e(v).includes(F),onContextMenuClick:e(w),onPreviewVisibleChange:e(L),"is-selected-mutil-files":e(v).length>1},null,8,["idx","file","cell-width","show-menu-idx","onDragstart","onDragend","onFileItemClick","full-screen-preview-image-url","selected","onContextMenuClick","onPreviewVisibleChange","is-selected-mutil-files"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):e(f).load&&t.selectedTagIds.and_tags.length===1&&!(($=t.selectedTagIds.folder_paths_str)!=null&&$.trim())?(u(),k("div",Fe,[r("div",Re,[r("p",Ve,a(t.$t("tagSearchNoResultsMessage")),1),s(le,{onClick:l[4]||(l[4]=n=>e(ye)()),type:"primary"},{default:o(()=>[m(a(t.$t("rebuildImageIndex")),1)]),_:1})])])):_("",!0),e(C)?(u(),k("div",De,[s(e(Ie),{onClick:l[5]||(l[5]=n=>e(h)("prev")),class:z({disable:!e(S)("prev")})},null,8,["class"]),s(e(ke),{onClick:l[6]||(l[6]=n=>e(h)("next")),class:z({disable:!e(S)("next")})},null,8,["class"])])):_("",!0)]}),_:1},8,["spinning"]),e(C)&&e(i)&&e(i)[e(c)]?(u(),D(_e,{key:0,file:e(i)[e(c)],idx:e(c),onContextMenuClick:e(w)},null,8,["file","idx","onContextMenuClick"])):_("",!0)],512)}}});const qe=fe(ze,[["__scopeId","data-v-fbf8262b"]]);export{qe as default};
